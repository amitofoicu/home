<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è·èŠ±é‡‡é›†å°æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            overflow-x: hidden;
            background-color: #0a3d3d;
            position: relative;
            -webkit-text-size-adjust: 100%;
        }
        
        /* èƒŒæ™¯å›¾ç‰‡ */
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.15;
            z-index: -2;
        }
        
        .more-games-link {
            position: fixed;
            top: 15px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            touch-action: manipulation;
        }
        
        .more-games-link:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        h1 {
            color: white;
            font-size: clamp(2.2rem, 5vw, 3.2rem);
            margin-bottom: 8px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }
        
        .subtitle {
            color: #ffeb3b;
            font-size: clamp(1rem, 3vw, 1.4rem);
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .info-box {
            text-align: center;
            flex: 1;
        }
        
        .info-label {
            color: #e0e0e0;
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            margin-bottom: 6px;
        }
        
        .info-value {
            color: white;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 700;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        #score {
            color: #ff6b9d;
        }
        
        #timer {
            color: #ffcc00;
        }
        
        #level {
            color: #4cff4c;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            height: clamp(300px, 50vh, 500px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
            touch-action: manipulation;
        }
        
        .game-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .lotus-bubble {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.5);
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .lotus-bubble:active {
            transform: scale(0.95);
        }
        
        .lotus-bubble.popped {
            animation: pop 0.3s forwards;
        }
        
        .lotus-bubble::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            padding: 14px 28px;
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            justify-content: center;
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        
        .btn-start {
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            color: white;
        }
        
        .btn-pause {
            background: linear-gradient(to right, #FF9800, #FFC107);
            color: white;
        }
        
        .btn-reset {
            background: linear-gradient(to right, #f44336, #FF5722);
            color: white;
        }
        
        .btn-mute {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
        }
        
        .btn-mute.muted {
            background: linear-gradient(to right, #8e9eab, #eef2f3);
            color: #666;
        }
        
        .instructions {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .instructions h2 {
            color: white;
            margin-bottom: 12px;
            font-size: clamp(1.4rem, 3vw, 1.8rem);
            text-align: center;
        }
        
        .instructions ul {
            color: #e0e0e0;
            list-style-type: none;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            line-height: 1.7;
        }
        
        .instructions li {
            margin-bottom: 8px;
            padding-left: 28px;
            position: relative;
        }
        
        .instructions li i {
            position: absolute;
            left: 0;
            top: 4px;
            color: #ffcc00;
        }
        
        .combo-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 900;
            color: #ffcc00;
            pointer-events: none;
            opacity: 0;
            z-index: 100;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
        }
        
        .combo-show {
            animation: comboAnim 1s forwards;
        }
        
        @keyframes comboAnim {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        
        .petal-fall {
            position: fixed;
            top: -50px;
            font-size: 2rem;
            color: #ff6b9d;
            pointer-events: none;
            opacity: 0;
            z-index: 90;
            animation: petalFall 3s linear forwards;
        }
        
        @keyframes petalFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        footer {
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: clamp(0.8rem, 2vw, 1rem);
            padding: 12px;
        }
        
        footer a {
            color: #4cff4c;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        footer a:hover {
            color: #ffcc00;
            text-decoration: underline;
        }
        
        .image-not-found {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
            padding: 5px;
        }
        
        .mobile-tap-hint {
            display: none;
            color: #ffcc00;
            font-size: 1rem;
            margin-top: 10px;
            text-align: center;
        }
        
        /* é’ˆå¯¹iPhoneçš„ä¼˜åŒ– */
        @supports (-webkit-touch-callout: none) {
            body {
                padding: 10px;
            }
            
            .game-area {
                height: clamp(280px, 45vh, 450px);
            }
            
            .btn {
                padding: 12px 24px;
                font-size: 0.95rem;
                min-width: 140px;
            }
            
            /* é˜²æ­¢iOSä¸Šçš„æ©¡çš®ç­‹æ•ˆæœ */
            html, body {
                overscroll-behavior-y: contain;
                overflow-y: auto;
                position: fixed;
                width: 100%;
                height: 100%;
            }
            
            .lotus-bubble {
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .game-area {
                height: clamp(200px, 40vh, 350px);
            }
            
            .game-info {
                padding: 12px 15px;
                margin-bottom: 15px;
            }
            
            .info-label {
                font-size: 0.8rem;
            }
            
            .info-value {
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
                min-width: 130px;
            }
            
            .instructions {
                padding: 15px;
            }
        }
        
        /* å°å±å¹•æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 320px) {
            .more-games-link {
                top: 10px;
                left: 10px;
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .game-info {
                padding: 12px 15px;
            }
            
            .info-value {
                font-size: 1.5rem;
            }
            
            .btn {
                min-width: 120px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .instructions {
                padding: 15px;
            }
        }
        
        /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
        .lotus-bubble, .btn, a {
            touch-action: manipulation;
        }
        
        /* ä¼˜åŒ–å­—ä½“æ¸²æŸ“ */
        h1, .info-value {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
        .lotus-bubble, .btn {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ */
        .lotus-bubble, .petal-fall, .combo-indicator {
            will-change: transform, opacity;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å›¾ç‰‡å°†åœ¨JSä¸­è®¾ç½® -->
    <div class="background-image" id="backgroundImage"></div>
    
    <!-- å·¦ä¸Šè§’è§’æ ‡ -->
    <a href="https://amitofoicu.github.io/home/main.html" class="more-games-link">
        <i class="fas fa-gamepad"></i> æ›´å¤šæ¸¸æˆ
    </a>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-water-lily"></i> è·èŠ±é‡‡é›†å°æ¸¸æˆ</h1>
            <p class="subtitle">è½»è§¦è·èŠ±è¿›è¡Œé‡‡é›†ï¼Œäº«å—ç¦…æ„æ—¶å…‰</p>
            <p class="mobile-tap-hint"><i class="fas fa-hand-point-up"></i> åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œè½»è§¦è·èŠ±å³å¯é‡‡é›†</p>
        </header>
        
        <div class="game-info">
            <div class="info-box">
                <div class="info-label">é‡‡é›†èŠ±æœµæ€»æ•°</div>
                <div id="score" class="info-value">0</div>
            </div>
            <div class="info-box">
                <div class="info-label">å‰©ä½™æ—¶é—´</div>
                <div id="timer" class="info-value">60</div>
            </div>
            <div class="info-box">
                <div class="info-label">ç­‰çº§</div>
                <div id="level" class="info-value">1</div>
            </div>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="game-background" id="gameBackground"></div>
            <!-- è·èŠ±æ³¡æ³¡ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="controls">
            <button class="btn btn-start" id="startBtn">
                <i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ
            </button>
            <button class="btn btn-reset" id="resetBtn">
                <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
            </button>
            <button class="btn btn-mute" id="muteBtn">
                <i class="fas fa-volume-up"></i> é™éŸ³
            </button>
        </div>
        
        <div class="instructions">
            <h2>æ¸¸æˆè¯´æ˜</h2>
            <ul>
                <li><i class="fas fa-hand-pointer"></i> ç‚¹å‡»/è½»è§¦è·èŠ±è¿›è¡Œé‡‡é›†ï¼Œæ¯æœµè®¡1åˆ†</li>
                <li><i class="fas fa-clock"></i> æ¸¸æˆæ—¶é—´60ç§’ï¼Œæ—¶é—´ç»“æŸæ¸¸æˆåœæ­¢</li>
                <li><i class="fas fa-tachometer-alt"></i> éšç€ç­‰çº§æé«˜ï¼Œè·èŠ±å‡ºç°é€Ÿåº¦ä¼šåŠ å¿«</li>
                <li><i class="fas fa-gift"></i> æ¯é‡‡é›†10æœµè·èŠ±è§¦å‘èŠ±ç“£é›¨ç‰¹æ•ˆ</li>
                <li><i class="fas fa-expand-alt"></i> è·èŠ±å¤§å°éšæœºå˜åŒ–ï¼š30px åˆ° 80px</li>
            </ul>
        </div>
        
        <div class="combo-indicator" id="comboIndicator"></div>
    </div>
    
    <footer>
        <p>Â© 2026 è·èŠ±é‡‡é›†å°æ¸¸æˆ | æä¾›è€…ï¼š<a href="https://amitofoicu.github.io/home">amitofoicu.github.io/home</a></p>
    </footer>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="bg-music" loop>
        <source src="beijing.ogg" type="audio/ogg">
        <source src="beijing.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>
    <audio id="pop-sound">
        <source src="win.mp3" type="audio/mpeg">
        <source src="win.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>
    <audio id="effect-sound">
        <source src="xiaochu.mp3" type="audio/mpeg">
        <source src="xiaochu.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // æ¸¸æˆå˜é‡
        let score = 0;
        let timeLeft = 60;
        let level = 1;
        let gameActive = false;
        let gamePaused = false;
        let timerInterval;
        let bubbleInterval;
        let comboCount = 0;
        let comboTimeout;
        let lastClickTime = 0;
        let lastTenTrigger = 0; // è®°å½•ä¸Šæ¬¡è§¦å‘10æœµè·èŠ±çš„æ—¶é—´
        let isMuted = false; // é™éŸ³çŠ¶æ€
        
        // éŸ³é¢‘å…ƒç´ 
        const bgMusic = document.getElementById('bg-music');
        const popSound = document.getElementById('pop-sound');
        const effectSound = document.getElementById('effect-sound');
        
        // DOM å…ƒç´ 
        const gameArea = document.getElementById('gameArea');
        const gameBackground = document.getElementById('gameBackground');
        const backgroundImage = document.getElementById('backgroundImage');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const levelElement = document.getElementById('level');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const muteBtn = document.getElementById('muteBtn');
        const comboIndicator = document.getElementById('comboIndicator');
        
        // èµ„æºè·¯å¾„é…ç½® - æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹è¿™äº›è·¯å¾„
        const RESOURCE_PATHS = {
            // èƒŒæ™¯å›¾ç‰‡
            background: 'https://amitofoicu.github.io/home/lianchi6.jpg',
            // å¤‡ç”¨èƒŒæ™¯å›¾ç‰‡ï¼ˆå¦‚æœä¸»å›¾ç‰‡åŠ è½½å¤±è´¥ï¼‰
            fallbackBackground: '',
            // è·èŠ±å›¾ç‰‡æ•°ç»„
            lotusImages: [
                'lotus1.jpg',
                'lotus2.jpg', 
                'lotus3.jpg',
                'lotus4.jpg'
            ],
            // å¤‡ç”¨è·èŠ±å›¾ç‰‡
            onlineLotusImages: [
                'https://amitofoicu.github.io/home/lotus1.jpg',
                'https://amitofoicu.github.io/home/lotus2.jpg',
                'https://amitofoicu.github.io/home/lotus3.jpg',
                'https://amitofoicu.github.io/home/lotus4.jpg'
            ]
        };
        
        // å½“å‰ä½¿ç”¨çš„å›¾ç‰‡æ•°ç»„
        let currentLotusImages = [];
        
        // é¢„å…ˆåŠ è½½éŸ³é¢‘
        function preloadAudio() {
            // è®¾ç½®éŸ³é¢‘éŸ³é‡
            bgMusic.volume = 0.5; // ä¸­ç­‰éŸ³é‡
            popSound.volume = 0.4;
            effectSound.volume = 0.7;
            
            // åŠ è½½éŸ³é¢‘
            bgMusic.load();
            popSound.load();
            effectSound.load();
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’åï¼‰
            document.addEventListener('click', startBackgroundMusic, { once: true });
        }
        
        // å¼€å§‹èƒŒæ™¯éŸ³ä¹
        function startBackgroundMusic() {
            if (!isMuted) {
                bgMusic.play().catch(e => console.log("éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:", e));
            }
        }
        
        // åŠ è½½èµ„æºå¹¶æ£€æŸ¥å¯ç”¨æ€§
        async function loadResources() {
            console.log("å¼€å§‹åŠ è½½èµ„æº...");
            
            // 1. å°è¯•åŠ è½½èƒŒæ™¯å›¾ç‰‡
            const bgLoaded = await testImageLoad(RESOURCE_PATHS.background);
            
            if (bgLoaded) {
                console.log("èƒŒæ™¯å›¾ç‰‡åŠ è½½æˆåŠŸ:", RESOURCE_PATHS.background);
                gameBackground.style.backgroundImage = `url('${RESOURCE_PATHS.background}')`;
                backgroundImage.style.backgroundImage = `url('${RESOURCE_PATHS.background}')`;
            } else {
                console.log("èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨èƒŒæ™¯");
                gameBackground.style.background = 'linear-gradient(135deg, #0c7b93 0%, #00a8cc 100%)';
                backgroundImage.style.background = 'linear-gradient(135deg, #0c7b93 0%, #00a8cc 100%)';
            }
            
            // 2. æµ‹è¯•è·èŠ±å›¾ç‰‡
            const lotusTests = [];
            for (let i = 0; i < RESOURCE_PATHS.lotusImages.length; i++) {
                lotusTests.push(testImageLoad(RESOURCE_PATHS.lotusImages[i]));
            }
            
            const lotusResults = await Promise.all(lotusTests);
            const availableImages = [];
            
            for (let i = 0; i < lotusResults.length; i++) {
                if (lotusResults[i]) {
                    availableImages.push(RESOURCE_PATHS.lotusImages[i]);
                }
            }
            
            if (availableImages.length > 0) {
                console.log("æ‰¾åˆ°", availableImages.length, "ä¸ªå¯ç”¨çš„è·èŠ±å›¾ç‰‡");
                currentLotusImages = availableImages;
            } else {
                console.log("æ‰€æœ‰æœ¬åœ°è·èŠ±å›¾ç‰‡éƒ½åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åœ¨çº¿èµ„æº");
                currentLotusImages = RESOURCE_PATHS.onlineLotusImages;
            }
            
            console.log("èµ„æºåŠ è½½å®Œæˆ");
        }
        
        // æµ‹è¯•å›¾ç‰‡åŠ è½½
        function testImageLoad(src) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = src;
                
                // è®¾ç½®è¶…æ—¶
                setTimeout(() => resolve(false), 3000);
            });
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('load', async function() {
            // é¦–å…ˆé¢„åŠ è½½éŸ³é¢‘
            preloadAudio();
            
            // ç„¶ååŠ è½½å›¾ç‰‡èµ„æº
            await loadResources();
            
            // åˆå§‹ç”Ÿæˆä¸€äº›é™æ€è·èŠ±æ³¡æ³¡
            for (let i = 0; i < 6; i++) {
                setTimeout(() => createLotusBubble(), i * 300);
            }
        });
        
        // æ¸¸æˆäº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', toggleGame);
        resetBtn.addEventListener('click', resetGame);
        muteBtn.addEventListener('click', toggleMute);
        
        // åˆ‡æ¢é™éŸ³çŠ¶æ€
        function toggleMute() {
            isMuted = !isMuted;
            
            if (isMuted) {
                // é™éŸ³æ‰€æœ‰éŸ³é¢‘
                bgMusic.pause();
                muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i> å–æ¶ˆé™éŸ³';
                muteBtn.classList.add('muted');
                muteBtn.style.background = 'linear-gradient(to right, #8e9eab, #eef2f3)';
            } else {
                // å–æ¶ˆé™éŸ³
                muteBtn.innerHTML = '<i class="fas fa-volume-up"></i> é™éŸ³';
                muteBtn.classList.remove('muted');
                muteBtn.style.background = 'linear-gradient(to right, #6a11cb, #2575fc)';
                
                // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                if (gameActive && !gamePaused) {
                    bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                }
            }
        }
        
        // åˆ‡æ¢æ¸¸æˆçŠ¶æ€ï¼ˆå¼€å§‹/æš‚åœï¼‰
        function toggleGame() {
            if (!gameActive) {
                startGame();
            } else if (gamePaused) {
                resumeGame();
            } else {
                pauseGame();
            }
        }
        
        // ç”Ÿæˆè·èŠ±æ³¡æ³¡å‡½æ•°
        function createLotusBubble() {
            if (!gameActive || gamePaused) return;
            
            const bubble = document.createElement('div');
            bubble.classList.add('lotus-bubble');
            
            // éšæœºæ³¡æ³¡å¤§å° (30px åˆ° 80px)
            const size = Math.floor(Math.random() * 50) + 30;
            
            // éšæœºä½ç½®
            const maxX = gameArea.clientWidth - size;
            const maxY = gameArea.clientHeight - size;
            const posX = Math.floor(Math.random() * maxX);
            const posY = Math.floor(Math.random() * maxY);
            
            // éšæœºé€‰æ‹©è·èŠ±å›¾ç‰‡
            let imageUrl = '';
            if (currentLotusImages && currentLotusImages.length > 0) {
                const imageIndex = Math.floor(Math.random() * currentLotusImages.length);
                imageUrl = currentLotusImages[imageIndex];
            }
            
            // è®¾ç½®æ³¡æ³¡æ ·å¼
            bubble.style.width = `${size}px`;
            bubble.style.height = `${size}px`;
            bubble.style.left = `${posX}px`;
            bubble.style.top = `${posY}px`;
            
            // å¦‚æœæœ‰å›¾ç‰‡URLï¼Œå°è¯•åŠ è½½
            if (imageUrl) {
                const img = new Image();
                img.onload = function() {
                    bubble.style.backgroundImage = `url('${imageUrl}')`;
                };
                img.onerror = function() {
                    // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºå½©è‰²æ›¿ä»£èƒŒæ™¯
                    bubble.classList.add('image-not-found');
                    bubble.style.backgroundImage = 'none';
                    bubble.style.background = getRandomGradient();
                    bubble.innerHTML = `<div style="font-size: ${size/5}px">è·èŠ±</div>`;
                };
                img.src = imageUrl;
            } else {
                // æ²¡æœ‰å¯ç”¨å›¾ç‰‡ï¼Œä½¿ç”¨å½©è‰²æ›¿ä»£èƒŒæ™¯
                bubble.classList.add('image-not-found');
                bubble.style.backgroundImage = 'none';
                bubble.style.background = getRandomGradient();
                bubble.innerHTML = `<div style="font-size: ${size/5}px">è·èŠ±</div>`;
            }
            
            // æ¯ä¸ªè·èŠ±åˆ†å€¼ä¸º1åˆ†
            const bubbleValue = 1;
            bubble.dataset.value = bubbleValue;
            
            // è§¦æ‘¸å¼€å§‹å¤„ç†ï¼ˆé˜²æ­¢iOSä¸Šçš„300mså»¶è¿Ÿï¼‰
            function handleTouchStart(e) {
                // é˜»æ­¢é»˜è®¤è¡Œä¸ºä»¥é˜²æ­¢åŒå‡»ç¼©æ”¾
                e.preventDefault();
            }
            
            // ç‚¹å‡»äº‹ä»¶å¤„ç†
            function handleBubbleClick(e) {
                if (e.type === 'touchend') {
                    // é˜²æ­¢è§¦æ‘¸äº‹ä»¶è§¦å‘å¤šæ¬¡ç‚¹å‡»
                    e.preventDefault();
                }
                popBubble(bubble, bubbleValue);
            }
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - åŒæ—¶æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸
            bubble.addEventListener('click', handleBubbleClick);
            bubble.addEventListener('touchstart', handleTouchStart, { passive: false });
            bubble.addEventListener('touchend', handleBubbleClick, { passive: false });
            
            // æ·»åŠ åˆ°æ¸¸æˆåŒºåŸŸ
            gameArea.appendChild(bubble);
            
            // æ³¡æ³¡è‡ªåŠ¨æ¶ˆå¤± (é¿å…å †ç§¯)
            const lifetime = 3000 + (level * 500);
            setTimeout(() => {
                if (bubble.parentNode && !bubble.classList.contains('popped')) {
                    bubble.remove();
                }
            }, lifetime);
        }
        
        // éšæœºæ¸å˜èƒŒæ™¯å‡½æ•°
        function getRandomGradient() {
            const gradients = [
                'linear-gradient(45deg, #ff9a9e, #fad0c4)',
                'linear-gradient(45deg, #a1c4fd, #c2e9fb)',
                'linear-gradient(45deg, #d4fc79, #96e6a1)',
                'linear-gradient(45deg, #fbc2eb, #a6c1ee)'
            ];
            return gradients[Math.floor(Math.random() * gradients.length)];
        }
        
        // ç‚¹å‡»è·èŠ±å‡½æ•°
        function popBubble(bubble, value) {
            if (!gameActive || gamePaused) return;
            
            // æ³¡æ³¡çˆ†ç‚¸åŠ¨ç”»
            bubble.classList.add('popped');
            
            // è®¡ç®—è¿å‡»
            const currentTime = Date.now();
            if (currentTime - lastClickTime < 500) {
                comboCount++;
                if (comboCount >= 3) {
                    showCombo(comboCount);
                    value *= comboCount; // è¿å‡»åŠ æˆ
                }
            } else {
                comboCount = 1;
            }
            
            lastClickTime = currentTime;
            
            // æ¸…é™¤è¿å‡»å®šæ—¶å™¨
            clearTimeout(comboTimeout);
            comboTimeout = setTimeout(() => {
                comboCount = 0;
            }, 500);
            
            // æ›´æ–°åˆ†æ•°
            score += value;
            scoreElement.textContent = score;
            
            // åˆ†æ•°å¢åŠ åŠ¨ç”»
            scoreElement.style.transform = 'scale(1.2)';
            setTimeout(() => {
                scoreElement.style.transform = 'scale(1)';
            }, 200);
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°10çš„å€æ•°
            if (score > 0 && score % 10 === 0 && score !== lastTenTrigger) {
                lastTenTrigger = score;
                triggerPetalFall();
                
                // æ’­æ”¾ç‰¹æ•ˆéŸ³æ•ˆ
                if (!isMuted) {
                    effectSound.currentTime = 0;
                    effectSound.play().catch(e => console.log("ç‰¹æ•ˆéŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
                }
            }
            
            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            if (!isMuted) {
                popSound.currentTime = 0;
                popSound.play().catch(e => console.log("ç‚¹å‡»éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
            }
            
            // ç§»é™¤æ³¡æ³¡
            setTimeout(() => {
                if (bubble.parentNode) {
                    bubble.remove();
                }
            }, 300);
            
            // æ¯å¾—30åˆ†å‡ä¸€çº§
            const newLevel = Math.floor(score / 30) + 1;
            if (newLevel > level) {
                level = newLevel;
                levelElement.textContent = level;
                levelElement.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    levelElement.style.transform = 'scale(1)';
                }, 300);
                
                // æé«˜æ¸¸æˆéš¾åº¦
                clearInterval(bubbleInterval);
                const intervalTime = Math.max(200, 800 - (level * 50));
                bubbleInterval = setInterval(createLotusBubble, intervalTime);
            }
        }
        
        // è§¦å‘èŠ±ç“£é›¨ç‰¹æ•ˆ
        function triggerPetalFall() {
            const petalCount = 15;
            
            for (let i = 0; i < petalCount; i++) {
                setTimeout(() => {
                    const petal = document.createElement('div');
                    petal.classList.add('petal-fall');
                    petal.innerHTML = 'ğŸŒ¸';
                    
                    // éšæœºæ°´å¹³ä½ç½®
                    const leftPos = Math.random() * 100;
                    petal.style.left = `${leftPos}%`;
                    
                    // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                    petal.style.animationDelay = `${Math.random() * 0.5}s`;
                    
                    // éšæœºå¤§å°
                    const size = Math.random() * 1.5 + 0.8;
                    petal.style.fontSize = `${size}rem`;
                    
                    document.body.appendChild(petal);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤èŠ±ç“£
                    setTimeout(() => {
                        if (petal.parentNode) {
                            petal.remove();
                        }
                    }, 3000);
                }, i * 100);
            }
        }
        
        // æ˜¾ç¤ºè¿å‡»æ•ˆæœ
        function showCombo(count) {
            const comboTexts = ['æ¼‚äº®!', 'å‰å®³!', 'å¤ªæ£’äº†!', 'æƒŠäºº!', 'æ— æ•Œ!'];
            const textIndex = Math.min(count - 3, comboTexts.length - 1);
            comboIndicator.textContent = `${count} è¿å‡»! ${comboTexts[textIndex]}`;
            comboIndicator.classList.remove('combo-show');
            setTimeout(() => {
                comboIndicator.classList.add('combo-show');
            }, 10);
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameActive) return;
            
            gameActive = true;
            gamePaused = false;
            
            // å¯åŠ¨è®¡æ—¶å™¨
            timerInterval = setInterval(() => {
                if (!gamePaused) {
                    timeLeft--;
                    timerElement.textContent = timeLeft;
                    
                    // æ—¶é—´ç»“æŸ
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);
            
            // å¼€å§‹ç”Ÿæˆæ³¡æ³¡
            const intervalTime = Math.max(200, 800 - (level * 50));
            bubbleInterval = setInterval(createLotusBubble, intervalTime);
            
            // åˆå§‹ç”Ÿæˆä¸€äº›æ³¡æ³¡
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createLotusBubble(), i * 200);
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœæ¸¸æˆ';
            startBtn.classList.remove('btn-start');
            startBtn.classList.add('btn-pause');
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            if (!isMuted) {
                bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
            }
        }
        
        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (!gameActive || gamePaused) return;
            
            gamePaused = true;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­æ¸¸æˆ';
            startBtn.classList.remove('btn-pause');
            startBtn.classList.add('btn-start');
            
            // æš‚åœèƒŒæ™¯éŸ³ä¹
            bgMusic.pause();
        }
        
        // ç»§ç»­æ¸¸æˆï¼ˆä»æš‚åœçŠ¶æ€æ¢å¤ï¼‰
        function resumeGame() {
            if (!gameActive || !gamePaused) return;
            
            gamePaused = false;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœæ¸¸æˆ';
            startBtn.classList.remove('btn-start');
            startBtn.classList.add('btn-pause');
            
            // æ¢å¤èƒŒæ™¯éŸ³ä¹
            if (!isMuted) {
                bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ¢å¤å¤±è´¥:", e));
            }
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // æ¸…é™¤æ‰€æœ‰çŠ¶æ€
            gameActive = false;
            gamePaused = false;
            score = 0;
            timeLeft = 60;
            level = 1;
            comboCount = 0;
            lastTenTrigger = 0;
            
            // æ›´æ–°æ˜¾ç¤º
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
            levelElement.textContent = level;
            
            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
            clearInterval(timerInterval);
            clearInterval(bubbleInterval);
            
            // æ¸…é™¤æ‰€æœ‰æ³¡æ³¡
            const bubbles = document.querySelectorAll('.lotus-bubble');
            bubbles.forEach(bubble => bubble.remove());
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startBtn.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ';
            startBtn.classList.remove('btn-pause');
            startBtn.classList.add('btn-start');
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            bgMusic.pause();
            bgMusic.currentTime = 0;
        }
        
        // æ¸¸æˆç»“æŸ
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            clearInterval(bubbleInterval);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ';
            startBtn.classList.remove('btn-pause');
            startBtn.classList.add('btn-start');
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            bgMusic.pause();
            bgMusic.currentTime = 0;
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸä¿¡æ¯
            const gameOverMsg = document.createElement('div');
            gameOverMsg.style.position = 'absolute';
            gameOverMsg.style.top = '50%';
            gameOverMsg.style.left = '50%';
            gameOverMsg.style.transform = 'translate(-50%, -50%)';
            gameOverMsg.style.backgroundColor = 'rgba(0, 0, 0, 0.85)';
            gameOverMsg.style.color = 'white';
            gameOverMsg.style.padding = '25px';
            gameOverMsg.style.borderRadius = '20px';
            gameOverMsg.style.textAlign = 'center';
            gameOverMsg.style.zIndex = '50';
            gameOverMsg.style.width = '85%';
            gameOverMsg.style.maxWidth = '400px';
            gameOverMsg.innerHTML = `
                <h2 style="margin-bottom: 15px; color: #FFD166;">æ­å–œæ‚¨!</h2>
                <p style="font-size: 1.4rem; margin-bottom: 10px;">é‡‡é›†èŠ±æœµæ€»æ•°: <span style="color: #ff6b9d; font-weight: bold;">${score}</span></p>
                <p style="font-size: 1.1rem;">æœ€é«˜ç­‰çº§: <span style="color: #4CAF50; font-weight: bold;">${level}</span></p>
                <p style="font-size: 1.1rem; margin-bottom: 20px;">è§¦å‘èŠ±ç“£é›¨: <span style="color: #00a8cc; font-weight: bold;">${Math.floor(score/10)}</span> æ¬¡</p>
                <button id="playAgainBtn" style="margin-top: 10px; padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 50px; font-size: 1.1rem; cursor: pointer; width: 100%;">
                    <i class="fas fa-redo"></i> å†ç©ä¸€æ¬¡
                </button>
            `;
            
            gameArea.appendChild(gameOverMsg);
            
            // æ·»åŠ å†ç©ä¸€æ¬¡æŒ‰é’®äº‹ä»¶
            document.getElementById('playAgainBtn').addEventListener('click', () => {
                gameOverMsg.remove();
                resetGame();
                startGame();
            });
        }
        
        // é˜²æ­¢iOSä¸Šçš„åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´æ¸¸æˆåŒºåŸŸ
        window.addEventListener('resize', () => {
            // ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹è°ƒæ•´
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(() => {
                // é‡æ–°å®šä½ç°æœ‰çš„è·èŠ±æ³¡æ³¡
                const bubbles = document.querySelectorAll('.lotus-bubble');
                bubbles.forEach(bubble => {
                    if (!bubble.classList.contains('popped')) {
                        const size = parseInt(bubble.style.width);
                        const maxX = gameArea.clientWidth - size;
                        const maxY = gameArea.clientHeight - size;
                        
                        // å¦‚æœæ³¡æ³¡è¶…å‡ºè¾¹ç•Œï¼Œè°ƒæ•´ä½ç½®
                        const currentLeft = parseInt(bubble.style.left);
                        const currentTop = parseInt(bubble.style.top);
                        
                        if (currentLeft > maxX || currentTop > maxY) {
                            bubble.style.left = `${Math.min(currentLeft, maxX)}px`;
                            bubble.style.top = `${Math.min(currentTop, maxY)}px`;
                        }
                    }
                });
            }, 250);
        });
        
        // å¤„ç†iOSä¸Šçš„æ–¹å‘æ”¹å˜
        window.addEventListener('orientationchange', () => {
            // çŸ­æš‚å»¶è¿Ÿåé‡æ–°è°ƒæ•´å¸ƒå±€
            setTimeout(() => {
                // é‡æ–°å®šä½ç°æœ‰çš„è·èŠ±æ³¡æ³¡
                const bubbles = document.querySelectorAll('.lotus-bubble');
                bubbles.forEach(bubble => {
                    if (!bubble.classList.contains('popped')) {
                        const size = parseInt(bubble.style.width);
                        const maxX = gameArea.clientWidth - size;
                        const maxY = gameArea.clientHeight - size;
                        
                        // å¦‚æœæ³¡æ³¡è¶…å‡ºè¾¹ç•Œï¼Œè°ƒæ•´åˆ°éšæœºä½ç½®
                        const currentLeft = parseInt(bubble.style.left);
                        const currentTop = parseInt(bubble.style.top);
                        
                        if (currentLeft > maxX || currentTop > maxY) {
                            bubble.style.left = `${Math.floor(Math.random() * maxX)}px`;
                            bubble.style.top = `${Math.floor(Math.random() * maxY)}px`;
                        }
                    }
                });
            }, 300);
        });
        
        // è°ƒè¯•å‡½æ•°ï¼šæ£€æŸ¥èµ„æºçŠ¶æ€
        function checkResources() {
            console.log("=== èµ„æºçŠ¶æ€æ£€æŸ¥ ===");
            console.log("å½“å‰è·èŠ±å›¾ç‰‡æ•°ç»„:", currentLotusImages);
            console.log("æ¸¸æˆåŒºåŸŸå°ºå¯¸:", gameArea.clientWidth, "x", gameArea.clientHeight);
            console.log("éŸ³é¢‘å…ƒç´ çŠ¶æ€:");
            console.log("- bgMusic:", bgMusic.readyState);
            console.log("- popSound:", popSound.readyState);
            console.log("- effectSound:", effectSound.readyState);
        }
        
        // å¯é€‰ï¼šæ·»åŠ è°ƒè¯•æŒ‰é’®
        window.checkResources = checkResources;
    </script>
</body>
</html>