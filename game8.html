<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>å°„å‡»å¾—åˆ†æŒ‘æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 0;
            overflow: hidden;
            color: #fff;
            position: relative;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .game-container {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
        }
        
        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        /* æ›´å¤šæ¸¸æˆæŒ‰é’® */
        .more-games-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .more-games-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            filter: brightness(1.1);
        }
        
        .more-games-btn h2 {
            font-size: 1rem;
            color: #ffffff;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .more-games-label {
            font-size: 0.9rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        /* æ¸¸æˆè¯´æ˜ */
        .game-instructions {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
            max-width: 400px;
        }
        
        .game-instructions h3 {
            color: #ffd700;
            margin-bottom: 3px;
            font-size: 1.1rem;
        }
        
        .game-instructions p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            line-height: 1.3;
        }
        
        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .controls-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            border-radius: 50px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        /* å¼€å§‹/æš‚åœæŒ‰é’® */
        .start-pause-btn {
            padding: 14px 35px;
            font-size: 1.2rem;
            border: none;
            border-radius: 40px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 140px;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #00b09b 0%, #96c93d 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 176, 155, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .start-pause-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 176, 155, 0.6);
        }
        
        .start-pause-btn.paused {
            background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);
            box-shadow: 0 5px 15px rgba(255, 105, 97, 0.4);
        }
        
        .start-pause-btn:disabled {
            background: linear-gradient(90deg, #666 0%, #888 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* é™éŸ³å¼€å…³æŒ‰é’® */
        .mute-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4cc9f0 0%, #3a86ff 100%);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .mute-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.6);
        }
        
        .mute-btn.muted {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
        }
        
        .mute-btn.muted:hover {
            box-shadow: 0 8px 20px rgba(255, 65, 108, 0.6);
        }
        
        /* ä¿®æ”¹åçš„å¾—åˆ†æŒ‰é’® - ä¿æŒé™æ­¢ */
        .score-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 16px 40px;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            background: linear-gradient(135deg, #ffd700 0%, #ff9500 100%);
            color: #000;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.3);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
        }
        
        /* ä¿®æ”¹hoveræ•ˆæœï¼Œåªæ”¹å˜ç¼©æ”¾å’Œé˜´å½±ï¼Œä¸æ”¹å˜ä½ç½® */
        .score-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.7);
            filter: brightness(1.1);
        }
        
        .score-label {
            font-size: 1rem;
            color: #000;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-value-display {
            font-size: 2rem;
            font-weight: bold;
            color: #000;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .game-area {
            position: relative;
            width: 100%;
            height: 100%;
            flex: 1;
            overflow: hidden;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            position: relative;
            z-index: 1;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes petalFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        .petal, .confetti {
            position: absolute;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
        }
        
        .petal {
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ff416c, #ff4b2b, #ffd700, #00b09b);
            border-radius: 50% 50% 50% 0;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }
        
        .confetti {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
        }
        
        .bonus-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #ffd700;
            padding: 25px 50px;
            border-radius: 25px;
            font-size: 2.5rem;
            font-weight: bold;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.8);
            animation: bonusPulse 2s ease-out;
            display: none;
            border: 3px solid rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        @keyframes bonusPulse {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            60% { transform: translate(-50%, -50%) scale(0.95); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        /* å“åº”å¼è®¾è®¡ - ç”µè„‘å±å¹• */
        @media (min-width: 769px) {
            .game-container {
                max-width: 1200px;
                max-height: 800px;
                height: 90vh;
                border-radius: 25px;
                box-shadow: 0 25px 60px rgba(0, 0, 0, 0.9);
                margin: auto;
                border: 3px solid rgba(255, 215, 0, 0.3);
            }
            
            .top-bar {
                padding: 20px 30px;
            }
            
            .more-games-btn {
                padding: 12px 25px;
                min-width: 140px;
            }
            
            .more-games-btn h2 {
                font-size: 1.2rem;
            }
            
            .game-instructions {
                padding: 10px 25px;
                max-width: 500px;
            }
            
            .game-instructions h3 {
                font-size: 1.3rem;
            }
            
            .controls-container {
                padding: 18px 35px;
                gap: 25px;
                bottom: 30px;
            }
            
            .start-pause-btn {
                padding: 16px 40px;
                font-size: 1.3rem;
                min-width: 160px;
            }
            
            .mute-btn {
                width: 60px;
                height: 60px;
                font-size: 1.7rem;
            }
            
            .score-button {
                padding: 20px 50px;
                font-size: 1.8rem;
                min-width: 220px;
                transform: translate(-50%, -50%);
            }
            
            .score-button:hover {
                transform: translate(-50%, -50%) scale(1.05);
            }
            
            .score-label {
                font-size: 1.2rem;
            }
            
            .score-value-display {
                font-size: 2.5rem;
            }
            
            .bonus-notification {
                font-size: 3rem;
                padding: 30px 60px;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - iPhone/ç§»åŠ¨ç«¯ */
        @media (max-width: 768px) {
            .game-container {
                height: -webkit-fill-available;
                border-radius: 0;
            }
            
            .top-bar {
                padding: max(12px, env(safe-area-inset-top)) max(15px, env(safe-area-inset-left)) max(12px, env(safe-area-inset-bottom)) max(15px, env(safe-area-inset-right));
                flex-direction: row;
                gap: 10px;
                justify-content: space-between;
                align-items: center;
            }
            
            .more-games-btn {
                padding: 8px 15px;
                min-width: 100px;
                width: auto;
            }
            
            .more-games-btn h2 {
                font-size: 0.9rem;
            }
            
            .more-games-label {
                font-size: 0.8rem;
            }
            
            .game-instructions {
                padding: 6px 15px;
                max-width: 50%;
                flex: 1;
            }
            
            .game-instructions h3 {
                font-size: 1rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .game-instructions p {
                font-size: 0.85rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .controls-container {
                padding: 12px 25px;
                gap: 15px;
                bottom: max(20px, env(safe-area-inset-bottom));
                flex-direction: row;
            }
            
            /* å‡å°"ç»§ç»­æ¸¸æˆ"çš„æ–‡å­—å¤§å° */
            .start-pause-btn {
                padding: 12px 25px;
                font-size: 1rem;
                min-width: 120px;
            }
            
            .mute-btn {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .score-button {
                padding: 12px 30px;
                font-size: 1.2rem;
                min-width: 140px;
                transform: translate(-50%, -50%);
            }
            
            .score-button:hover {
                transform: translate(-50%, -50%) scale(1.05);
            }
            
            .score-label {
                font-size: 0.9rem;
            }
            
            .score-value-display {
                font-size: 1.5rem;
            }
            
            .bonus-notification {
                font-size: 2rem;
                padding: 20px 40px;
            }
        }
        
        /* é’ˆå¯¹iPhoneå°å±å¹•è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (max-width: 480px) {
            .controls-container {
                padding: 10px 20px;
                gap: 12px;
            }
            
            /* è¿›ä¸€æ­¥å‡å°"ç»§ç»­æ¸¸æˆ"çš„æ–‡å­—å¤§å° */
            .start-pause-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
                min-width: 100px;
            }
            
            .mute-btn {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
            
            .top-bar {
                padding: max(10px, env(safe-area-inset-top)) 10px max(10px, env(safe-area-inset-bottom));
            }
            
            .more-games-btn {
                min-width: 90px;
                padding: 6px 12px;
            }
            
            .more-games-btn h2 {
                font-size: 0.8rem;
            }
            
            .more-games-label {
                font-size: 0.7rem;
            }
            
            .game-instructions {
                max-width: 45%;
            }
            
            .game-instructions h3 {
                font-size: 0.9rem;
            }
            
            .game-instructions p {
                font-size: 0.8rem;
            }
            
            .score-button {
                padding: 10px 25px;
                font-size: 1rem;
                min-width: 120px;
                transform: translate(-50%, -50%);
            }
            
            .score-button:hover {
                transform: translate(-50%, -50%) scale(1.05);
            }
            
            .score-label {
                font-size: 0.8rem;
            }
            
            .score-value-display {
                font-size: 1.3rem;
            }
        }
        
        /* é’ˆå¯¹éå¸¸å°çš„iPhoneå±å¹• */
        @media (max-width: 360px) {
            .top-bar {
                padding: 8px;
            }
            
            .more-games-btn {
                padding: 5px 10px;
                min-width: 85px;
            }
            
            .more-games-btn h2 {
                font-size: 0.75rem;
            }
            
            .more-games-label {
                font-size: 0.65rem;
            }
            
            .game-instructions {
                padding: 5px 8px;
                max-width: 45%;
            }
            
            .game-instructions h3 {
                font-size: 0.8rem;
            }
            
            .game-instructions p {
                font-size: 0.7rem;
            }
            
            /* è¿›ä¸€æ­¥å‡å°"ç»§ç»­æ¸¸æˆ"çš„æ–‡å­—å¤§å° */
            .start-pause-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
                min-width: 90px;
            }
            
            .score-button {
                padding: 8px 20px;
                font-size: 0.9rem;
                min-width: 110px;
                transform: translate(-50%, -50%);
            }
            
            .score-button:hover {
                transform: translate(-50%, -50%) scale(1.05);
            }
            
            .score-label {
                font-size: 0.75rem;
            }
            
            .score-value-display {
                font-size: 1.2rem;
            }
        }
        
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
            
            .game-container {
                height: -webkit-fill-available;
            }
        }
        
        /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* é˜²æ­¢é•¿æŒ‰å¼¹å‡ºèœå• */
        button, canvas, a {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        /* æŒ‰é’®å…‰æ™•æ•ˆæœ */
        .start-pause-btn:hover,
        .mute-btn:hover,
        .more-games-btn:hover,
        .score-button:hover {
            filter: brightness(1.2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="top-bar">
            <!-- æ›´å¤šæ¸¸æˆæŒ‰é’® -->
            <a href="https://game.amitofo.icu" class="more-games-btn">
                <h2>æ›´å¤šæ¸¸æˆ</h2>
                <span class="more-games-label"></span>
            </a>
            
            <!-- æ¸¸æˆè¯´æ˜ -->
            <div class="game-instructions">
                <h3>å°„å‡»å¾—åˆ†æŒ‘æˆ˜</h3>
                <p>çº¢è‰²5åˆ† | è“è‰²3åˆ† | ç»¿è‰²1åˆ†</p>
            </div>
        </div>
        
        <!-- æ–°å¢çš„å¾—åˆ†æŒ‰é’® -->
        <button id="scoreBtn" class="score-button">
            <span class="score-label">å½“å‰å¾—åˆ†</span>
            <span class="score-value-display" id="currentScore">0</span>
        </button>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div class="controls-container">
            <!-- å¼€å§‹/æš‚åœæŒ‰é’® -->
            <button id="startBtn" class="start-pause-btn">å¼€å§‹</button>
            
            <!-- é™éŸ³å¼€å…³æŒ‰é’® -->
            <button id="muteBtn" class="mute-btn">â™ª</button>
        </div>
    </div>

    <!-- å¥–åŠ±é€šçŸ¥ -->
    <div id="bonusNotification" class="bonus-notification">
        æ­å–œï¼åŠ æ²¹ï¼
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="bgMusic" preload="auto" loop>
        <source src="beijing.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>
    
    <audio id="effectSound" preload="auto">
        <source src="xiaochu.ogg" type="audio/ogg">
        <source src="xiaochu.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>
    
    <audio id="winSound" preload="auto">
        <source src="win.mp3" type="audio/mpeg">
        <source src="win.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // è·å–UIå…ƒç´ 
        const scoreBtn = document.getElementById('scoreBtn');
        const currentScoreElement = document.getElementById('currentScore');
        const startBtn = document.getElementById('startBtn');
        const muteBtn = document.getElementById('muteBtn');
        const bgMusic = document.getElementById('bgMusic');
        const effectSound = document.getElementById('effectSound');
        const winSound = document.getElementById('winSound');
        const bonusNotification = document.getElementById('bonusNotification');
        
        // æ¸¸æˆå˜é‡
        let score = 0;
        let gameRunning = false;
        let gamePaused = false;
        let targets = [];
        let animationId;
        let lastHundredScore = 0;
        let petals = [];
        let confetti = [];
        let soundEnabled = true; // å£°éŸ³æ˜¯å¦å¯ç”¨
        const MAX_TARGETS = 10; // å§‹ç»ˆä¿æŒ10ä¸ªç›®æ ‡
        
        // iOSéŸ³é¢‘çŠ¶æ€
        let iosAudioUnlocked = false;
        let iosAudioInitialized = false;
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        // æ”¹è¿›çš„éŸ³é¢‘é¢„åŠ è½½å‡½æ•°
        function preloadAudio() {
            console.log("å¼€å§‹é¢„åŠ è½½éŸ³é¢‘...");
            
            // è®¾ç½®éŸ³é¢‘å±æ€§
            bgMusic.preload = "auto";
            effectSound.preload = "auto";
            winSound.preload = "auto";
            
            bgMusic.load();
            effectSound.load();
            winSound.load();
            
            // iOSç‰¹æ®Šå¤„ç†
            if (isIOS) {
                console.log("æ£€æµ‹åˆ°iOSè®¾å¤‡ï¼Œåº”ç”¨ç‰¹æ®ŠéŸ³é¢‘å¤„ç†");
                applyIOSAudioFix();
            }
            
            startBtn.disabled = false;
            console.log("éŸ³é¢‘é¢„åŠ è½½å®Œæˆ");
        }
        
        // iOSéŸ³é¢‘ä¿®å¤
        function applyIOSAudioFix() {
            // iOSéœ€è¦ç‰¹æ®Šçš„éŸ³é¢‘å¤„ç†
            bgMusic.volume = 0.5;
            effectSound.volume = 0.7;
            winSound.volume = 0.7;
            
            // iOSéŸ³é¢‘è§£é”æœºåˆ¶
            document.addEventListener('touchstart', unlockIOSAudio, { once: true });
            document.addEventListener('touchend', unlockIOSAudio, { once: true });
            document.addEventListener('click', unlockIOSAudio, { once: true });
            
            // ç¡®ä¿æ‰€æœ‰éŸ³é¢‘å…ƒç´ éƒ½æœ‰æ­£ç¡®çš„æ¥æº
            fixAudioSources();
        }
        
        // ä¿®å¤éŸ³é¢‘æºä»¥ç¡®ä¿å…¼å®¹æ€§
        function fixAudioSources() {
            const audioSources = {
                'bgMusic': ['beijing.mp3', 'beijing.ogg'],
                'effectSound': ['xiaochu.mp3', 'xiaochu.ogg'],
                'winSound': ['win.mp3', 'win.ogg']
            };
            
            Object.keys(audioSources).forEach(audioId => {
                const audio = document.getElementById(audioId);
                if (audio && audio.children.length === 0) {
                    // å¦‚æœéŸ³é¢‘å…ƒç´ æ²¡æœ‰å­å…ƒç´ ï¼Œæ·»åŠ æº
                    audioSources[audioId].forEach(src => {
                        const source = document.createElement('source');
                        const extension = src.split('.').pop();
                        source.src = src;
                        source.type = `audio/${extension === 'mp3' ? 'mpeg' : extension}`;
                        audio.appendChild(source);
                    });
                }
            });
        }
        
        // iOSéŸ³é¢‘è§£é”
        function unlockIOSAudio() {
            if (!iosAudioUnlocked && isIOS) {
                console.log("è§£é”iOSéŸ³é¢‘...");
                
                // åˆ›å»ºå¹¶æ’­æ”¾ä¸€ä¸ªé™éŸ³éŸ³é¢‘æ¥è§£é”
                const silentAudio = new Audio();
                silentAudio.volume = 0.01;
                
                // å°è¯•æ’­æ”¾é™éŸ³éŸ³é¢‘
                silentAudio.play().then(() => {
                    silentAudio.pause();
                    iosAudioUnlocked = true;
                    console.log("iOSéŸ³é¢‘è§£é”æˆåŠŸ");
                    
                    // é¢„åŠ è½½å®é™…éŸ³é¢‘
                    forceLoadAllAudio();
                }).catch(e => {
                    console.log("iOSéŸ³é¢‘è§£é”å¤±è´¥:", e);
                    
                    // ä»ç„¶å°è¯•åŠ è½½éŸ³é¢‘
                    forceLoadAllAudio();
                });
            }
        }
        
        // å¼ºåˆ¶åŠ è½½æ‰€æœ‰éŸ³é¢‘
        function forceLoadAllAudio() {
            const audioElements = [bgMusic, effectSound, winSound];
            
            audioElements.forEach((audio, index) => {
                setTimeout(() => {
                    try {
                        audio.load();
                        console.log(`åŠ è½½éŸ³é¢‘ ${index + 1}`);
                    } catch (e) {
                        console.log(`åŠ è½½éŸ³é¢‘ ${index + 1} å¤±è´¥:`, e);
                    }
                }, index * 100); // å»¶è¿ŸåŠ è½½ä»¥é¿å…å†²çª
            });
        }
        
        // æ”¹è¿›çš„iOSéŸ³é¢‘æ’­æ”¾
        function playIOSAudio(audioElement) {
            if (!soundEnabled || !audioElement) return;
            
            if (isIOS) {
                // iOSç‰¹æ®Šå¤„ç†
                audioElement.currentTime = 0;
                
                const playPromise = audioElement.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(e => {
                        console.log("iOSéŸ³é¢‘æ’­æ”¾å¤±è´¥:", e);
                        // å¦‚æœæ’­æ”¾å¤±è´¥ï¼Œå°è¯•è§£é”éŸ³é¢‘
                        if (!iosAudioUnlocked) {
                            unlockIOSAudio();
                        }
                    });
                }
            } else {
                // éiOSè®¾å¤‡æ­£å¸¸æ’­æ”¾
                audioElement.currentTime = 0;
                audioElement.play().catch(e => {
                    console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥:", e);
                });
            }
        }
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            const gameArea = canvas.parentElement;
            const rect = gameArea.getBoundingClientRect();
            
            canvas.width = Math.floor(rect.width);
            canvas.height = Math.floor(rect.height);
            
            console.log(`Canvaså°ºå¯¸: ${canvas.width}x${canvas.height}`);
            
            // å¦‚æœæ¸¸æˆæ­£åœ¨è¿è¡Œï¼Œè°ƒæ•´ç›®æ ‡ä½ç½®
            if (gameRunning && targets.length > 0) {
                const oldWidth = canvas.dataset.oldWidth ? parseInt(canvas.dataset.oldWidth) : canvas.width;
                const oldHeight = canvas.dataset.oldHeight ? parseInt(canvas.dataset.oldHeight) : canvas.height;
                
                if (oldWidth !== canvas.width || oldHeight !== canvas.height) {
                    const scaleX = canvas.width / oldWidth;
                    const scaleY = canvas.height / oldHeight;
                    
                    targets.forEach(target => {
                        target.x = target.x * scaleX;
                        target.y = target.y * scaleY;
                        target.x = Math.max(target.radius, Math.min(canvas.width - target.radius, target.x));
                        target.y = Math.max(target.radius, Math.min(canvas.height - target.radius, target.y));
                    });
                }
            }
            
            canvas.dataset.oldWidth = canvas.width;
            canvas.dataset.oldHeight = canvas.height;
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            score = 0;
            targets = [];
            petals = [];
            confetti = [];
            lastHundredScore = 0;
            gamePaused = false;
            
            currentScoreElement.textContent = score;
            
            cancelAnimationFrame(animationId);
            
            gameRunning = false;
            
            resizeCanvas();
            createInitialTargets();
            
            startBtn.textContent = "å¼€å§‹";
            startBtn.classList.remove('paused');
            startBtn.disabled = false;
            
            drawGame();
        }
        
        // åˆ›å»ºåˆå§‹ç›®æ ‡
        function createInitialTargets() {
            targets = [];
            
            for (let i = 0; i < MAX_TARGETS; i++) {
                createTarget();
            }
        }
        
        // åˆ›å»ºå•ä¸ªç›®æ ‡
        function createTarget() {
            if (targets.length >= MAX_TARGETS) {
                return;
            }
            
            const minScreen = Math.min(canvas.width, canvas.height);
            const minRadius = minScreen * 0.03;
            const maxRadius = minScreen * 0.06;
            const radius = minRadius + Math.random() * (maxRadius - minRadius);
            
            const colors = [
                {color: '#ff416c', value: 5},
                {color: '#2575fc', value: 3},
                {color: '#96c93d', value: 1}
            ];
            
            const colorInfo = colors[Math.floor(Math.random() * colors.length)];
            
            const x = radius + Math.random() * (canvas.width - 2 * radius);
            const y = radius + Math.random() * (canvas.height - 2 * radius);
            
            const baseSpeed = minScreen * 0.001;
            const speed = baseSpeed + Math.random() * baseSpeed;
            const angle = Math.random() * Math.PI * 2;
            
            targets.push({
                x, y, radius,
                color: colorInfo.color,
                value: colorInfo.value,
                speedX: Math.cos(angle) * speed,
                speedY: Math.sin(angle) * speed,
                id: Date.now() + Math.random()
            });
        }
        
        // ç»˜åˆ¶ç›®æ ‡
        function drawTarget(target) {
            ctx.beginPath();
            ctx.arc(target.x, target.y, target.radius, 0, Math.PI * 2);
            ctx.fillStyle = target.color;
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(target.x, target.y, target.radius * 0.7, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();
            
            ctx.fillStyle = '#000';
            const fontSize = Math.max(12, target.radius * 0.6);
            ctx.font = `bold ${fontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(target.value, target.x, target.y);
            
            ctx.beginPath();
            ctx.arc(target.x, target.y, target.radius * 1.1, 0, Math.PI * 2);
            ctx.strokeStyle = target.color;
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // ç»˜åˆ¶èŠ±ç“£å’Œå½©å¸¦
        function drawParticles() {
            // ç»˜åˆ¶èŠ±ç“£
            for (let i = petals.length - 1; i >= 0; i--) {
                const petal = petals[i];
                
                ctx.save();
                ctx.translate(petal.x, petal.y);
                ctx.rotate(petal.rotation);
                
                ctx.fillStyle = petal.color;
                ctx.beginPath();
                ctx.arc(0, 0, petal.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
                
                petal.y += petal.speed;
                petal.rotation += petal.rotationSpeed;
                petal.alpha -= 0.005;
                
                ctx.globalAlpha = petal.alpha;
                
                if (petal.y > canvas.height || petal.alpha <= 0) {
                    petals.splice(i, 1);
                }
            }
            
            // ç»˜åˆ¶å½©å¸¦
            for (let i = confetti.length - 1; i >= 0; i--) {
                const piece = confetti[i];
                
                ctx.save();
                ctx.translate(piece.x, piece.y);
                ctx.rotate(piece.rotation);
                
                ctx.fillStyle = piece.color;
                ctx.fillRect(-piece.width/2, -piece.height/2, piece.width, piece.height);
                
                ctx.restore();
                
                piece.x += piece.speedX;
                piece.y += piece.speedY;
                piece.rotation += piece.rotationSpeed;
                piece.alpha -= 0.004;
                
                ctx.globalAlpha = piece.alpha;
                
                if (piece.y > canvas.height || piece.alpha <= 0) {
                    confetti.splice(i, 1);
                }
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœ
        function createCelebrationEffect() {
            // åˆ›å»ºèŠ±ç“£
            for (let i = 0; i < 40; i++) {
                petals.push({
                    x: Math.random() * canvas.width,
                    y: -20,
                    size: 4 + Math.random() * 10,
                    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                    speed: 1 + Math.random() * 5,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.1,
                    alpha: 0.8 + Math.random() * 0.2
                });
            }
            
            // åˆ›å»ºå½©å¸¦
            for (let i = 0; i < 60; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: -10,
                    width: 6 + Math.random() * 8,
                    height: 6 + Math.random() * 8,
                    color: `hsl(${Math.random() * 360}, 90%, 55%)`,
                    speedX: (Math.random() - 0.5) * 3,
                    speedY: 2 + Math.random() * 4,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.15,
                    alpha: 0.9 + Math.random() * 0.1
                });
            }
            
            // æ’­æ”¾ç‰¹æ•ˆéŸ³æ•ˆ
            playEffectSound();
        }
        
        // æ˜¾ç¤ºå¥–åŠ±é€šçŸ¥
        function showBonusNotification() {
            bonusNotification.textContent = "æ­å–œï¼åŠ æ²¹ï¼";
            bonusNotification.style.display = 'block';
            
            setTimeout(() => {
                bonusNotification.style.display = 'none';
            }, 2000);
        }
        
        // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
        function playBackgroundMusic() {
            if (!soundEnabled) return;
            
            if (isIOS) {
                playIOSAudio(bgMusic);
            } else {
                bgMusic.play().catch(e => {
                    console.log("è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹è¢«é˜»æ­¢");
                });
            }
        }
        
        // æš‚åœèƒŒæ™¯éŸ³ä¹
        function pauseBackgroundMusic() {
            bgMusic.pause();
        }
        
        // ç»§ç»­æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆä»å½“å‰ä½ç½®ç»§ç»­ï¼‰
        function resumeBackgroundMusic() {
            if (!soundEnabled) return;
            
            if (isIOS) {
                playIOSAudio(bgMusic);
            } else {
                bgMusic.play().catch(e => {
                    console.log("ç»§ç»­æ’­æ”¾èƒŒæ™¯éŸ³ä¹è¢«é˜»æ­¢");
                });
            }
        }
        
        // åˆ‡æ¢å£°éŸ³çŠ¶æ€
        function toggleSound() {
            soundEnabled = !soundEnabled;
            
            if (soundEnabled) {
                muteBtn.textContent = "â™ª";
                muteBtn.classList.remove('muted');
                if (gameRunning && !gamePaused) {
                    // å¦‚æœæ¸¸æˆæ­£åœ¨è¿è¡Œä¸”æ²¡æœ‰æš‚åœï¼Œæ¢å¤èƒŒæ™¯éŸ³ä¹
                    resumeBackgroundMusic();
                }
            } else {
                muteBtn.textContent = "ğŸ”‡";
                muteBtn.classList.add('muted');
                // é™éŸ³æ—¶æš‚åœèƒŒæ™¯éŸ³ä¹
                pauseBackgroundMusic();
            }
        }
        
        // æ’­æ”¾ç‰¹æ•ˆéŸ³æ•ˆ
        function playEffectSound() {
            if (!soundEnabled) return;
            
            if (isIOS) {
                playIOSAudio(effectSound);
            } else {
                effectSound.currentTime = 0;
                effectSound.play().catch(e => {
                    console.log("ç‰¹æ•ˆéŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e);
                });
            }
        }
        
        // æ’­æ”¾å¾—åˆ†éŸ³æ•ˆ
        function playWinSound() {
            if (!soundEnabled) return;
            
            if (isIOS) {
                playIOSAudio(winSound);
            } else {
                winSound.currentTime = 0;
                winSound.play().catch(e => {
                    console.log("å¾—åˆ†éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e);
                });
            }
        }
        
        // æ›´æ–°ç›®æ ‡ä½ç½®
        function updateTargets() {
            for (let i = 0; i < targets.length; i++) {
                const target = targets[i];
                
                target.x += target.speedX;
                target.y += target.speedY;
                
                // è¾¹ç•Œæ£€æµ‹
                if (target.x - target.radius < 0 || target.x + target.radius > canvas.width) {
                    target.speedX *= -1;
                    target.x = target.x - target.radius < 0 ? target.radius : canvas.width - target.radius;
                }
                
                if (target.y - target.radius < 0 || target.y + target.radius > canvas.height) {
                    target.speedY *= -1;
                    target.y = target.y - target.radius < 0 ? target.radius : canvas.height - target.radius;
                }
            }
        }
        
        // ç»˜åˆ¶æ¸¸æˆ
        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ä½¿ç”¨æ¸å˜èƒŒæ™¯æ›¿ä»£å›¾ç‰‡èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0f0f23');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ ä¸€äº›æ˜Ÿæ˜Ÿæ•ˆæœ
            if (Math.random() < 0.1) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 2,
                    0, Math.PI * 2
                );
                ctx.fill();
            }
            
            drawParticles();
            
            targets.forEach(target => drawTarget(target));
            
            if (gameRunning && !gamePaused) {
                updateTargets();
                animationId = requestAnimationFrame(drawGame);
            }
        }
        
        // æ£€æµ‹å°„å‡»æ˜¯å¦å‘½ä¸­ç›®æ ‡
        function checkHit(x, y) {
            for (let i = targets.length - 1; i >= 0; i--) {
                const target = targets[i];
                const distance = Math.sqrt((x - target.x) ** 2 + (y - target.y) ** 2);
                
                if (distance < target.radius) {
                    playWinSound();
                    
                    score += target.value;
                    currentScoreElement.textContent = score;
                    
                    const currentHundred = Math.floor(score / 50);
                    if (currentHundred > lastHundredScore) {
                        lastHundredScore = currentHundred;
                        createCelebrationEffect();
                        showBonusNotification();
                    }
                    
                    targets.splice(i, 1);
                    
                    setTimeout(() => {
                        if (targets.length < MAX_TARGETS) {
                            createTarget();
                        }
                    }, 100);
                    
                    createClickEffect(x, y, target.color);
                    
                    return true;
                }
            }
            return false;
        }
        
        // åˆ›å»ºå°„å‡»æ•ˆæœ
        function createClickEffect(x, y, color) {
            let radius = 5;
            const maxRadius = 30;
            
            function drawRipple() {
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.stroke();
                
                radius += 2;
                
                if (radius < maxRadius) {
                    requestAnimationFrame(drawRipple);
                }
            }
            
            drawRipple();
        }
        
        // å¼€å§‹/æš‚åœæ¸¸æˆ
        function toggleGame() {
            if (!gameRunning) {
                // å¼€å§‹æ¸¸æˆ
                initGame();
                gameRunning = true;
                gamePaused = false;
                animationId = requestAnimationFrame(drawGame);
                startBtn.textContent = "æš‚åœ";
                startBtn.classList.remove('paused');
                startBtn.disabled = false;
                
                // å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                playBackgroundMusic();
            } else {
                // æš‚åœ/ç»§ç»­æ¸¸æˆ
                gamePaused = !gamePaused;
                
                if (gamePaused) {
                    startBtn.textContent = "ç»§ç»­";
                    startBtn.classList.add('paused');
                    
                    // æš‚åœæ¸¸æˆå¾ªç¯
                    cancelAnimationFrame(animationId);
                    
                    // æš‚åœèƒŒæ™¯éŸ³ä¹ï¼ˆä¸æ˜¯åœæ­¢ï¼‰
                    pauseBackgroundMusic();
                    
                    // æ˜¾ç¤ºæš‚åœçŠ¶æ€
                    drawPauseScreen();
                } else {
                    startBtn.textContent = "æš‚åœ";
                    startBtn.classList.remove('paused');
                    
                    // ç»§ç»­æ¸¸æˆå¾ªç¯
                    animationId = requestAnimationFrame(drawGame);
                    
                    // ç»§ç»­æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆä»æš‚åœçš„ä½ç½®ç»§ç»­ï¼‰
                    resumeBackgroundMusic();
                }
            }
        }
        
        // ç»˜åˆ¶æš‚åœå±å¹•
        function drawPauseScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('æ¸¸æˆæš‚åœ', canvas.width / 2, canvas.height / 2 - 30);
            
            ctx.fillStyle = '#4cc9f0';
            ctx.font = 'bold 20px Arial';
            ctx.fillText('ç‚¹å‡»"ç»§ç»­"æŒ‰é’®ç»§ç»­', canvas.width / 2, canvas.height / 2 + 20);
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', toggleGame);
        muteBtn.addEventListener('click', toggleSound);
        
        // å¾—åˆ†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆåªæ˜¯æ˜¾ç¤ºå½“å‰å¾—åˆ†ï¼Œä¸åšå…¶ä»–æ“ä½œï¼‰
        scoreBtn.addEventListener('click', () => {
            // å¯ä»¥æ·»åŠ ä¸€äº›è§†è§‰åé¦ˆæ•ˆæœ
            scoreBtn.classList.add('pulse');
            setTimeout(() => {
                scoreBtn.classList.remove('pulse');
            }, 300);
        });
        
        // å¤„ç†Canvasç‚¹å‡»
        canvas.addEventListener('click', (e) => {
            if (!gameRunning || gamePaused) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            checkHit(x, y);
        });
        
        // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
        canvas.addEventListener('touchstart', (e) => {
            if (!gameRunning || gamePaused) return;
            
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const touch = e.touches[0];
            const x = (touch.clientX - rect.left) * scaleX;
            const y = (touch.clientY - rect.top) * scaleY;
            
            checkHit(x, y);
        }, { passive: false });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´Canvas
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                console.log("çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´Canvas");
                resizeCanvas();
                if (gameRunning && !gamePaused) {
                    drawGame();
                }
            }, 250);
        });
        
        // åˆå§‹åŠ è½½æ—¶è°ƒæ•´Canvas
        window.addEventListener('load', () => {
            console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–Canvas");
            resizeCanvas();
            initGame();
            preloadAudio();
        });
        
        // é˜²æ­¢iOSåŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // é˜²æ­¢iOSæ©¡çš®ç­‹æ•ˆæœ
        document.body.addEventListener('touchmove', function (e) {
            if (e.target === canvas) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // åˆå§‹åŒ–
        startBtn.disabled = true;
    </script>
</body>
</html>