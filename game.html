<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¿„ç½—æ–¯æ–¹å—</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation; /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
        }

        :root {
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.85) 0%, rgba(52, 73, 94, 0.85) 100%), 
                        url('lianchi.jpg') center center fixed;
            background-size: cover;
            color: #fff;
            height: 100vh;
            height: calc(100vh - var(--safe-area-inset-bottom));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 10px;
            padding-bottom: calc(10px + var(--safe-area-inset-bottom));
            position: relative;
            overscroll-behavior: contain; /* é˜²æ­¢è¿‡åº¦æ»šåŠ¨ */
        }

        /* å·¦ä¸Šè§’é˜¿å¼¥é™€ä½›è§’æ ‡ */
        .buddha-corner {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .buddha-corner a {
            color: #FFD700;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        .buddha-corner a:hover {
            color: #FFFFFF;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            transform: scale(1.05);
        }

        .buddha-corner i {
            margin-right: 8px;
            font-size: 16px;
        }

        /* æ–°å¢ï¼šæ›´å¤šæ¸¸æˆè§’æ ‡ */
        .more-games-corner {
            position: absolute;
            top: 20px;
            left: 160px; /* æ”¾åœ¨é˜¿å¼¥é™€ä½›è§’æ ‡çš„å³è¾¹ */
            z-index: 100;
            background: rgba(255, 105, 180, 0.8); /* ç²‰è‰²èƒŒæ™¯ */
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #FF1493;
            box-shadow: 0 0 15px rgba(255, 20, 147, 0.6);
            backdrop-filter: blur(5px);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 20, 147, 0.8);
            }
            100% {
                box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
            }
        }

        .more-games-corner a {
            color: #FFFFFF;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        .more-games-corner a:hover {
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            transform: scale(1.05);
        }

        .more-games-corner i {
            margin-right: 8px;
            font-size: 16px;
        }

        /* è¯—è¯æç¤ºæ ·å¼ - åœ¨å·¦ä¾§ */
        .poem-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            text-align: left;
            z-index: 1;
            opacity: 0.7;
            transition: opacity 0.3s;
            max-width: 300px;
        }

        .poem-container:hover {
            opacity: 1;
        }

        .poem-content {
            font-size: 12px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .poem-title {
            font-size: 10px;
            color: #ffcc00;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .poem-line {
            margin-bottom: 4px;
            animation: fadeIn 2s ease-out;
        }

        .poem-line:nth-child(2) { animation-delay: 0.2s; }
        .poem-line:nth-child(3) { animation-delay: 0.4s; }
        .poem-line:nth-child(4) { animation-delay: 0.6s; }
        .poem-line:nth-child(5) { animation-delay: 0.8s; }
        .poem-line:nth-child(6) { animation-delay: 1s; }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* å¤©èŠ±æ•£è½åŠ¨ç”»å®¹å™¨ */
        .flower-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .flower {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
            background-size: contain;
            background-repeat: no-repeat;
        }

        /* æ¸¸æˆä¸»è¦å†…å®¹æ ·å¼ */
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 100%;
            width: 100%;
            height: 100%;
            max-height: 100%;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
            width: 100%;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: clamp(24px, 5vw, 28px);
            color: #ffcc00;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: clamp(10px, 2.5vw, 12px);
            color: #e0e0e0;
            margin-bottom: 3px;
            font-weight: bold;
        }

        .stat-value {
            font-size: clamp(18px, 5vw, 24px);
            font-weight: bold;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .game-board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            flex: 1;
            min-height: 0;
        }

        .next-piece-container {
            margin-bottom: 10px;
            text-align: center;
            flex-shrink: 0;
        }

        .next-piece-label {
            font-size: clamp(14px, 3.5vw, 16px);
            color: #ffffff;
            margin-bottom: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .next-piece-canvas {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 3px solid #4CAF50;
            width: 80px;
            height: 80px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .main-game {
            display: flex;
            justify-content: center;
            width: 100%;
            flex: 1;
            min-height: 0;
        }

        .game-canvas-container {
            position: relative;
            margin: 0 5px;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 70vh;
        }

        #gameCanvas {
            display: block;
            background: #ffffff;
            border-radius: 12px;
            border: 4px solid #ffcc00;
            box-shadow: 0 0 25px rgba(255, 204, 0, 0.4), 
                        0 8px 20px rgba(0, 0, 0, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.8);
            width: 100%;
            height: 100%;
            max-width: 300px;
            max-height: 600px;
            object-fit: contain;
        }

        .controls-container {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            flex-shrink: 0;
            padding-bottom: var(--safe-area-inset-bottom);
        }

        .top-controls {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-bottom: 8px;
        }

        .control-button {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 50px;
            padding: clamp(8px, 2vw, 12px) clamp(16px, 4vw, 24px);
            font-size: clamp(14px, 3.5vw, 18px);
            font-weight: bold;
            margin: 0 5px;
            cursor: pointer;
            box-shadow: 0 4px 0 #388E3C, 0 6px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            flex: 1;
            max-width: 120px;
            white-space: nowrap;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #388E3C, 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .control-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #388E3C, 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .control-button.pause {
            background: linear-gradient(145deg, #FF9800, #F57C00);
            box-shadow: 0 4px 0 #E65100, 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        /* ç¦…æ„è§£å¯†æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .control-button.zen {
            background: linear-gradient(145deg, #9C27B0, #7B1FA2);
            box-shadow: 0 4px 0 #4A148C, 0 6px 12px rgba(0, 0, 0, 0.2);
            max-width: 140px;
        }

        .control-button.zen:hover {
            box-shadow: 0 6px 0 #4A148C, 0 8px 16px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .control-button.zen:active {
            box-shadow: 0 0 0 #4A148C, 0 2px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(4px);
        }

        .sound-control {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            box-shadow: 0 4px 0 #0D47A1;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
            flex-shrink: 0;
        }

        .sound-control:active {
            transform: scale(0.95);
        }

        .mobile-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 5px;
        }

        .dpad-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            width: clamp(150px, 38vw, 190px);
            height: clamp(100px, 25vw, 130px);
            margin: 0 auto;
        }

        .dpad-button {
            background: linear-gradient(145deg, #5C6BC0, #3F51B5);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: clamp(20px, 5vw, 26px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #283593, 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .dpad-button:active {
            background: linear-gradient(145deg, #7986CB, #5C6BC0);
            transform: scale(0.95);
            box-shadow: 0 2px 0 #283593, 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .dpad-button.left {
            grid-column: 1;
            grid-row: 1;
        }

        .dpad-button.center {
            grid-column: 2;
            grid-row: 1;
            background: linear-gradient(145deg, #9C27B0, #7B1FA2);
            box-shadow: 0 4px 0 #4A148C, 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .dpad-button.right {
            grid-column: 3;
            grid-row: 1;
        }

        .dpad-button.down {
            grid-column: 2;
            grid-row: 2;
        }

        /* ç§»é™¤æ•´ä¸ªæ—‹è½¬æŒ‰é’®å®¹å™¨ */
        .rotate-button-container {
            display: none;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            z-index: 10;
            padding: 20px;
            border: 4px solid #ff3333;
        }

        .perfect-game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            z-index: 11;
            padding: 20px;
            border: 4px solid #00ff00;
            animation: perfectGlow 2s infinite alternate;
        }

        @keyframes perfectGlow {
            0% {
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
                border-color: #00ff00;
            }
            100% {
                box-shadow: 0 0 40px rgba(0, 255, 0, 0.8);
                border-color: #00ffcc;
            }
        }

        .perfect-game-over h2 {
            font-size: clamp(24px, 6vw, 32px);
            color: #00ff00;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
            animation: textGlow 1.5s infinite alternate;
        }

        @keyframes textGlow {
            0% {
                text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 20px rgba(0, 255, 0, 1);
                transform: scale(1.05);
            }
        }

        .perfect-game-over p {
            font-size: clamp(18px, 4.5vw, 24px);
            margin-bottom: 25px;
            text-align: center;
            color: #ffffff;
            font-weight: bold;
        }

        .perfect-game-over .perfect-score {
            font-size: clamp(24px, 6vw, 32px);
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
            margin: 10px 0;
        }

        /* æ–°å¢ï¼šæ— ç©·ç¬¦å·åŠ¨ç”»æ ·å¼ */
        .infinity-symbol {
            font-size: clamp(36px, 8vw, 48px);
            color: #00ff00;
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.9);
            margin: 15px 0;
            font-weight: bold;
            animation: infinityGlow 2s infinite alternate;
            position: relative;
        }

        @keyframes infinityGlow {
            0% {
                text-shadow: 0 0 10px rgba(0, 255, 0, 0.8), 0 0 20px rgba(0, 255, 0, 0.6);
                transform: scale(1);
            }
            50% {
                text-shadow: 0 0 15px rgba(0, 255, 0, 1), 0 0 30px rgba(0, 255, 0, 0.8), 0 0 45px rgba(0, 255, 0, 0.6);
                transform: scale(1.1);
            }
            100% {
                text-shadow: 0 0 20px rgba(0, 255, 0, 0.9), 0 0 40px rgba(0, 255, 0, 0.7);
                transform: scale(1.05);
            }
        }

        .game-over p {
            font-size: clamp(16px, 4vw, 20px);
            margin-bottom: 20px;
            text-align: center;
            color: #ffffff;
        }

        /* ä¿®å¤iPhone XåŠä»¥ä¸Šæœºå‹çš„å®‰å…¨åŒºåŸŸé—®é¢˜ */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
                padding-top: max(10px, env(safe-area-inset-top));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            
            .controls-container {
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }
            
            .poem-container {
                left: max(20px, env(safe-area-inset-left));
                bottom: max(20px, env(safe-area-inset-bottom));
            }
            
            .buddha-corner {
                left: max(20px, env(safe-area-inset-left));
                top: max(20px, env(safe-area-inset-top));
            }
            
            .more-games-corner {
                left: max(160px, calc(160px + env(safe-area-inset-left)));
                top: max(20px, env(safe-area-inset-top));
            }
        }

        /* iPhone æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 600px) {
            .game-container {
                flex-direction: row;
                justify-content: space-between;
                padding: 5px;
            }
            
            .header {
                margin-bottom: 0;
                margin-right: 10px;
                width: auto;
                max-width: 25%;
            }
            
            .stats {
                flex-direction: column;
                width: auto;
                padding: 8px;
                margin-bottom: 0;
                margin-right: 10px;
            }
            
            .stat-item {
                margin-bottom: 8px;
            }
            
            .stat-item:last-child {
                margin-bottom: 0;
            }
            
            .game-area {
                flex-direction: row;
                height: 100%;
                width: auto;
                flex: 1;
            }
            
            .game-board-container {
                flex-direction: row;
                max-width: none;
                margin-right: 10px;
            }
            
            .next-piece-container {
                margin-bottom: 0;
                margin-right: 10px;
                align-self: flex-start;
                margin-top: 20px;
            }
            
            .main-game {
                flex: 1;
                height: 100%;
            }
            
            .game-canvas-container {
                margin: 0;
                height: 100%;
                max-height: 100%;
            }
            
            #gameCanvas {
                max-width: none;
                max-height: 100%;
            }
            
            .controls-container {
                margin-top: 0;
                margin-left: 10px;
                width: auto;
                max-width: 35%;
                height: 100%;
                justify-content: center;
            }
            
            .top-controls {
                flex-direction: column;
                margin-bottom: 15px;
            }
            
            .control-button {
                margin: 5px 0;
                max-width: 100%;
                width: 100%;
            }
            
            .mobile-controls {
                flex-direction: column;
                height: auto;
            }
            
            .dpad-controls {
                width: clamp(110px, 28vw, 150px);
                height: clamp(80px, 20vw, 110px);
                margin: 10px 0;
            }
            
            .rotate-button {
                width: clamp(80px, 20vw, 100px);
                height: clamp(80px, 20vw, 100px);
                font-size: clamp(16px, 4vw, 20px);
            }
            
            .poem-container {
                left: 10px;
                bottom: 10px;
                max-width: 200px;
            }
            
            .poem-content {
                font-size: 10px;
                padding: 8px;
            }
            
            .buddha-corner {
                left: 10px;
                top: 10px;
                padding: 6px 12px;
            }
            
            .buddha-corner a {
                font-size: 12px;
            }
            
            .more-games-corner {
                left: 140px;
                top: 10px;
                padding: 6px 12px;
            }
            
            .more-games-corner a {
                font-size: 12px;
            }
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-height: 700px) {
            .game-canvas-container {
                max-height: 60vh;
            }
            
            .controls-container {
                margin-top: 5px;
            }
            
            .poem-container {
                display: none;
            }
        }

        /* è¶…å°å±å¹•æ¨ªå‘ */
        @media (orientation: landscape) and (max-height: 400px) {
            .header h1 {
                font-size: clamp(16px, 4vw, 20px);
            }
            
            .stat-value {
                font-size: clamp(14px, 3.5vw, 18px);
            }
            
            .next-piece-container {
                display: none;
            }
            
            .control-button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .dpad-controls {
                width: 90px;
                height: 60px;
                gap: 4px;
            }
            
            .dpad-button {
                font-size: 16px;
                border-radius: 10px;
            }
            
            .rotate-button {
                width: 60px;
                height: 60px;
                font-size: 14px;
                margin: 2px;
            }
            
            .poem-container {
                display: none;
            }
            
            .buddha-corner {
                padding: 4px 8px;
            }
            
            .buddha-corner a {
                font-size: 10px;
            }
            
            .buddha-corner i {
                font-size: 12px;
                margin-right: 4px;
            }
            
            .more-games-corner {
                left: 120px;
                padding: 4px 8px;
            }
            
            .more-games-corner a {
                font-size: 10px;
            }
        }

        /* ç§»åŠ¨è®¾å¤‡å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .more-games-corner {
                left: 140px;
                padding: 6px 10px;
            }
            
            .more-games-corner a {
                font-size: 12px;
            }
            
            .more-games-corner i {
                font-size: 14px;
                margin-right: 4px;
            }
        }

        /* è¶…å°å®½åº¦å±å¹• */
        @media (max-width: 360px) {
            .more-games-corner {
                left: 120px;
                padding: 4px 8px;
            }
            
            .more-games-corner a {
                font-size: 10px;
            }
            
            .more-games-corner i {
                font-size: 12px;
                margin-right: 3px;
            }
        }
    </style>
</head>
<body>
    <!-- å¤©èŠ±æ•£è½åŠ¨ç”»å®¹å™¨ -->
    <div class="flower-container" id="flowerContainer"></div>


    <div class="buddha-corner">
        <a href="https://game.amitofo.icu">
            <i class="fas fa-praying-hands"></i> æ›´å¤šæ¸¸æˆ
        </a>
    </div>


    <div class="game-container">
        <div class="header">
            <h1><i class="fas fa-gamepad"></i> ä¿„ç½—æ–¯æ–¹å— </h1>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">åˆ†æ•°</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ç­‰çº§</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">è¡Œæ•°</div>
                <div class="stat-value" id="lines">0</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="game-board-container">
                <div class="next-piece-container">
                    <div class="next-piece-label">ä¸‹ä¸€ä¸ª</div>
                    <canvas id="nextPieceCanvas" class="next-piece-canvas"></canvas>
                </div>
                
                <div class="main-game">
                    <div class="game-canvas-container">
                        <canvas id="gameCanvas"></canvas>
                        
                        <!-- æ™®é€šæ¸¸æˆç»“æŸç”»é¢ -->
                        <div class="game-over" id="gameOver">
                            <h2>æ¸¸æˆç»“æŸ!</h2>
                            <p>æœ€ç»ˆåˆ†æ•°: <span id="finalScore">0</span></p>
                            <button class="control-button" id="restartBtn">é‡æ–°å¼€å§‹</button>
                        </div>
                        
                        <!-- å®Œç¾é€šå…³ç”»é¢ -->
                        <div class="perfect-game-over" id="perfectGameOver">
                            <h2>ğŸ‰ æ­å–œæ‚¨ï¼ ğŸ‰</h2>
                            <p>å®Œç¾é€šå…³ï¼ï¼ï¼</p>
                            <div class="perfect-score">æ‰€è·ç¦å¾·: âˆ </div>
                            <p style="font-size: 14px; color: #aaa; margin-top: 10px;">
                            </p>
                            <button class="control-button zen" id="zenDecryptBtn">
                                <i class="fas fa-lock-open"></i> ç¦…æ„è§£å¯†
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="controls-container">
                <div class="top-controls">
                    <button class="control-button" id="startBtn">
                        <i class="fas fa-play"></i> å¼€å§‹
                    </button>
                    <button class="control-button pause" id="pauseBtn">
                        <i class="fas fa-pause"></i> æš‚åœ
                    </button>
                    <button class="sound-control" id="soundToggle">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
                
                <div class="mobile-controls">
                    <div class="dpad-controls">
                        <button class="dpad-button left" id="leftBtn">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <!-- ä¿®æ”¹ï¼šä¸­é—´çš„æŒ‰é’®æ·»åŠ æ—‹è½¬å›¾æ ‡ -->
                        <button class="dpad-button center" id="centerBtn">
                            <i class="fas fa-redo-alt"></i>
                        </button>
                        <button class="dpad-button right" id="rightBtn">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="dpad-button down" id="downBtn">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                    
                    <!-- ç§»é™¤æ—‹è½¬æŒ‰é’®å®¹å™¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  - ä½¿ç”¨æœ¬åœ°éŸ³é¢‘æ–‡ä»¶ -->
    <audio id="backgroundMusic" loop preload="auto">
        <source src="beijing.ogg" type="audio/ogg">
    </audio>
    
    <audio id="clearSound" preload="auto">
        <source src="xiaochu.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="moveSound" preload="auto">
        <source src="move.mp3" type="audio/mpeg">
        <source src="move.ogg" type="audio/ogg">
    </audio>
    
    <audio id="rotateSound" preload="auto">
        <source src="rotate.mp3" type="audio/mpeg">
        <source src="rotate.ogg" type="audio/ogg">
    </audio>
    
    <audio id="dropSound" preload="auto">
        <source src="drop.mp3" type="audio/mpeg">
        <source src="drop.ogg" type="audio/ogg">
    </audio>
    
    <audio id="perfectSound" preload="auto">
        <source src="perfect.mp3" type="audio/mpeg">
        <source src="perfect.ogg" type="audio/ogg">
    </audio>
    
    <!-- æ–°å¢ï¼šæ¶ˆé™¤è¡Œç‰¹æ•ˆéŸ³æ•ˆ -->
    <audio id="flowerSound" preload="auto">
        <source src="flower.mp3" type="audio/mpeg">
        <source src="flower.ogg" type="audio/ogg">
    </audio>

    <script>
        // æ¸¸æˆå¸¸é‡
        const COLS = 10;
        const ROWS = 20;
        const COLORS = [
            '#FFFFFF', // 0 - ç©º (ç™½è‰²)
            '#00D8FF', // 1 - I (äº®é’è‰²)
            '#0066FF', // 2 - J (äº®è“è‰²)
            '#FF8000', // 3 - L (æ©™è‰²)
            '#FFD700', // 4 - O (é‡‘è‰²)
            '#00CC00', // 5 - S (äº®ç»¿è‰²)
            '#AA00FF', // 6 - T (ç´«è‰²)
            '#FF3333'  // 7 - Z (çº¢è‰²)
        ];

        // æ–¹å—å½¢çŠ¶å®šä¹‰
        const SHAPES = [
            // I
            [
                [0,0,0,0],
                [1,1,1,1],
                [0,0,0,0],
                [0,0,0,0]
            ],
            // J
            [
                [2,0,0],
                [2,2,2],
                [0,0,0]
            ],
            // L
            [
                [0,0,3],
                [3,3,3],
                [0,0,0]
            ],
            // O
            [
                [4,4],
                [4,4]
            ],
            // S
            [
                [0,5,5],
                [5,5,0],
                [0,0,0]
            ],
            // T
            [
                [0,6,0],
                [6,6,6],
                [0,0,0]
            ],
            // Z
            [
                [7,7,0],
                [0,7,7],
                [0,0,0]
            ]
        ];

        // æ¸¸æˆå˜é‡
        let board = [];
        let currentPiece = null;
        let nextPiece = null;
        let pieceRow = 0;
        let pieceCol = 0;
        let score = 0;
        let level = 1;
        let lines = 0;
        let gameOver = false;
        let isPlaying = false;
        let isPaused = false;
        let dropCounter = 0;
        let dropInterval = 1000; // åˆå§‹ä¸‹è½é€Ÿåº¦
        let lastTime = 0;
        let blockSize = 25;
        let soundEnabled = true;
        let musicPaused = false; // æ–°å¢ï¼šè®°å½•éŸ³ä¹æ˜¯å¦è¢«æš‚åœ
        let audioInitialized = false;
        
        // å®Œç¾é€šå…³æ£€æµ‹å˜é‡ - ä¿®å¤ï¼šåªåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­æ£€æµ‹
        let isPerfectGame = true; // æ˜¯å¦ä¿æŒå®Œç¾çŠ¶æ€
        let hasRotated = false;   // æ˜¯å¦æ—‹è½¬è¿‡æ–¹å—
        let hasAccelerated = false; // æ˜¯å¦åŠ é€Ÿä¸‹è½è¿‡ï¼ˆæ‰‹åŠ¨åŠ é€Ÿï¼‰
        let hasChangedSpeed = false; // æ˜¯å¦æ”¹å˜è¿‡é€Ÿåº¦ï¼ˆç­‰çº§æå‡ï¼‰
        let initialSpeed = 1000;   // è®°å½•åˆå§‹é€Ÿåº¦
        let totalPieces = 0;       // æ€»æ–¹å—æ•°
        
        // DOMå…ƒç´ 
        const gameCanvas = document.getElementById('gameCanvas');
        const nextPieceCanvas = document.getElementById('nextPieceCanvas');
        const ctx = gameCanvas.getContext('2d');
        const nextCtx = nextPieceCanvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const linesElement = document.getElementById('lines');
        const gameOverElement = document.getElementById('gameOver');
        const perfectGameOverElement = document.getElementById('perfectGameOver');
        const finalScoreElement = document.getElementById('finalScore');
        const flowerContainer = document.getElementById('flowerContainer');
        
        // æŒ‰é’®å…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const restartBtn = document.getElementById('restartBtn');
        const zenDecryptBtn = document.getElementById('zenDecryptBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const downBtn = document.getElementById('downBtn');
        const soundToggle = document.getElementById('soundToggle');
        const centerBtn = document.getElementById('centerBtn');
        
        // éŸ³é¢‘å…ƒç´ 
        const backgroundMusic = document.getElementById('backgroundMusic');
        const clearSound = document.getElementById('clearSound');
        const moveSound = document.getElementById('moveSound');
        const rotateSound = document.getElementById('rotateSound');
        const dropSound = document.getElementById('dropSound');
        const perfectSound = document.getElementById('perfectSound');
        const flowerSound = document.getElementById('flowerSound'); // æ–°å¢ï¼šå¤©èŠ±æ•£è½éŸ³æ•ˆ
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (audioInitialized) return;
            
            // è®¾ç½®éŸ³é¢‘éŸ³é‡
            backgroundMusic.volume = 0.3;
            clearSound.volume = 0.5;
            moveSound.volume = 0.3;
            rotateSound.volume = 0.4;
            dropSound.volume = 0.5;
            perfectSound.volume = 0.7;
            flowerSound.volume = 0.6; // æ–°å¢ï¼šå¤©èŠ±éŸ³æ•ˆéŸ³é‡
            
            // æ·»åŠ éŸ³é¢‘é”™è¯¯å¤„ç†
            const audioElements = [backgroundMusic, clearSound, moveSound, rotateSound, dropSound, perfectSound, flowerSound];
            audioElements.forEach(audio => {
                audio.addEventListener('error', function(e) {
                    console.log(`éŸ³é¢‘åŠ è½½é”™è¯¯: ${audio.id}`, e);
                    // å¦‚æœéŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨éŸ³é¢‘
                    if (audio.id === 'clearSound' && !audio.src.includes('fallback')) {
                        console.log('å°è¯•åŠ è½½å¤‡ç”¨æ¶ˆé™¤éŸ³æ•ˆ...');
                        audio.src = 'https://assets.mixkit.co/sfx/download/mixkit-winning-chimes-2015.mp3';
                        audio.load();
                    }
                });
                
                audio.addEventListener('canplaythrough', function() {
                    console.log(`éŸ³é¢‘å·²åŠ è½½: ${audio.id}`);
                });
            });
            
            // è®¾ç½®éŸ³é¢‘å¾ªç¯æ’­æ”¾
            backgroundMusic.loop = true;
            
            // é¢„åŠ è½½éŸ³é¢‘
            try {
                backgroundMusic.load();
                clearSound.load();
                moveSound.load();
                rotateSound.load();
                dropSound.load();
                perfectSound.load();
                flowerSound.load(); // æ–°å¢ï¼šé¢„åŠ è½½å¤©èŠ±éŸ³æ•ˆ
                
                audioInitialized = true;
                console.log("éŸ³é¢‘åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.log("éŸ³é¢‘åˆå§‹åŒ–é”™è¯¯:", error);
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(sound) {
            if (!soundEnabled) return;
            
            try {
                sound.currentTime = 0;
                const playPromise = sound.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:", error.name);
                        
                        if (error.name === 'NotAllowedError') {
                            const playAfterInteraction = () => {
                                sound.currentTime = 0;
                                sound.play().catch(() => {});
                                document.removeEventListener('click', playAfterInteraction);
                            };
                            document.addEventListener('click', playAfterInteraction);
                        }
                    });
                }
            } catch (error) {
                console.log("æ’­æ”¾éŸ³é¢‘æ—¶å‡ºé”™:", error);
            }
        }
        
        // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
        function playBackgroundMusic() {
            if (!soundEnabled || !isPlaying || isPaused) return;
            
            try {
                if (backgroundMusic.readyState < 3) {
                    console.log("èƒŒæ™¯éŸ³ä¹æœªå°±ç»ªï¼Œæ­£åœ¨åŠ è½½...");
                    return;
                }
                
                // å¦‚æœéŸ³ä¹è¢«æš‚åœï¼Œä»å½“å‰ä½ç½®ç»§ç»­æ’­æ”¾
                if (musicPaused) {
                    const playPromise = backgroundMusic.play();
                    musicPaused = false;
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾è¢«é˜»æ­¢:", error.name);
                        });
                    }
                } else {
                    // å¦åˆ™ä»å¤´å¼€å§‹æ’­æ”¾
                    backgroundMusic.currentTime = 0;
                    const playPromise = backgroundMusic.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾è¢«é˜»æ­¢:", error.name);
                            
                            if (error.name === 'NotAllowedError') {
                                const startMusicOnInteraction = () => {
                                    if (soundEnabled && isPlaying && !isPaused) {
                                        backgroundMusic.play().catch(() => {});
                                    }
                                    document.removeEventListener('click', startMusicOnInteraction);
                                };
                                document.addEventListener('click', startMusicOnInteraction);
                            }
                        });
                    }
                }
            } catch (error) {
                console.log("æ’­æ”¾èƒŒæ™¯éŸ³ä¹æ—¶å‡ºé”™:", error);
            }
        }
        
        // æš‚åœèƒŒæ™¯éŸ³ä¹
        function pauseBackgroundMusic() {
            try {
                backgroundMusic.pause();
                musicPaused = true;
            } catch (error) {
                console.log("æš‚åœèƒŒæ™¯éŸ³ä¹æ—¶å‡ºé”™:", error);
            }
        }
        
        // åˆ‡æ¢éŸ³æ•ˆå’ŒéŸ³ä¹ - ä¿®æ”¹ï¼šæ”¹ä¸ºæš‚åœ/ç»§ç»­èƒŒæ™¯éŸ³ä¹
        function toggleSound() {
            if (soundEnabled) {
                // å¦‚æœéŸ³æ•ˆå·²å¼€å¯ï¼Œåˆ™æš‚åœéŸ³ä¹
                if (!musicPaused) {
                    backgroundMusic.pause();
                    musicPaused = true;
                    soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    soundToggle.style.background = 'linear-gradient(145deg, #666666, #444444)';
                } else {
                    // å¦‚æœéŸ³ä¹å·²æš‚åœï¼Œåˆ™ç»§ç»­æ’­æ”¾
                    playBackgroundMusic();
                    soundToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                    soundToggle.style.background = 'linear-gradient(145deg, #2196F3, #1976D2)';
                }
            } else {
                // å¦‚æœéŸ³æ•ˆè¢«ç¦ç”¨ï¼Œåˆ™å¯ç”¨éŸ³æ•ˆå¹¶æ’­æ”¾éŸ³ä¹
                soundEnabled = true;
                soundToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                soundToggle.style.background = 'linear-gradient(145deg, #2196F3, #1976D2)';
                
                if (isPlaying && !isPaused) {
                    playBackgroundMusic();
                }
            }
        }
        
        // åˆ›å»ºå¤©èŠ±æ•£è½æ•ˆæœ
        function createFlowerEffect(linesCleared) {
            if (!soundEnabled) return;
            
            // æ’­æ”¾å¤©èŠ±éŸ³æ•ˆ
            playSound(flowerSound);
            
            // è®¡ç®—å¤©èŠ±æ•°é‡
            let flowerCount = 50; // åŸºç¡€æ•°é‡
            if (linesCleared === 2) {
                flowerCount = 80; // æ¶ˆé™¤2è¡Œï¼š80æœµèŠ±
            } else if (linesCleared >= 3) {
                flowerCount = 150; // æ¶ˆé™¤3è¡Œæˆ–ä»¥ä¸Šï¼š150æœµèŠ±
            }
            
            // æ¸…ç©ºå®¹å™¨
            flowerContainer.innerHTML = '';
            
            // åˆ›å»ºå¤©èŠ±
            for (let i = 0; i < flowerCount; i++) {
                const flower = document.createElement('div');
                flower.classList.add('flower');
                
                // éšæœºé€‰æ‹©èŠ±çš„æ ·å¼ï¼ˆæ¨¡æ‹Ÿä¸åŒé¢œè‰²çš„èŠ±ï¼‰
                const flowerTypes = [
                    'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ·', 'ğŸ’®', 'ğŸµï¸', 'ğŸ¥€', 'ğŸŒ¹', 'ğŸŒ'
                ];
                const flowerType = flowerTypes[Math.floor(Math.random() * flowerTypes.length)];
                
                // è®¾ç½®èŠ±çš„å†…å®¹å’Œæ ·å¼
                flower.textContent = flowerType;
                flower.style.fontSize = `${Math.random() * 20 + 15}px`;
                
                // éšæœºé¢œè‰²
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2',
                    '#EF476F', '#FFD166', '#06D6A0', '#073B4C', '#7209B7'
                ];
                flower.style.color = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºèµ·å§‹ä½ç½®ï¼ˆä»å±å¹•é¡¶éƒ¨å¼€å§‹ï¼‰
                const startX = Math.random() * window.innerWidth;
                const startY = -30;
                
                // éšæœºç»“æŸä½ç½®
                const endX = startX + (Math.random() * 300 - 150);
                const endY = window.innerHeight + 30;
                
                // éšæœºæ—‹è½¬
                const rotation = Math.random() * 360;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 3 + 3;
                
                // è®¾ç½®åˆå§‹ä½ç½®
                flower.style.left = `${startX}px`;
                flower.style.top = `${startY}px`;
                flower.style.transform = `rotate(${rotation}deg)`;
                
                // æ·»åŠ èŠ±åˆ°å®¹å™¨
                flowerContainer.appendChild(flower);
                
                // ä½¿ç”¨requestAnimationFrameå®ç°åŠ¨ç”»
                let startTime = null;
                
                function animateFlower(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / (duration * 1000), 1);
                    
                    // è®¡ç®—å½“å‰ä½ç½®ï¼ˆæŠ›ç‰©çº¿è½¨è¿¹ï¼‰
                    const currentX = startX + (endX - startX) * progress;
                    const currentY = startY + (endY - startY) * progress;
                    
                    // æ·»åŠ è½»å¾®çš„å·¦å³æ‘†åŠ¨
                    const swing = Math.sin(progress * Math.PI * 5) * 20;
                    
                    // è®¡ç®—æ—‹è½¬
                    const currentRotation = rotation + progress * 720;
                    
                    // è®¡ç®—é€æ˜åº¦ï¼ˆæ·¡å…¥æ·¡å‡ºæ•ˆæœï¼‰
                    let opacity = 1;
                    if (progress < 0.2) {
                        opacity = progress / 0.2; // æ·¡å…¥
                    } else if (progress > 0.8) {
                        opacity = 1 - ((progress - 0.8) / 0.2); // æ·¡å‡º
                    }
                    
                    // æ›´æ–°èŠ±çš„ä½ç½®å’Œæ ·å¼
                    flower.style.left = `${currentX + swing}px`;
                    flower.style.top = `${currentY}px`;
                    flower.style.transform = `rotate(${currentRotation}deg)`;
                    flower.style.opacity = opacity;
                    
                    // ç»§ç»­åŠ¨ç”»ç›´åˆ°å®Œæˆ
                    if (progress < 1) {
                        requestAnimationFrame(animateFlower);
                    } else {
                        // åŠ¨ç”»å®Œæˆåç§»é™¤èŠ±
                        flower.remove();
                    }
                }
                
                // å»¶è¿Ÿå¼€å§‹åŠ¨ç”»ï¼Œåˆ›å»ºäº¤é”™æ•ˆæœ
                setTimeout(() => {
                    requestAnimationFrame(animateFlower);
                }, Math.random() * 1000);
            }
            
            // æ·»åŠ åº†ç¥æ–‡æœ¬
            if (linesCleared >= 2) {
                createCelebrationText(linesCleared);
            }
        }
        
        // åˆ›å»ºåº†ç¥æ–‡æœ¬
        function createCelebrationText(linesCleared) {
            const messages = [
                ""
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            const text = document.createElement('div');
            text.textContent = ``;
            text.style.position = 'fixed';
            text.style.top = '50%';
            text.style.left = '50%';
            text.style.transform = 'translate(-50%, -50%)';
            text.style.fontSize = '48px';
            text.style.fontWeight = 'bold';
            text.style.color = '#FFD700';
            text.style.textShadow = '0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6)';
            text.style.zIndex = '10000';
            text.style.pointerEvents = 'none';
            text.style.opacity = '0';
            
            document.body.appendChild(text);
            
            // æ–‡æœ¬åŠ¨ç”»
            let opacity = 0;
            let scale = 0.5;
            let yOffset = 0;
            
            function animateText(timestamp) {
                opacity += 0.05;
                scale += 0.05;
                yOffset -= 2;
                
                text.style.opacity = Math.min(opacity, 1);
                text.style.transform = `translate(-50%, calc(-50% + ${yOffset}px)) scale(${Math.min(scale, 1.5)})`;
                
                if (opacity < 1.2) {
                    requestAnimationFrame(animateText);
                } else {
                    // æ·¡å‡º
                    setTimeout(() => {
                        let fadeOut = 1;
                        function fadeOutText() {
                            fadeOut -= 0.05;
                            text.style.opacity = Math.max(fadeOut, 0);
                            
                            if (fadeOut > 0) {
                                requestAnimationFrame(fadeOutText);
                            } else {
                                text.remove();
                            }
                        }
                        fadeOutText();
                    }, 1000);
                }
            }
            
            requestAnimationFrame(animateText);
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            // åˆå§‹åŒ–æ¸¸æˆæ¿
            board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            score = 0;
            level = 1;
            lines = 0;
            gameOver = false;
            isPlaying = false;
            isPaused = false;
            dropInterval = 1000;
            
            // é‡è¦ä¿®å¤ï¼šé‡ç½®å®Œç¾é€šå…³çŠ¶æ€ - åªåœ¨initæ—¶é‡ç½®ï¼Œä¸åœ¨å¼€å§‹æ¸¸æˆæ—¶é‡ç½®
            isPerfectGame = true;
            hasRotated = false;
            hasAccelerated = false;
            hasChangedSpeed = false;
            initialSpeed = dropInterval; // è®°å½•åˆå§‹é€Ÿåº¦
            totalPieces = 0;
            
            // åˆ›å»ºç¬¬ä¸€ä¸ªæ–¹å—
            currentPiece = createRandomPiece();
            nextPiece = createRandomPiece();
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            drawNextPiece();
            
            // éšè—æ¸¸æˆç»“æŸç”»é¢
            gameOverElement.style.display = 'none';
            perfectGameOverElement.style.display = 'none';
            
            // æ¸…ç©ºå¤©èŠ±å®¹å™¨
            flowerContainer.innerHTML = '';
            
            // æš‚åœèƒŒæ™¯éŸ³ä¹
            pauseBackgroundMusic();
            
            // è°ƒæ•´ç”»å¸ƒå¤§å°
            resizeCanvas();
        }
        
        // åˆ›å»ºéšæœºæ–¹å—
        function createRandomPiece() {
            const pieceType = Math.floor(Math.random() * SHAPES.length);
            return {
                shape: SHAPES[pieceType],
                color: COLORS[pieceType + 1],
                type: pieceType
            };
        }
        
        // ç»˜åˆ¶æ–¹å—
        function drawBlock(ctx, x, y, color) {
            // ç»˜åˆ¶æ–¹å—ä¸»ä½“
            ctx.fillStyle = color;
            ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
            
            // ç»˜åˆ¶æ–¹å—è¾¹æ¡†
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeRect(x * blockSize, y * blockSize, blockSize, blockSize);
            
            // ç»˜åˆ¶æ–¹å—å†…é«˜å…‰
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.fillRect(x * blockSize, y * blockSize, blockSize - 2, 4);
            ctx.fillRect(x * blockSize, y * blockSize, 4, blockSize - 2);
            
            // ç»˜åˆ¶æ–¹å—é˜´å½±
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(x * blockSize + 2, y * blockSize + blockSize - 4, blockSize - 2, 4);
            ctx.fillRect(x * blockSize + blockSize - 4, y * blockSize + 2, 4, blockSize - 2);
            
            // æ·»åŠ å†…éƒ¨è£…é¥°çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.strokeRect(x * blockSize + 2, y * blockSize + 2, blockSize - 4, blockSize - 4);
        }
        
        // ç»˜åˆ¶æ¸¸æˆæ¿
        function drawBoard() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= COLS; x++) {
                ctx.beginPath();
                ctx.moveTo(x * blockSize, 0);
                ctx.lineTo(x * blockSize, ROWS * blockSize);
                ctx.stroke();
            }
            
            for (let y = 0; y <= ROWS; y++) {
                ctx.beginPath();
                ctx.moveTo(0, y * blockSize);
                ctx.lineTo(COLS * blockSize, y * blockSize);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶å·²æ”¾ç½®çš„æ–¹å—
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (board[y][x]) {
                        drawBlock(ctx, x, y, COLORS[board[y][x]]);
                    }
                }
            }
            
            // ç»˜åˆ¶å½“å‰ä¸‹è½çš„æ–¹å—
            if (currentPiece) {
                for (let y = 0; y < currentPiece.shape.length; y++) {
                    for (let x = 0; x < currentPiece.shape[y].length; x++) {
                        if (currentPiece.shape[y][x]) {
                            const boardX = pieceCol + x;
                            const boardY = pieceRow + y;
                            
                            if (boardY >= 0) {
                                drawBlock(ctx, boardX, boardY, currentPiece.color);
                            }
                        }
                    }
                }
            }
            
            // æ·»åŠ æ¸¸æˆåŒºåŸŸè¾¹æ¡†
            ctx.strokeStyle = '#FFCC00';
            ctx.lineWidth = 4;
            ctx.strokeRect(0, 0, COLS * blockSize, ROWS * blockSize);
        }
        
        // ç»˜åˆ¶ä¸‹ä¸€ä¸ªæ–¹å—é¢„è§ˆ
        function drawNextPiece() {
            // æ¸…ç©ºä¸‹ä¸€ä¸ªæ–¹å—ç”»å¸ƒ
            nextCtx.clearRect(0, 0, nextPieceCanvas.width, nextPieceCanvas.height);
            
            // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
            nextCtx.fillStyle = '#FFFFFF';
            nextCtx.fillRect(0, 0, nextPieceCanvas.width, nextPieceCanvas.height);
            
            if (!nextPiece) return;
            
            // è®¡ç®—å±…ä¸­ä½ç½®
            const blockSizeNext = 25;
            const offsetX = (nextPieceCanvas.width - nextPiece.shape[0].length * blockSizeNext) / 2;
            const offsetY = (nextPieceCanvas.height - nextPiece.shape.length * blockSizeNext) / 2;
            
            // ç»˜åˆ¶ä¸‹ä¸€ä¸ªæ–¹å—
            for (let y = 0; y < nextPiece.shape.length; y++) {
                for (let x = 0; x < nextPiece.shape[y].length; x++) {
                    if (nextPiece.shape[y][x]) {
                        // ç»˜åˆ¶æ–¹å—ä¸»ä½“
                        nextCtx.fillStyle = nextPiece.color;
                        nextCtx.fillRect(offsetX + x * blockSizeNext, offsetY + y * blockSizeNext, blockSizeNext, blockSizeNext);
                        
                        // ç»˜åˆ¶æ–¹å—è¾¹æ¡†
                        nextCtx.strokeStyle = '#000000';
                        nextCtx.lineWidth = 2;
                        nextCtx.strokeRect(offsetX + x * blockSizeNext, offsetY + y * blockSizeNext, blockSizeNext, blockSizeNext);
                        
                        // ç»˜åˆ¶å†…é«˜å…‰
                        nextCtx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                        nextCtx.fillRect(offsetX + x * blockSizeNext, offsetY + y * blockSizeNext, blockSizeNext - 2, 3);
                        nextCtx.fillRect(offsetX + x * blockSizeNext, offsetY + y * blockSizeNext, 3, blockSizeNext - 2);
                    }
                }
            }
            
            // æ·»åŠ é¢„è§ˆåŒºåŸŸè¾¹æ¡†
            nextCtx.strokeStyle = '#4CAF50';
            nextCtx.lineWidth = 3;
            nextCtx.strokeRect(0, 0, nextPieceCanvas.width, nextPieceCanvas.height);
        }
        
        // ç¢°æ’æ£€æµ‹
        function checkCollision(piece, row, col) {
            for (let y = 0; y < piece.shape.length; y++) {
                for (let x = 0; x < piece.shape[y].length; x++) {
                    if (piece.shape[y][x]) {
                        const newX = col + x;
                        const newY = row + y;
                        
                        // æ£€æŸ¥è¾¹ç•Œ
                        if (newX < 0 || newX >= COLS || newY >= ROWS) {
                            return true;
                        }
                        
                        // æ£€æŸ¥ä¸å·²æœ‰æ–¹å—çš„ç¢°æ’
                        if (newY >= 0 && board[newY][newX]) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }
        
        // åˆå¹¶æ–¹å—åˆ°æ¸¸æˆæ¿
        function mergePiece() {
            for (let y = 0; y < currentPiece.shape.length; y++) {
                for (let x = 0; x < currentPiece.shape[y].length; x++) {
                    if (currentPiece.shape[y][x]) {
                        const boardY = pieceRow + y;
                        const boardX = pieceCol + x;
                        
                        if (boardY >= 0) {
                            board[boardY][boardX] = currentPiece.shape[y][x];
                        }
                    }
                }
            }
            playSound(dropSound);
            totalPieces++;
        }
        
        // æ¸…é™¤å®Œæ•´çš„è¡Œ - ä¿®æ”¹ï¼šæ·»åŠ å¤©èŠ±æ•£è½æ•ˆæœ
        function clearLines() {
            let linesCleared = 0;
            
            for (let y = ROWS - 1; y >= 0; y--) {
                let isLineFull = true;
                
                // æ£€æŸ¥è¡Œæ˜¯å¦å·²æ»¡
                for (let x = 0; x < COLS; x++) {
                    if (!board[y][x]) {
                        isLineFull = false;
                        break;
                    }
                }
                
                // å¦‚æœè¡Œå·²æ»¡ï¼Œåˆ™æ¸…é™¤
                if (isLineFull) {
                    linesCleared++;
                    
                    // å°†ä¸Šé¢çš„è¡Œå‘ä¸‹ç§»åŠ¨
                    for (let yy = y; yy > 0; yy--) {
                        for (let x = 0; x < COLS; x++) {
                            board[yy][x] = board[yy - 1][x];
                        }
                    }
                    
                    // æ¸…é™¤æœ€é¡¶è¡Œ
                    for (let x = 0; x < COLS; x++) {
                        board[0][x] = 0;
                    }
                    
                    // é‡æ–°æ£€æŸ¥å½“å‰è¡Œï¼ˆå› ä¸ºè¡Œå·²ä¸‹ç§»ï¼‰
                    y++;
                }
            }
            
            if (linesCleared > 0) {
                // æ’­æ”¾æ¶ˆé™¤éŸ³æ•ˆ - ä½¿ç”¨æœ¬åœ°æ–‡ä»¶
                playSound(clearSound);
                
                // å¦‚æœæ¶ˆé™¤2è¡Œæˆ–æ›´å¤šï¼Œæ˜¾ç¤ºå¤©èŠ±æ•£è½æ•ˆæœ
                if (linesCleared >= 2) {
                    createFlowerEffect(linesCleared);
                }
                
                // æ›´æ–°åˆ†æ•°å’Œè¡Œæ•°
                lines += linesCleared;
                
                // è®¡åˆ†è§„åˆ™
                const linePoints = [0, 100, 300, 500, 800];
                score += linePoints[linesCleared] * level;
                
                // æ¯æ¸…é™¤10è¡Œå‡ä¸€çº§
                const newLevel = Math.floor(lines / 10) + 1;
                
                // æ£€æŸ¥é€Ÿåº¦æ˜¯å¦æ”¹å˜
                if (newLevel > level) {
                    level = newLevel;
                    // æ£€æŸ¥é€Ÿåº¦æ˜¯å¦æ”¹å˜ï¼ˆå®Œç¾é€šå…³è¦æ±‚ä¸èƒ½æ”¹å˜é€Ÿåº¦ï¼‰
                    const newSpeed = Math.max(100, 1000 - (level - 1) * 100);
                    if (newSpeed !== dropInterval) {
                        hasChangedSpeed = true;
                        // é‡è¦ï¼šåªåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­æ‰ä¿®æ”¹isPerfectGame
                        if (isPlaying) {
                            isPerfectGame = false;
                        }
                    }
                    dropInterval = newSpeed;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                updateDisplay();
            }
            
            return linesCleared;
        }
        
        // æ—‹è½¬æ–¹å—
        function rotatePiece() {
            if (!currentPiece || isPaused || !isPlaying) return;
            
            // æ ‡è®°å·²æ—‹è½¬
            hasRotated = true;
            // é‡è¦ï¼šåªåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­æ‰ä¿®æ”¹isPerfectGame
            if (isPlaying) {
                isPerfectGame = false;
            }
            
            // åˆ›å»ºæ—‹è½¬åçš„å½¢çŠ¶
            const shape = currentPiece.shape;
            const rows = shape.length;
            const cols = shape[0].length;
            const rotated = Array.from({length: cols}, () => Array(rows).fill(0));
            
            // æ‰§è¡Œæ—‹è½¬ï¼ˆé¡ºæ—¶é’ˆ90åº¦ï¼‰
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    rotated[x][rows - 1 - y] = shape[y][x];
                }
            }
            
            // ä¿å­˜åŸå§‹å½¢çŠ¶
            const originalShape = currentPiece.shape;
            
            // å°è¯•æ—‹è½¬
            currentPiece.shape = rotated;
            
            // å¦‚æœæ—‹è½¬åå‘ç”Ÿç¢°æ’ï¼Œåˆ™æ¢å¤åŸå§‹å½¢çŠ¶
            if (checkCollision(currentPiece, pieceRow, pieceCol)) {
                currentPiece.shape = originalShape;
                playSound(moveSound);
            } else {
                playSound(rotateSound);
            }
            
            drawBoard();
        }
        
        // ç§»åŠ¨æ–¹å— - ä¿®å¤ï¼šåªæœ‰åœ¨æ¸¸æˆè¿›è¡Œä¸­æ‰æ£€æµ‹åŠ é€Ÿ
        function movePiece(dx, dy) {
            if (!currentPiece || isPaused || !isPlaying) return;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ‰‹åŠ¨åŠ é€Ÿä¸‹è½ï¼ˆæŒ‰â†“é”®æˆ–æŒ‰é’®ï¼‰
            if (dy > 0) {
                hasAccelerated = true;
                // é‡è¦ï¼šåªåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­æ‰ä¿®æ”¹isPerfectGame
                if (isPlaying) {
                    isPerfectGame = false;
                }
            }
            
            // å°è¯•ç§»åŠ¨
            const newRow = pieceRow + dy;
            const newCol = pieceCol + dx;
            
            // æ£€æŸ¥ç¢°æ’
            if (!checkCollision(currentPiece, newRow, newCol)) {
                pieceRow = newRow;
                pieceCol = newCol;
                drawBoard();
                
                // æ’­æ”¾ç§»åŠ¨éŸ³æ•ˆï¼ˆåªåœ¨æ¨ªå‘ç§»åŠ¨æ—¶ï¼‰
                if (dx !== 0) {
                    playSound(moveSound);
                }
                return true;
            }
            
            // å¦‚æœå‘ä¸‹ç§»åŠ¨å‘ç”Ÿç¢°æ’ï¼Œåˆ™åˆå¹¶æ–¹å—
            if (dy > 0) {
                mergePiece();
                clearLines();
                spawnNewPiece();
            }
            
            return false;
        }
        
        // å¿«é€Ÿä¸‹è½ï¼ˆç¦ç”¨æ­¤åŠŸèƒ½ï¼Œå› ä¸ºå®Œç¾é€šå…³ä¸èƒ½ä½¿ç”¨ï¼‰
        function hardDrop() {
            if (!currentPiece || isPaused || !isPlaying) return;
            
            // æ ‡è®°ä¸ºåŠ é€Ÿ
            hasAccelerated = true;
            // é‡è¦ï¼šåªåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­æ‰ä¿®æ”¹isPerfectGame
            if (isPlaying) {
                isPerfectGame = false;
            }
            
            while (movePiece(0, 1)) {
                // ç»§ç»­ä¸‹è½ç›´åˆ°ç¢°æ’
            }
        }
        
        // ç”Ÿæˆæ–°æ–¹å—
        function spawnNewPiece() {
            currentPiece = nextPiece;
            nextPiece = createRandomPiece();
            pieceRow = 0;
            pieceCol = Math.floor(COLS / 2) - Math.floor(currentPiece.shape[0].length / 2);
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (checkCollision(currentPiece, pieceRow, pieceCol)) {
                gameOver = true;
                isPlaying = false;
                
                // æ˜¾ç¤ºç›¸åº”çš„ç»“æŸç”»é¢
                if (isPerfectGame) {
                    // å®Œç¾é€šå…³ - æ˜¾ç¤ºæ— ç©·ç¬¦å·
                    perfectGameOverElement.style.display = 'flex';
                    playSound(perfectSound);
                    
                    // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
                    setTimeout(() => {
                        playSound(perfectSound);
                    }, 1000);
                } else {
                    // æ™®é€šæ¸¸æˆç»“æŸ
                    finalScoreElement.textContent = score;
                    gameOverElement.style.display = 'flex';
                }
                
                // æš‚åœèƒŒæ™¯éŸ³ä¹
                pauseBackgroundMusic();
            }
            
            // æ›´æ–°ä¸‹ä¸€ä¸ªæ–¹å—é¢„è§ˆ
            drawNextPiece();
            drawBoard();
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            scoreElement.textContent = score;
            levelElement.textContent = level;
            linesElement.textContent = lines;
        }
        
        // è°ƒæ•´ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            const container = document.querySelector('.game-canvas-container');
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            // è®¡ç®—é€‚åˆçš„blockSize
            const maxBlockSizeByWidth = Math.floor(containerWidth / COLS) - 1;
            const maxBlockSizeByHeight = Math.floor(containerHeight / ROWS) - 1;
            blockSize = Math.min(maxBlockSizeByWidth, maxBlockSizeByHeight, 30);
            
            // ç¡®ä¿blockSizeä¸å°äº10
            blockSize = Math.max(blockSize, 10);
            
            // è°ƒæ•´ä¸»æ¸¸æˆç”»å¸ƒ
            gameCanvas.width = COLS * blockSize;
            gameCanvas.height = ROWS * blockSize;
            
            // é‡æ–°ç»˜åˆ¶
            drawBoard();
            drawNextPiece();
        }
        
        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop(time = 0) {
            // è®¡ç®—æ—¶é—´å¢é‡
            const deltaTime = time - lastTime;
            lastTime = time;
            
            if (isPlaying && !isPaused && !gameOver) {
                // æ›´æ–°ä¸‹è½è®¡æ—¶å™¨
                dropCounter += deltaTime;
                
                if (dropCounter > dropInterval) {
                    // é‡è¦ä¿®å¤ï¼šè‡ªç„¶ä¸‹è½ä¸åº”è¯¥è§¦å‘åŠ é€Ÿæ£€æµ‹
                    // è¿™é‡Œä¸è°ƒç”¨movePiece(0, 1)ï¼Œè€Œæ˜¯ç›´æ¥å¤„ç†è‡ªç„¶ä¸‹è½
                    handleNaturalDrop();
                    dropCounter = 0;
                }
            }
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }
        
        // å¤„ç†è‡ªç„¶ä¸‹è½ï¼ˆä¸è§¦å‘åŠ é€Ÿæ£€æµ‹ï¼‰
        function handleNaturalDrop() {
            if (!currentPiece || isPaused || !isPlaying) return;
            
            // å°è¯•è‡ªç„¶ä¸‹è½
            const newRow = pieceRow + 1;
            const newCol = pieceCol;
            
            // æ£€æŸ¥ç¢°æ’
            if (!checkCollision(currentPiece, newRow, newCol)) {
                pieceRow = newRow;
                pieceCol = newCol;
                drawBoard();
                return true;
            }
            
            // å¦‚æœå‘ä¸‹ç§»åŠ¨å‘ç”Ÿç¢°æ’ï¼Œåˆ™åˆå¹¶æ–¹å—
            mergePiece();
            clearLines();
            spawnNewPiece();
            
            return false;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameOver) {
                init();
            }
            
            isPlaying = true;
            isPaused = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹';
            startBtn.style.background = 'linear-gradient(145deg, #4CAF50, #45a049)';
            
            // é‡è¦ï¼šè®°å½•åˆå§‹é€Ÿåº¦ï¼Œä½†ä¸åœ¨startGameä¸­é‡ç½®å®Œç¾çŠ¶æ€
            // å®Œç¾çŠ¶æ€å·²åœ¨init()ä¸­åˆå§‹åŒ–
            initialSpeed = dropInterval;
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹ - ä½¿ç”¨æœ¬åœ°æ–‡ä»¶
            playBackgroundMusic();
        }
        
        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (!isPlaying || gameOver) return;
            
            isPaused = !isPaused;
            
            if (isPaused) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­';
                // æš‚åœèƒŒæ™¯éŸ³ä¹
                pauseBackgroundMusic();
            } else {
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                // æ¢å¤èƒŒæ™¯éŸ³ä¹
                playBackgroundMusic();
            }
        }
        
        // é‡ç½®æ¸¸æˆ - æ­¤åŠŸèƒ½å·²ç§»é™¤ï¼Œåªä¿ç•™initå‡½æ•°ä¾›å†…éƒ¨ä½¿ç”¨
        function resetGame() {
            init();
            isPlaying = false;
            isPaused = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹';
            pauseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
            
            // æ¸…ç©ºå¤©èŠ±å®¹å™¨
            flowerContainer.innerHTML = '';
            
            // æš‚åœèƒŒæ™¯éŸ³ä¹
            pauseBackgroundMusic();
        }
        
        // ç¦…æ„è§£å¯†åŠŸèƒ½ - è·³è½¬åˆ°æŒ‡å®šç½‘é¡µ
        function zenDecrypt() {
            // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æŒ‡å®šç½‘é¡µ
            window.open('https://amitofo.icu/yiqu.html', '_blank');
        }
        
        // é”®ç›˜æ§åˆ¶
        function handleKeyDown(e) {
            if (!isPlaying || isPaused) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    movePiece(-1, 0);
                    break;
                case 'ArrowRight':
                    movePiece(1, 0);
                    break;
                case 'ArrowDown':
                    movePiece(0, 1);
                    break;
                case 'ArrowUp':
                    rotatePiece();
                    break;
                case ' ':
                case 'Spacebar':
                    hardDrop();
                    e.preventDefault();
                    break;
                case 'p':
                case 'P':
                    pauseGame();
                    break;
                case 'm':
                case 'M':
                    toggleSound();
                    break;
            }
        }
        
        // æŒ‰é’®äº‹ä»¶ç»‘å®š
        function setupEventListeners() {
            // åˆå§‹åŒ–éŸ³é¢‘
            initAudio();
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', handleKeyDown);
            
            // å¼€å§‹æŒ‰é’®
            startBtn.addEventListener('click', () => {
                if (!isPlaying || gameOver) {
                    startGame();
                }
            });
            
            // æš‚åœæŒ‰é’®
            pauseBtn.addEventListener('click', pauseGame);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®ï¼ˆæ™®é€šæ¸¸æˆç»“æŸï¼‰
            restartBtn.addEventListener('click', () => {
                init();
                startGame();
            });
            
            // ç¦…æ„è§£å¯†æŒ‰é’®ï¼ˆå®Œç¾é€šå…³ï¼‰- è·³è½¬åˆ°æŒ‡å®šç½‘é¡µ
            zenDecryptBtn.addEventListener('click', zenDecrypt);
            
            // éŸ³æ•ˆåˆ‡æ¢æŒ‰é’® - ä¿®æ”¹ï¼šæ”¹ä¸ºæš‚åœ/ç»§ç»­èƒŒæ™¯éŸ³ä¹
            soundToggle.addEventListener('click', toggleSound);
            
            // æ–¹å‘æ§åˆ¶æŒ‰é’®
            leftBtn.addEventListener('click', () => movePiece(-1, 0));
            rightBtn.addEventListener('click', () => movePiece(1, 0));
            downBtn.addEventListener('click', () => movePiece(0, 1));
            
            // æ–°å¢ï¼šä¸­é—´æŒ‰é’®æ·»åŠ æ—‹è½¬åŠŸèƒ½
            centerBtn.addEventListener('click', rotatePiece);
            
            // é•¿æŒ‰åŠ é€Ÿ
            let holdInterval;
            
            function startHold(dx, dy) {
                if (dy > 0) { // åªæœ‰å‘ä¸‹é•¿æŒ‰æ‰æ ‡è®°ä¸ºåŠ é€Ÿ
                    hasAccelerated = true;
                    if (isPlaying) {
                        isPerfectGame = false;
                    }
                }
                movePiece(dx, dy);
                holdInterval = setInterval(() => movePiece(dx, dy), 100);
            }
            
            function stopHold() {
                clearInterval(holdInterval);
            }
            
            // ä¸ºæ–¹å‘æŒ‰é’®æ·»åŠ é•¿æŒ‰æ”¯æŒ
            [leftBtn, rightBtn, downBtn].forEach(btn => {
                btn.addEventListener('mousedown', (e) => {
                    if (!isPlaying || isPaused) return;
                    
                    let dx = 0, dy = 0;
                    if (btn === leftBtn) dx = -1;
                    else if (btn === rightBtn) dx = 1;
                    else if (btn === downBtn) dy = 1;
                    
                    startHold(dx, dy);
                });
                
                btn.addEventListener('mouseup', stopHold);
                btn.addEventListener('mouseleave', stopHold);
                
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (!isPlaying || isPaused) return;
                    
                    let dx = 0, dy = 0;
                    if (btn === leftBtn) dx = -1;
                    else if (btn === rightBtn) dx = 1;
                    else if (btn === downBtn) dy = 1;
                    
                    startHold(dx, dy);
                });
                
                btn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    stopHold();
                });
            });
            
            // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´ç”»å¸ƒ
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('orientationchange', () => {
                setTimeout(resizeCanvas, 100);
            });
            
            // é¡µé¢å¯è§æ€§æ”¹å˜æ—¶æš‚åœæ¸¸æˆ
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && isPlaying && !isPaused) {
                    isPaused = true;
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­';
                    pauseBackgroundMusic();
                }
            });
            
            // ç”¨æˆ·äº¤äº’æ—¶åˆå§‹åŒ–éŸ³é¢‘
            document.addEventListener('click', () => {
                if (!audioInitialized) {
                    initAudio();
                }
            }, { once: true });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('load', () => {
            init();
            setupEventListeners();
            gameLoop();
            
            // å»¶è¿Ÿåˆå§‹åŒ–éŸ³é¢‘ï¼Œé¿å…è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢
            setTimeout(initAudio, 1000);
        });
    </script>
</body>
</html>