<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™å¿ƒæŠ„ç»</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f5f1e6;
            color: #3a281f;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            background-image: url('lianchi.jpg')
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 253, 248, 0.92);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
            border: 1px solid #e8dfca;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #e8dfca;
            padding-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2.8rem;
            color: #8b4513;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0522d;
            font-style: italic;
        }
        
        .content-area {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .sutra-display {
            flex: 1;
            min-width: 300px;
            background-color: #fffcf5;
            border-radius: 10px;
            padding: 25px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8dfca;
        }
        
        .sutra-title {
            font-size: 1.6rem;
            color: #8b4513;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .sutra-text {
            font-size: 1.3rem;
            line-height: 2.2;
            color: #3a281f;
            text-align: justify;
            font-family: 'Ma Shan Zheng', cursive;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .writing-area {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .writing-prompt {
            font-size: 1.1rem;
            color: #8b4513;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .character-to-copy {
            font-size: 3.5rem;
            text-align: center;
            margin: 20px 0;
            color: #8b4513;
            font-family: 'Ma Shan Zheng', cursive;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .writing-input {
            flex: 1;
            min-height: 300px;
            font-size: 2.2rem;
            font-family: 'Ma Shan Zheng', cursive;
            padding: 20px;
            border: 2px solid #d4b483;
            border-radius: 10px;
            background-color: #fffcf5;
            color: #3a281f;
            resize: none;
            outline: none;
            transition: all 0.3s;
            line-height: 1.8;
        }
        
        .writing-input:focus {
            border-color: #8b4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.2);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        button {
            padding: 12px 24px;
            font-size: 1rem;
            font-family: 'Noto Serif SC', serif;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .primary-btn {
            background-color: #8b4513;
            color: white;
        }
        
        .primary-btn:hover {
            background-color: #a0522d;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        
        .secondary-btn {
            background-color: #d4b483;
            color: #3a281f;
        }
        
        .secondary-btn:hover {
            background-color: #e8dfca;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(212, 180, 131, 0.3);
        }
        
        .success-btn {
            background-color: #5d8c5a;
            color: white;
        }
        
        .success-btn:hover {
            background-color: #6fa06c;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(93, 140, 90, 0.3);
        }
        
        .mute-btn-container {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .mute-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #d4b483;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mute-btn:hover {
            background-color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .progress-info {
            margin-top: 25px;
            text-align: center;
            font-size: 1.1rem;
            color: #8b4513;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e8dfca;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #8b4513;
            width: 0%;
            transition: width 0.5s;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #fffcf5;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .modal h2 {
            color: #8b4513;
            margin-bottom: 20px;
        }
        
        .modal p {
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #8b4513;
        }
        
        .dedication-text {
            width: 100%;
            height: 150px;
            padding: 15px;
            font-size: 1.1rem;
            font-family: 'Noto Serif SC', serif;
            border: 1px solid #d4b483;
            border-radius: 10px;
            margin: 20px 0;
            resize: none;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e8dfca;
            color: #a0522d;
            font-size: 0.9rem;
        }
        
        .character-count {
            font-size: 1rem;
            color: #8b4513;
            text-align: center;
            margin-top: 10px;
        }
        
        .autosave-notice {
            text-align: center;
            color: #5d8c5a;
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        @media (max-width: 768px) {
            .content-area {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .sutra-text {
                font-size: 1.1rem;
                line-height: 2;
            }
            
            .writing-input {
                font-size: 1.8rem;
            }
            
            .mute-btn-container {
                position: relative;
                top: 0;
                right: 0;
                text-align: center;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é™å¿ƒæŠ„ç»</h1>
            <p class="subtitle">ä¸€ç¬”ä¸€åˆ’ï¼Œé™å¿ƒä¿®æ…§ï¼›ä¸€å­—ä¸€å¥ï¼ŒåŠŸå¾·æ— é‡</p>
            <div class="mute-btn-container">
                <button class="mute-btn" id="muteBtn">ğŸ”Š é™éŸ³</button>
            </div>
        </header>
        
        <div class="content-area">
            <div class="sutra-display">
                <h2 class="sutra-title">ã€Šèˆ¬è‹¥æ³¢ç½—èœœå¤šå¿ƒç»ã€‹</h2>
                <div class="sutra-text" id="sutraText">
                    è§‚è‡ªåœ¨è©è¨ï¼Œè¡Œæ·±èˆ¬è‹¥æ³¢ç½—èœœå¤šæ—¶ï¼Œç…§è§äº”è•´çš†ç©ºï¼Œåº¦ä¸€åˆ‡è‹¦å„ã€‚èˆåˆ©å­ï¼Œè‰²ä¸å¼‚ç©ºï¼Œç©ºä¸å¼‚è‰²ï¼Œè‰²å³æ˜¯ç©ºï¼Œç©ºå³æ˜¯è‰²ï¼Œå—æƒ³è¡Œè¯†ï¼Œäº¦å¤å¦‚æ˜¯ã€‚èˆåˆ©å­ï¼Œæ˜¯è¯¸æ³•ç©ºç›¸ï¼Œä¸ç”Ÿä¸ç­ï¼Œä¸å¢ä¸å‡€ï¼Œä¸å¢ä¸å‡ã€‚æ˜¯æ•…ç©ºä¸­æ— è‰²ï¼Œæ— å—æƒ³è¡Œè¯†ï¼Œæ— çœ¼è€³é¼»èˆŒèº«æ„ï¼Œæ— è‰²å£°é¦™å‘³è§¦æ³•ï¼Œæ— çœ¼ç•Œï¼Œä¹ƒè‡³æ— æ„è¯†ç•Œã€‚æ— æ— æ˜ï¼Œäº¦æ— æ— æ˜å°½ï¼Œä¹ƒè‡³æ— è€æ­»ï¼Œäº¦æ— è€æ­»å°½ã€‚æ— è‹¦é›†ç­é“ï¼Œæ— æ™ºäº¦æ— å¾—ï¼Œä»¥æ— æ‰€å¾—æ•…ã€‚è©æè¨åŸµï¼Œä¾èˆ¬è‹¥æ³¢ç½—èœœå¤šæ•…ï¼Œå¿ƒæ— æŒ‚ç¢ï¼Œæ— æŒ‚ç¢æ•…ï¼Œæ— æœ‰ææ€–ï¼Œè¿œç¦»é¢ å€’æ¢¦æƒ³ï¼Œç©¶ç«Ÿæ¶…æ§ƒã€‚ä¸‰ä¸–è¯¸ä½›ï¼Œä¾èˆ¬è‹¥æ³¢ç½—èœœå¤šæ•…ï¼Œå¾—é˜¿è€¨å¤šç½—ä¸‰è—ä¸‰è©æã€‚æ•…çŸ¥èˆ¬è‹¥æ³¢ç½—èœœå¤šï¼Œæ˜¯å¤§ç¥å’’ï¼Œæ˜¯å¤§æ˜å’’ï¼Œæ˜¯æ— ä¸Šå’’ï¼Œæ˜¯æ— ç­‰ç­‰å’’ï¼Œèƒ½é™¤ä¸€åˆ‡è‹¦ï¼ŒçœŸå®ä¸è™šã€‚æ•…è¯´èˆ¬è‹¥æ³¢ç½—èœœå¤šå’’ï¼Œå³è¯´å’’æ›°ï¼šæ­è°›æ­è°›ï¼Œæ³¢ç½—æ­è°›ï¼Œæ³¢ç½—åƒ§æ­è°›ï¼Œè©æè¨å©†è¯ƒã€‚
                </div>
                <div class="progress-info">
                    æŠ„ç»è¿›åº¦ï¼š<span id="progressPercent">0</span>%
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>
            
            <div class="writing-area">
                <h3 class="writing-prompt">è¯·æŠ„å†™ä»¥ä¸‹ç»æ–‡ï¼š</h3>
                <div class="character-to-copy" id="characterToCopy">è§‚</div>
                <textarea class="writing-input" id="writingInput" placeholder="è¯·åœ¨æ­¤å¤„ç”¨é¼ æ ‡æˆ–è§¦æ‘¸å±ä¹¦å†™ç»æ–‡..."></textarea>
                <div class="character-count">å·²æŠ„å†™ <span id="charCount">0</span> / <span id="totalChars">276</span> å­—</div>
                <div class="autosave-notice" id="autosaveNotice">å†…å®¹å·²è‡ªåŠ¨ä¿å­˜</div>
                
                <div class="controls">
                    <button class="secondary-btn" id="prevBtn">
                        <span>â—€</span> ä¸Šä¸€ä¸ªå­—
                    </button>
                    <button class="primary-btn" id="nextBtn">
                        ä¸‹ä¸€ä¸ªå­— <span>â–¶</span>
                    </button>
                    <button class="success-btn" id="dedicateBtn">
                        ğŸ™ åŠŸå¾·å›å‘
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>æ„¿ä»¥æ­¤åŠŸå¾·ï¼Œåº„ä¸¥ä½›å‡€åœŸï¼Œä¸ŠæŠ¥å››é‡æ©ï¼Œä¸‹æµä¸‰é€”è‹¦ã€‚</p>
            <p>è‹¥æœ‰è§é—»è€…ï¼Œæ‚‰å‘è©æå¿ƒï¼Œå°½æ­¤ä¸€æŠ¥èº«ï¼ŒåŒç”Ÿæä¹å›½ã€‚</p>
        </footer>
    </div>
    
    <!-- åŠŸå¾·å›å‘æ¨¡æ€æ¡† -->
    <div class="modal" id="dedicationModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2>åŠŸå¾·å›å‘</h2>
            <p>æŠ„ç»åŠŸå¾·æ®Šèƒœè¡Œï¼Œæ— è¾¹èƒœç¦çš†å›å‘ã€‚<br>æ™®æ„¿æ²‰æººè¯¸ä¼—ç”Ÿï¼Œé€Ÿå¾€æ— é‡å…‰ä½›åˆ¹ã€‚</p>
            <p>è¯·å¡«å†™å›å‘æ–‡ï¼ˆå¯é€‰ï¼‰ï¼š</p>
            <textarea class="dedication-text" id="dedicationText" placeholder="ä¾‹å¦‚ï¼šæ„¿ä»¥æ­¤åŠŸå¾·ï¼Œå›å‘ç»™æˆ‘çš„å®¶äººæœ‹å‹ï¼Œæ„¿ä»–ä»¬å¹³å®‰å¥åº·ï¼Œç¦æ…§å¢é•¿..."></textarea>
            <button class="success-btn" id="confirmDedication">ç¡®è®¤å›å‘</button>
            <p style="margin-top: 20px; font-size: 0.9rem; color: #a0522d;">å›å‘åï¼Œæœ¬æ¬¡æŠ„ç»åŠŸå¾·åœ†æ»¡ã€‚</p>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="backgroundMusic" loop autoplay>
        <source src="beijing.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // ç»æ–‡å†…å®¹
        const sutra = "è§‚è‡ªåœ¨è©è¨ï¼Œè¡Œæ·±èˆ¬è‹¥æ³¢ç½—èœœå¤šæ—¶ï¼Œç…§è§äº”è•´çš†ç©ºï¼Œåº¦ä¸€åˆ‡è‹¦å„ã€‚èˆåˆ©å­ï¼Œè‰²ä¸å¼‚ç©ºï¼Œç©ºä¸å¼‚è‰²ï¼Œè‰²å³æ˜¯ç©ºï¼Œç©ºå³æ˜¯è‰²ï¼Œå—æƒ³è¡Œè¯†ï¼Œäº¦å¤å¦‚æ˜¯ã€‚èˆåˆ©å­ï¼Œæ˜¯è¯¸æ³•ç©ºç›¸ï¼Œä¸ç”Ÿä¸ç­ï¼Œä¸å¢ä¸å‡€ï¼Œä¸å¢ä¸å‡ã€‚æ˜¯æ•…ç©ºä¸­æ— è‰²ï¼Œæ— å—æƒ³è¡Œè¯†ï¼Œæ— çœ¼è€³é¼»èˆŒèº«æ„ï¼Œæ— è‰²å£°é¦™å‘³è§¦æ³•ï¼Œæ— çœ¼ç•Œï¼Œä¹ƒè‡³æ— æ„è¯†ç•Œã€‚æ— æ— æ˜ï¼Œäº¦æ— æ— æ˜å°½ï¼Œä¹ƒè‡³æ— è€æ­»ï¼Œäº¦æ— è€æ­»å°½ã€‚æ— è‹¦é›†ç­é“ï¼Œæ— æ™ºäº¦æ— å¾—ï¼Œä»¥æ— æ‰€å¾—æ•…ã€‚è©æè¨åŸµï¼Œä¾èˆ¬è‹¥æ³¢ç½—èœœå¤šæ•…ï¼Œå¿ƒæ— æŒ‚ç¢ï¼Œæ— æŒ‚ç¢æ•…ï¼Œæ— æœ‰ææ€–ï¼Œè¿œç¦»é¢ å€’æ¢¦æƒ³ï¼Œç©¶ç«Ÿæ¶…æ§ƒã€‚ä¸‰ä¸–è¯¸ä½›ï¼Œä¾èˆ¬è‹¥æ³¢ç½—èœœå¤šæ•…ï¼Œå¾—é˜¿è€¨å¤šç½—ä¸‰è—ä¸‰è©æã€‚æ•…çŸ¥èˆ¬è‹¥æ³¢ç½—èœœå¤šï¼Œæ˜¯å¤§ç¥å’’ï¼Œæ˜¯å¤§æ˜å’’ï¼Œæ˜¯æ— ä¸Šå’’ï¼Œæ˜¯æ— ç­‰ç­‰å’’ï¼Œèƒ½é™¤ä¸€åˆ‡è‹¦ï¼ŒçœŸå®ä¸è™šã€‚æ•…è¯´èˆ¬è‹¥æ³¢ç½—èœœå¤šå’’ï¼Œå³è¯´å’’æ›°ï¼šæ­è°›æ­è°›ï¼Œæ³¢ç½—æ­è°›ï¼Œæ³¢ç½—åƒ§æ­è°›ï¼Œè©æè¨å©†è¯ƒã€‚";
        
        // è·å–DOMå…ƒç´ 
        const sutraText = document.getElementById('sutraText');
        const characterToCopy = document.getElementById('characterToCopy');
        const writingInput = document.getElementById('writingInput');
        const charCount = document.getElementById('charCount');
        const totalChars = document.getElementById('totalChars');
        const progressPercent = document.getElementById('progressPercent');
        const progressFill = document.getElementById('progressFill');
        const autosaveNotice = document.getElementById('autosaveNotice');
        
        // æŒ‰é’®å…ƒç´ 
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const dedicateBtn = document.getElementById('dedicateBtn');
        
        // éŸ³ä¹æ§åˆ¶å…ƒç´ 
        const backgroundMusic = document.getElementById('backgroundMusic');
        const muteBtn = document.getElementById('muteBtn');
        
        // æ¨¡æ€æ¡†å…ƒç´ 
        const dedicationModal = document.getElementById('dedicationModal');
        const closeModal = document.getElementById('closeModal');
        const confirmDedication = document.getElementById('confirmDedication');
        const dedicationText = document.getElementById('dedicationText');
        
        // åˆå§‹åŒ–å˜é‡
        let currentIndex = 0;
        let writtenText = "";
        let savedProgress = localStorage.getItem('sutraProgress') ? JSON.parse(localStorage.getItem('sutraProgress')) : {
            index: 0,
            text: ""
        };
        let isMuted = false;
        
        // åˆå§‹åŒ–é¡µé¢
        function init() {
            totalChars.textContent = sutra.length;
            
            // æ¢å¤ä¿å­˜çš„è¿›åº¦
            if (savedProgress.text && savedProgress.text.length > 0) {
                currentIndex = savedProgress.index;
                writtenText = savedProgress.text;
                writingInput.value = writtenText;
                updateDisplay();
                showAutosaveNotice("è¿›åº¦å·²æ¢å¤");
            } else {
                updateDisplay();
            }
            
            // è®¾ç½®è‡ªåŠ¨ä¿å­˜
            setInterval(autoSave, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
            
            // è¾“å…¥æ¡†è¾“å…¥æ—¶è‡ªåŠ¨ä¿å­˜
            writingInput.addEventListener('input', function() {
                writtenText = this.value;
                currentIndex = writtenText.length;
                updateDisplay();
                autoSave();
            });
            
            // å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆéŸ³é‡è°ƒä½ï¼‰
            backgroundMusic.volume = 0.3;
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼Œå¦‚æœå¤±è´¥åˆ™é™éŸ³
            backgroundMusic.play().catch(e => {
                console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨æ’­æ”¾");
                isMuted = true;
                muteBtn.textContent = "ğŸ”‡ å–æ¶ˆé™éŸ³";
                backgroundMusic.pause();
            });
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ›´æ–°å½“å‰è¦æŠ„å†™çš„å­—
            if (currentIndex < sutra.length) {
                characterToCopy.textContent = sutra[currentIndex];
            } else {
                characterToCopy.textContent = "å·²å®Œæˆ";
            }
            
            // æ›´æ–°æŠ„å†™è®¡æ•°
            charCount.textContent = writtenText.length;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = Math.min(100, Math.round((writtenText.length / sutra.length) * 100));
            progressPercent.textContent = progress;
            progressFill.style.width = `${progress}%`;
            
            // é«˜äº®æ˜¾ç¤ºå·²æŠ„å†™çš„ç»æ–‡
            highlightSutraText();
        }
        
        // é«˜äº®æ˜¾ç¤ºå·²æŠ„å†™çš„ç»æ–‡
        function highlightSutraText() {
            let highlightedText = "";
            for (let i = 0; i < sutra.length; i++) {
                if (i < writtenText.length) {
                    // å·²æŠ„å†™çš„å­—ç”¨ç‰¹æ®Šæ ·å¼
                    highlightedText += `<span style="color:#8b4513; font-weight:bold; text-decoration:underline;">${sutra[i]}</span>`;
                } else if (i === currentIndex) {
                    // å½“å‰è¦æŠ„å†™çš„å­—ç”¨ä¸åŒæ ·å¼
                    highlightedText += `<span style="color:#a0522d; background-color:#f5e9d9; padding:2px; border-radius:3px;">${sutra[i]}</span>`;
                } else {
                    // æœªæŠ„å†™çš„å­—
                    highlightedText += sutra[i];
                }
            }
            sutraText.innerHTML = highlightedText;
        }
        
        // ä¸Šä¸€ä¸ªå­—
        prevBtn.addEventListener('click', function() {
            if (currentIndex > 0) {
                currentIndex--;
                writtenText = writtenText.substring(0, currentIndex);
                writingInput.value = writtenText;
                updateDisplay();
                autoSave();
                showAutosaveNotice("å·²è¿”å›ä¸Šä¸€ä¸ªå­—");
            }
        });
        
        // ä¸‹ä¸€ä¸ªå­—
        nextBtn.addEventListener('click', function() {
            if (currentIndex < sutra.length) {
                writtenText += sutra[currentIndex];
                currentIndex++;
                writingInput.value = writtenText;
                updateDisplay();
                autoSave();
            }
        });
        
        // è‡ªåŠ¨ä¿å­˜
        function autoSave() {
            savedProgress = {
                index: currentIndex,
                text: writtenText
            };
            localStorage.setItem('sutraProgress', JSON.stringify(savedProgress));
            
            // æ¯5æ¬¡è‡ªåŠ¨ä¿å­˜æ˜¾ç¤ºä¸€æ¬¡é€šçŸ¥
            if (Math.random() < 0.2) {
                showAutosaveNotice("è¿›åº¦å·²è‡ªåŠ¨ä¿å­˜");
            }
        }
        
        // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜é€šçŸ¥
        function showAutosaveNotice(message) {
            autosaveNotice.textContent = message;
            autosaveNotice.style.opacity = "1";
            setTimeout(() => {
                autosaveNotice.style.opacity = "0";
            }, 2000);
        }
        
        // é™éŸ³æŒ‰é’®
        muteBtn.addEventListener('click', function() {
            isMuted = !isMuted;
            
            if (isMuted) {
                backgroundMusic.pause();
                muteBtn.textContent = "ğŸ”‡ å–æ¶ˆé™éŸ³";
            } else {
                backgroundMusic.play().catch(e => {
                    console.log("æ’­æ”¾å¤±è´¥ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’");
                });
                muteBtn.textContent = "ğŸ”Š é™éŸ³";
            }
        });
        
        // åŠŸå¾·å›å‘
        dedicateBtn.addEventListener('click', function() {
            dedicationModal.style.display = 'flex';
        });
        
        // ç¡®è®¤å›å‘
        confirmDedication.addEventListener('click', function() {
            const dedication = dedicationText.value.trim();
            const message = dedication ? 
                `åŠŸå¾·å›å‘æˆåŠŸï¼å›å‘æ–‡ï¼š${dedication}` : 
                "åŠŸå¾·å›å‘æˆåŠŸï¼æ„¿æ­¤åŠŸå¾·æ™®åŠäºä¸€åˆ‡ï¼Œæˆ‘ç­‰ä¸ä¼—ç”Ÿçš†å…±æˆä½›é“ã€‚";
            
            alert(message);
            dedicationModal.style.display = 'none';
            dedicationText.value = "";
            
            // å›å‘åå¯æ¸…ç©ºè¿›åº¦é‡æ–°å¼€å§‹
            if (confirm("åŠŸå¾·å›å‘å·²å®Œæˆï¼æ‚¨æƒ³æ¸…ç©ºå½“å‰è¿›åº¦é‡æ–°å¼€å§‹æŠ„ç»å—ï¼Ÿ")) {
                localStorage.removeItem('sutraProgress');
                currentIndex = 0;
                writtenText = "";
                writingInput.value = "";
                updateDisplay();
                showAutosaveNotice("è¿›åº¦å·²æ¸…ç©ºï¼Œå¯ä»¥é‡æ–°å¼€å§‹");
            }
        });
        
        // å…³é—­æ¨¡æ€æ¡†
        closeModal.addEventListener('click', function() {
            dedicationModal.style.display = 'none';
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            if (event.target === dedicationModal) {
                dedicationModal.style.display = 'none';
            }
        });
        
        // åˆå§‹åŒ–é¡µé¢
        init();
    </script>
</body>
</html>