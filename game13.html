<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å•äººå£çƒæŒ‘æˆ˜èµ›</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
        }
        
        html, body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #000;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            overscroll-behavior: none;
        }
        
        /* é˜²æ­¢iOSæ©¡çš®ç­‹æ•ˆæœ */
        body {
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        /* èƒŒæ™¯å›¾ç‰‡ */
        #background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://amitofoicu.github.io/home/lianchi.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.7;
            z-index: -2;
        }
        
        /* èƒŒæ™¯é®ç½© */
        #background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 20, 40, 0.85);
            z-index: -1;
        }
        
        /* æ›´å¤šæ¸¸æˆè§’æ ‡ */
        .more-games-corner {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 100;
            padding: 8px 15px;
            background: linear-gradient(135deg, #ff3366, #ff6633);
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(255, 51, 102, 0.4);
            transition: all 0.3s ease;
        }
        
        .more-games-corner:hover, .more-games-corner:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 51, 102, 0.6);
        }
        
        .more-games-link {
            color: white;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .more-games-link i {
            font-size: 16px;
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            overflow: hidden;
        }
        
        /* æ ‡é¢˜ */
        .header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
            background: linear-gradient(90deg, #FFD700, #FFA500, #FF6347);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            font-weight: 800;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            color: #e0e0ff;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        /* æ¸¸æˆUI */
        .game-ui {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.12);
            padding: 15px 20px;
            border-radius: 12px;
            min-width: 120px;
            text-align: center;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        .stat-label {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-bottom: 5px;
            color: #b0b0ff;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: #FFD700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* æ¸¸æˆç”»å¸ƒå®¹å™¨ */
        .canvas-container {
            width: 100%;
            max-width: 800px;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 215, 0, 0.3);
            position: relative;
            background-color: rgba(10, 15, 35, 0.85);
            touch-action: manipulation;
            height: 500px; /* å›ºå®šé«˜åº¦ */
            margin: 0 auto;
        }
        
        /* æ¸¸æˆç”»å¸ƒ */
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        /* æ§åˆ¶åŒºåŸŸ - PCç«¯ */
        .pc-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 25px;
            width: 100%;
            max-width: 800px;
        }
        
        .control-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 12px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-width: 50px;
            text-align: center;
            color: #FFD700;
        }
        
        /* æŒ‰é’® */
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(to bottom, #4a6ee0, #3a5ed0);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(58, 94, 208, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #5a7ef0, #4a6ee0);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(58, 94, 208, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button#restartBtn {
            background: linear-gradient(to bottom, #FF9800, #F57C00);
            box-shadow: 0 4px 12px rgba(245, 124, 0, 0.4);
        }
        
        button#restartBtn:hover {
            background: linear-gradient(to bottom, #FFB74D, #FF9800);
            box-shadow: 0 6px 18px rgba(245, 124, 0, 0.6);
        }
        
        /* èŠ±æœµç‰¹æ•ˆå®¹å™¨ */
        #flower-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: hidden;
        }
        
        .flower {
            position: absolute;
            font-size: 24px;
            opacity: 0;
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* å¾—åˆ†åŠ¨ç”» */
        .score-popup {
            position: absolute;
            font-size: 28px;
            font-weight: 900;
            color: #FFD700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
            z-index: 5;
            pointer-events: none;
            animation: scorePopup 1s ease-out forwards;
        }
        
        @keyframes scorePopup {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translateY(-30px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.8);
            }
        }
        
        /* æ¸¸æˆç»“æŸç•Œé¢ */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.92);
            padding: 45px;
            border-radius: 16px;
            text-align: center;
            display: none;
            z-index: 100;
            width: 90%;
            max-width: 500px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.4);
            backdrop-filter: blur(10px);
        }
        
        .game-over h2 {
            font-size: 2.8rem;
            color: #FFD700;
            margin-bottom: 20px;
        }
        
        .game-over p {
            font-size: 1.4rem;
            margin-bottom: 35px;
            color: #e0e0ff;
        }
        
        /* ç§»åŠ¨ç«¯æ§åˆ¶æŒ‰é’® */
        .mobile-controls {
            display: none;
            margin-top: 25px;
            width: 100%;
            max-width: 300px;
            justify-content: center;
            gap: 20px;
        }
        
        .mobile-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
        }
        
        /* éŸ³é¢‘æ§åˆ¶ */
        .audio-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* PCç«¯ä¸“ç”¨æ ·å¼ */
        @media (min-width: 769px) {
            .mobile-controls {
                display: none !important;
            }
            
            .pc-controls {
                display: flex !important;
            }
        }
        
        /* ç§»åŠ¨ç«¯æ ·å¼ */
        @media (max-width: 768px) {
            .pc-controls {
                display: none !important; /* ç§»åŠ¨ç«¯éšè—æ§åˆ¶åŒºåŸŸ */
            }
            
            .mobile-controls {
                display: flex;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1rem;
                padding: 0 10px;
            }
            
            .game-ui {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .stats {
                width: 100%;
                justify-content: center;
            }
            
            .stat-box {
                min-width: 100px;
                padding: 12px 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .more-games-corner {
                top: 10px;
                left: 10px;
                padding: 6px 12px;
            }
            
            .more-games-link {
                font-size: 13px;
            }
            
            /* ç§»åŠ¨ç«¯è°ƒæ•´ç”»å¸ƒé«˜åº¦ */
            .canvas-container {
                height: 400px;
            }
            
            /* ç§»åŠ¨ç«¯æ¸¸æˆå®¹å™¨è°ƒæ•´ */
            .game-container {
                padding: 15px;
                padding-top: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 15px;
                padding-top: 60px;
            }
            
            .stat-box {
                min-width: 85px;
                padding: 10px 12px;
            }
            
            .stat-label {
                font-size: 0.85rem;
            }
            
            .stat-value {
                font-size: 1.6rem;
            }
            
            .game-over {
                padding: 30px 20px;
                width: 95%;
            }
            
            .game-over h2 {
                font-size: 2.2rem;
            }
            
            .game-over p {
                font-size: 1.2rem;
            }
            
            /* iPhoneç«–å±ä¼˜åŒ– */
            .canvas-container {
                height: 350px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            
            .game-ui {
                margin-bottom: 10px;
            }
        }
        
        /* iPhoneç«–å±ç‰¹æ®Šä¼˜åŒ– */
        @media (max-width: 480px) and (max-height: 850px) {
            .game-container {
                padding-top: 50px;
            }
            
            .canvas-container {
                height: 300px;
            }
            
            .header {
                margin-bottom: 15px;
            }
            
            .stat-box {
                padding: 8px 10px;
                min-width: 70px;
            }
            
            .stat-value {
                font-size: 1.4rem;
            }
            
            .mobile-controls {
                margin-top: 15px;
            }
            
            .mobile-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }
        }
        
        /* iPhoneå°å±å¹•ç‰¹æ®Šä¼˜åŒ– */
        @media (max-width: 375px) and (max-height: 670px) {
            .canvas-container {
                height: 280px;
            }
            
            .game-container {
                padding-top: 40px;
                padding: 10px;
                padding-top: 40px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .stat-box {
                padding: 6px 8px;
                min-width: 65px;
            }
            
            .stat-label {
                font-size: 0.75rem;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
            
            .mobile-btn {
                width: 65px;
                height: 65px;
                font-size: 24px;
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 600px) {
            .game-container {
                padding-top: 15px;
            }
            
            .header {
                margin-bottom: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            
            .game-ui {
                margin-bottom: 10px;
            }
            
            .stat-box {
                padding: 8px 12px;
                min-width: 80px;
            }
            
            .stat-value {
                font-size: 1.4rem;
            }
            
            .canvas-container {
                height: 280px;
            }
            
            .mobile-controls {
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å›¾ç‰‡ -->
    <div id="background-image"></div>
    <div id="background-overlay"></div>
    
    <!-- èŠ±æœµç‰¹æ•ˆå®¹å™¨ -->
    <div id="flower-effects"></div>
    
    <!-- æ›´å¤šæ¸¸æˆè§’æ ‡ -->
    <div class="more-games-corner">
        <a href="https://amitofoicu.github.io/home" class="more-games-link">
            <i class="fas fa-gamepad"></i>
            <span>æ›´å¤šæ¸¸æˆ</span>
        </a>
    </div>
    
    <!-- éŸ³é¢‘æ§åˆ¶ -->
    <div class="audio-control" id="audioToggle">
        <i class="fas fa-volume-up" id="audioIcon"></i>
    </div>
    
    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div class="game-container">
        <div class="header">
            <h1>å•äººå£çƒæŒ‘æˆ˜èµ›</h1>
            <p class="subtitle">æŒ‰ç©ºæ ¼é”®ä»çƒæ‹å‘å°„çƒï¼Œå‡»ä¸­ç›®æ ‡å¾—åˆ†ï¼æ¯100åˆ†è§¦å‘èŠ±æœµç‰¹æ•ˆã€‚</p>
        </div>
        
        <div class="game-ui">
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">åˆ†æ•°</div>
                    <div id="score" class="stat-value">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ç”Ÿå‘½å€¼</div>
                    <div id="lives" class="stat-value">3</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ç­‰çº§</div>
                    <div id="level" class="stat-value">1</div>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç”»å¸ƒå®¹å™¨ -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="800" height="500"></canvas>
        </div>
        
        <!-- ç§»åŠ¨ç«¯æ§åˆ¶æŒ‰é’® -->
        <div class="mobile-controls">
            <div class="mobile-btn" id="mobileLeft">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="mobile-btn" id="mobileSpace">
                <i class="fas fa-arrow-up"></i>
                <span style="font-size: 12px; margin-left: 5px;">å‘å°„</span>
            </div>
            <div class="mobile-btn" id="mobileRight">
                <i class="fas fa-arrow-right"></i>
            </div>
        </div>
        
        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® - PCç«¯æ˜¾ç¤º -->
        <div class="pc-controls">
            <div class="control-info">
                <div class="control-item">
                    <div class="key">â† â†’</div>
                    <span>ç§»åŠ¨çƒæ‹</span>
                </div>
                <div class="control-item">
                    <div class="key">ç©ºæ ¼</div>
                    <span>å‘å°„çƒ/æš‚åœ</span>
                </div>
                <div class="control-item">
                    <div class="key">R</div>
                    <span>é‡æ–°å¼€å§‹</span>
                </div>
            </div>
            
            <div class="buttons">
                <button id="startBtn">
                    <i class="fas fa-play"></i>
                    <span>å¼€å§‹æ¸¸æˆ</span>
                </button>
                <button id="pauseBtn">
                    <i class="fas fa-pause"></i>
                    <span>æš‚åœæ¸¸æˆ</span>
                </button>
                <button id="restartBtn">
                    <i class="fas fa-redo"></i>
                    <span>é‡æ–°å¼€å§‹</span>
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="gameOver" class="game-over">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
            <button id="playAgainBtn">
                <i class="fas fa-redo"></i>
                <span>å†æ¥ä¸€å±€</span>
            </button>
        </div>
    </div>
    
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="backgroundMusic" loop>
        <source src="https://amitofoicu.github.io/home/beijing.ogg" type="audio/ogg">
    </audio>
    
    <!-- å¾—åˆ†éŸ³æ•ˆ -->
    <audio id="scoreSound">
        <source src="https://amitofoicu.github.io/home/xiaochu.mp3" type="audio/mpeg">
    </audio>
    
    <!-- æ–°çš„å‡»çƒå¾—åˆ†éŸ³æ•ˆ -->
    <audio id="winSound" preload="auto">
        <source src="https://amitofoicu.github.io/home/win.mp3" type="audio/mpeg">
    </audio>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // æ¸¸æˆçŠ¶æ€
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let lives = 3;
        let level = 1;
        let animationId = null;
        let ballOnPaddle = true; // çƒæ˜¯å¦åœ¨çƒæ‹ä¸Šï¼ˆç­‰å¾…å‘å°„ï¼‰
        let lastScoreForEffect = 0; // ä¸Šæ¬¡è§¦å‘ç‰¹æ•ˆçš„åˆ†æ•°
        let isMobile = false; // æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡

        // çƒæ‹å±æ€§
        const paddle = {
            width: 100,
            height: 15,
            x: canvas.width / 2 - 50,
            y: canvas.height - 30,
            speed: 8,
            color: '#4a6ee0',
            borderColor: '#5a7ef0'
        };

        // çƒå±æ€§
        const ball = {
            x: canvas.width / 2,
            y: canvas.height - 45, // åˆå§‹ä½ç½®åœ¨çƒæ‹ä¸Šæ–¹
            radius: 10,
            speedX: 0, // åˆå§‹é€Ÿåº¦ä¸º0ï¼Œç­‰å¾…å‘å°„
            speedY: 0,
            color: '#FFD700',
            borderColor: '#FFA500'
        };

        // ç›®æ ‡å±æ€§ - æ ¹æ®è®¾å¤‡ç±»å‹è°ƒæ•´
        let targets = [];
        let targetRows = 5;
        let targetCols = 10;
        let targetWidth = 70;
        let targetHeight = 20;
        let targetPadding = 5;
        let targetOffsetTop = 50;
        let targetOffsetLeft = 25;

        // éŸ³é¢‘å…ƒç´ 
        const backgroundMusic = document.getElementById('backgroundMusic');
        const scoreSound = document.getElementById('scoreSound');
        const winSound = document.getElementById('winSound');
        let musicEnabled = true;

        // èŠ±æœµé¢œè‰²æ•°ç»„
        const flowerColors = ['#FF3366', '#FF6633', '#FF33CC', '#33FF99', '#33CCFF', '#FFCC00', '#9966FF'];
        const flowerIcons = ['â€', 'âœ¿', 'â', 'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¼', 'ğŸŒ»'];

        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function detectDevice() {
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            return isMobile;
        }

        // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´ç›®æ ‡å‚æ•°ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
        function adjustTargetParameters() {
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            
            if (isMobile && window.innerWidth < 768) {
                // ç§»åŠ¨ç«¯ç«–å±è°ƒæ•´
                if (canvasWidth < 400) {
                    targetCols = 6;
                    targetRows = 4;
                    targetWidth = Math.max(40, (canvasWidth - targetOffsetLeft * 2 - targetPadding * (targetCols - 1)) / targetCols);
                    targetHeight = 15;
                    targetPadding = 3;
                    targetOffsetTop = 40;
                    targetOffsetLeft = (canvasWidth - (targetCols * targetWidth + (targetCols - 1) * targetPadding)) / 2;
                } else {
                    targetCols = 8;
                    targetRows = 5;
                    targetWidth = Math.max(45, (canvasWidth - targetOffsetLeft * 2 - targetPadding * (targetCols - 1)) / targetCols);
                    targetHeight = 18;
                    targetPadding = 4;
                    targetOffsetTop = 45;
                    targetOffsetLeft = (canvasWidth - (targetCols * targetWidth + (targetCols - 1) * targetPadding)) / 2;
                }
                
                // ç¡®ä¿ç›®æ ‡ä¸ä¼šå¤ªå°æˆ–å¤ªå¤§
                targetWidth = Math.min(Math.max(targetWidth, 40), 70);
                targetHeight = Math.min(Math.max(targetHeight, 12), 20);
                
                // ç¡®ä¿ç›®æ ‡ä¸ä¼šè¶…å‡ºå±å¹•
                const totalWidth = targetCols * targetWidth + (targetCols - 1) * targetPadding;
                if (totalWidth > canvasWidth - 10) {
                    targetWidth = (canvasWidth - 10 - (targetCols - 1) * targetPadding) / targetCols;
                }
            } else {
                // PCç«¯é»˜è®¤å‚æ•°
                targetCols = 10;
                targetRows = 5;
                targetWidth = 70;
                targetHeight = 20;
                targetPadding = 5;
                targetOffsetTop = 50;
                targetOffsetLeft = 25;
                
                // å¦‚æœç”»å¸ƒè¾ƒå°ï¼Œé€‚å½“è°ƒæ•´
                if (canvasWidth < 600) {
                    targetCols = 8;
                    targetWidth = Math.max(50, (canvasWidth - targetOffsetLeft * 2 - targetPadding * (targetCols - 1)) / targetCols);
                }
            }
        }

        // åˆå§‹åŒ–ç›®æ ‡
        function initTargets() {
            targets = [];
            adjustTargetParameters();
            
            for (let r = 0; r < targetRows; r++) {
                for (let c = 0; c < targetCols; c++) {
                    // éšæœºç”Ÿæˆç‰¹æ®Šç›®æ ‡
                    let isSpecial = Math.random() < 0.1; // 10%æ¦‚ç‡ç”Ÿæˆç‰¹æ®Šç›®æ ‡
                    let color, points, isLife;
                    
                    if (isSpecial) {
                        // éšæœºé€‰æ‹©ç‰¹æ®Šç›®æ ‡ç±»å‹
                        if (Math.random() < 0.5) {
                            color = '#FFD700'; // é‡‘è‰²ç›®æ ‡ - é«˜åˆ†
                            points = 50;
                            isLife = false;
                        } else {
                            color = '#FF5252'; // çº¢è‰²ç›®æ ‡ - æ¢å¤ç”Ÿå‘½
                            points = 10;
                            isLife = true;
                        }
                    } else {
                        // æ™®é€šç›®æ ‡
                        const hue = 200 + (r * 20); // ä¸åŒè¡Œçš„é¢œè‰²ä¸åŒ
                        color = `hsl(${hue}, 70%, 60%)`;
                        points = 10;
                        isLife = false;
                    }
                    
                    targets.push({
                        x: c * (targetWidth + targetPadding) + targetOffsetLeft,
                        y: r * (targetHeight + targetPadding) + targetOffsetTop,
                        width: targetWidth,
                        height: targetHeight,
                        color: color,
                        points: points,
                        isLife: isLife,
                        visible: true
                    });
                }
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            score = 0;
            lives = 3;
            level = 1;
            ballOnPaddle = true;
            lastScoreForEffect = 0;
            
            // é‡ç½®çƒæ‹ä½ç½®
            paddle.x = canvas.width / 2 - paddle.width / 2;
            
            // æ ¹æ®è®¾å¤‡è°ƒæ•´çƒæ‹å¤§å°
            if (isMobile) {
                paddle.width = Math.min(120, canvas.width * 0.2);
                paddle.speed = 6;
            } else {
                paddle.width = 100;
                paddle.speed = 8;
            }
            
            // è°ƒæ•´çƒçš„å¤§å°
            ball.radius = isMobile ? Math.min(10, canvas.width * 0.02) : 10;
            
            // é‡ç½®çƒä½ç½®å’Œé€Ÿåº¦ï¼ˆåœ¨çƒæ‹ä¸Šç­‰å¾…å‘å°„ï¼‰
            ball.x = paddle.x + paddle.width / 2;
            ball.y = paddle.y - ball.radius;
            ball.speedX = 0;
            ball.speedY = 0;
            
            // åˆå§‹åŒ–ç›®æ ‡
            initTargets();
            
            // æ›´æ–°UI
            updateUI();
            
            // éšè—æ¸¸æˆç»“æŸç•Œé¢
            document.getElementById('gameOver').style.display = 'none';
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            if (musicEnabled) {
                backgroundMusic.volume = 0.5;
                backgroundMusic.play().catch(e => console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’"));
            }
        }

        // ç»˜åˆ¶çƒæ‹
        function drawPaddle() {
            // ç»˜åˆ¶çƒæ‹é˜´å½±
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 5;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            // ç»˜åˆ¶çƒæ‹ä¸»ä½“
            ctx.fillStyle = paddle.color;
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
            
            // ç»˜åˆ¶çƒæ‹è¾¹æ¡†
            ctx.strokeStyle = paddle.borderColor;
            ctx.lineWidth = 2;
            ctx.strokeRect(paddle.x, paddle.y, paddle.width, paddle.height);
            
            // ç»˜åˆ¶çƒæ‹å†…éƒ¨ç»†èŠ‚
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.fillRect(paddle.x + 5, paddle.y + 3, paddle.width - 10, paddle.height - 6);
            
            // é‡ç½®é˜´å½±
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // ç»˜åˆ¶çƒ
        function drawBall() {
            // å¦‚æœçƒåœ¨çƒæ‹ä¸Šç­‰å¾…å‘å°„ï¼Œç»˜åˆ¶ç‰¹æ®Šæ•ˆæœ
            if (ballOnPaddle) {
                // ç»˜åˆ¶è„‰åŠ¨æ•ˆæœ
                const pulseSize = Math.sin(Date.now() / 200) * 2;
                
                // ç»˜åˆ¶çƒé˜´å½±
                ctx.shadowColor = 'rgba(255, 215, 0, 0.5)';
                ctx.shadowBlur = 10 + pulseSize * 3;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                
                // ç»˜åˆ¶çƒä½“
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius + pulseSize, 0, Math.PI * 2);
                ctx.fillStyle = '#FFD700';
                ctx.fill();
                
                // ç»˜åˆ¶çƒè¾¹æ¡†
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // åªåœ¨PCç«¯æ˜¾ç¤ºæç¤ºæ–‡å­—
                if (!isMobile) {
                    ctx.font = "14px Arial";
                    ctx.fillStyle = "#FFFFFF";
                    ctx.textAlign = "center";
                    ctx.fillText("æŒ‰ç©ºæ ¼å‘å°„", ball.x, ball.y - ball.radius - 15);
                }
                
                // é‡ç½®é˜´å½±
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
            } else {
                // æ­£å¸¸ç»˜åˆ¶çƒ
                ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                ctx.shadowBlur = 8;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = ball.color;
                ctx.fill();
                
                ctx.strokeStyle = ball.borderColor;
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
            }
            
            // ç»˜åˆ¶çƒé«˜å…‰
            ctx.beginPath();
            ctx.arc(ball.x - ball.radius/3, ball.y - ball.radius/3, ball.radius/3, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.fill();
        }

        // ç»˜åˆ¶ç›®æ ‡
        function drawTargets() {
            targets.forEach(target => {
                if (!target.visible) return;
                
                // ç»˜åˆ¶ç›®æ ‡é˜´å½±
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                // ç»˜åˆ¶ç›®æ ‡ä¸»ä½“
                ctx.fillStyle = target.color;
                ctx.fillRect(target.x, target.y, target.width, target.height);
                
                // ç»˜åˆ¶ç›®æ ‡è¾¹æ¡†
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 1;
                ctx.strokeRect(target.x, target.y, target.width, target.height);
                
                // ç‰¹æ®Šç›®æ ‡æ·»åŠ é¢å¤–æ•ˆæœ
                if (target.points === 50) {
                    // é‡‘è‰²ç›®æ ‡çš„ç‰¹æ®Šæ•ˆæœ
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fillRect(target.x + 5, target.y + 3, target.width - 10, target.height - 6);
                } else if (target.isLife) {
                    // ç”Ÿå‘½ç›®æ ‡çš„ç‰¹æ®Šæ•ˆæœ
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.beginPath();
                    ctx.arc(target.x + target.width/2, target.y + target.height/2, target.height/3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // é‡ç½®é˜´å½±
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
            });
        }

        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // æ¸…é™¤ç”»å¸ƒï¼Œä½¿ç”¨åŠé€æ˜é»‘è‰²å®ç°æ¸éšæ•ˆæœ
            ctx.fillStyle = 'rgba(10, 15, 35, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            
            // å‚ç›´çº¿
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        // åˆ›å»ºå¾—åˆ†åŠ¨ç”»
        function createScoreAnimation(x, y, points) {
            const canvasContainer = document.querySelector('.canvas-container');
            const scorePopup = document.createElement('div');
            scorePopup.className = 'score-popup';
            scorePopup.textContent = `+${points}`;
            
            // æ ¹æ®è®¾å¤‡è°ƒæ•´å­—ä½“å¤§å°
            const fontSize = isMobile ? '20px' : '28px';
            scorePopup.style.fontSize = fontSize;
            
            // è®¡ç®—ç›¸å¯¹äºå®¹å™¨çš„ä½ç½®
            const rect = canvas.getBoundingClientRect();
            const containerRect = canvasContainer.getBoundingClientRect();
            const relativeX = x * (rect.width / canvas.width);
            const relativeY = y * (rect.height / canvas.height);
            
            scorePopup.style.left = `${relativeX}px`;
            scorePopup.style.top = `${relativeY}px`;
            
            canvasContainer.appendChild(scorePopup);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (scorePopup.parentNode) {
                    scorePopup.parentNode.removeChild(scorePopup);
                }
            }, 1000);
        }

        // å‘å°„çƒ
        function launchBall() {
            if (ballOnPaddle && gameRunning && !gamePaused) {
                ballOnPaddle = false;
                // è®¾ç½®çƒçš„åˆå§‹é€Ÿåº¦
                const baseSpeed = isMobile ? 4 : 5;
                ball.speedX = (Math.random() > 0.5 ? 1 : -1) * baseSpeed;
                ball.speedY = -baseSpeed;
            }
        }

        // æ›´æ–°çƒçš„ä½ç½®
        function updateBall() {
            if (ballOnPaddle) {
                // çƒåœ¨çƒæ‹ä¸Šï¼Œè·Ÿéšçƒæ‹ç§»åŠ¨
                ball.x = paddle.x + paddle.width / 2;
                ball.y = paddle.y - ball.radius;
            } else {
                // ç§»åŠ¨çƒ
                ball.x += ball.speedX;
                ball.y += ball.speedY;
                
                // æ£€æµ‹ä¸å¢™å£çš„ç¢°æ’
                if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {
                    ball.speedX = -ball.speedX;
                }
                
                // æ£€æµ‹ä¸å¤©èŠ±æ¿çš„ç¢°æ’
                if (ball.y - ball.radius < 0) {
                    ball.speedY = -ball.speedY;
                }
                
                // æ£€æµ‹ä¸çƒæ‹çš„ç¢°æ’
                if (
                    ball.y + ball.radius > paddle.y &&
                    ball.y - ball.radius < paddle.y + paddle.height &&
                    ball.x > paddle.x &&
                    ball.x < paddle.x + paddle.width
                ) {
                    // æ ¹æ®å‡»ä¸­çƒæ‹çš„ä½ç½®è°ƒæ•´åå¼¹è§’åº¦
                    let hitPoint = (ball.x - paddle.x) / paddle.width;
                    const angleMultiplier = isMobile ? 8 : 10;
                    ball.speedX = (hitPoint - 0.5) * angleMultiplier;
                    ball.speedY = -Math.abs(ball.speedY); // ç¡®ä¿çƒå‘ä¸Šåå¼¹
                }
                
                // æ£€æµ‹çƒæ˜¯å¦è½åˆ°åº•éƒ¨
                if (ball.y + ball.radius > canvas.height) {
                    lives--;
                    updateUI();
                    
                    if (lives <= 0) {
                        gameOver();
                    } else {
                        // é‡ç½®çƒçš„ä½ç½®åˆ°çƒæ‹ä¸Š
                        ballOnPaddle = true;
                        ball.x = paddle.x + paddle.width / 2;
                        ball.y = paddle.y - ball.radius;
                        ball.speedX = 0;
                        ball.speedY = 0;
                    }
                }
                
                // æ£€æµ‹ä¸ç›®æ ‡çš„ç¢°æ’
                targets.forEach(target => {
                    if (!target.visible) return;
                    
                    if (
                        ball.x + ball.radius > target.x &&
                        ball.x - ball.radius < target.x + target.width &&
                        ball.y + ball.radius > target.y &&
                        ball.y - ball.radius < target.y + target.height
                    ) {
                        // å‡»ä¸­ç›®æ ‡
                        target.visible = false;
                        ball.speedY = -ball.speedY;
                        
                        // æ›´æ–°åˆ†æ•°
                        score += target.points;
                        
                        // åˆ›å»ºå¾—åˆ†åŠ¨ç”»
                        createScoreAnimation(ball.x, ball.y - 20, target.points);
                        
                        // æ’­æ”¾å‡»çƒå¾—åˆ†éŸ³æ•ˆ
                        if (musicEnabled) {
                            winSound.currentTime = 0;
                            winSound.play().catch(e => console.log("å¾—åˆ†éŸ³æ•ˆæ’­æ”¾å¤±è´¥"));
                        }
                        
                        // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘èŠ±æœµç‰¹æ•ˆ
                        if (Math.floor(score / 100) > Math.floor(lastScoreForEffect / 100)) {
                            createFlowerEffect();
                            lastScoreForEffect = score;
                            
                            // æ’­æ”¾é¢å¤–çš„å¾—åˆ†éŸ³æ•ˆ
                            if (musicEnabled) {
                                scoreSound.currentTime = 0;
                                scoreSound.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥"));
                            }
                        }
                        
                        // å¦‚æœæ˜¯ç”Ÿå‘½ç›®æ ‡ï¼Œå¢åŠ ç”Ÿå‘½å€¼
                        if (target.isLife) {
                            lives = Math.min(lives + 1, 5); // æœ€å¤š5æ¡å‘½
                        }
                        
                        // æ›´æ–°ç­‰çº§
                        let newLevel = Math.floor(score / 100) + 1;
                        if (newLevel > level) {
                            level = newLevel;
                            // æ¯å‡ä¸€çº§ï¼Œçƒé€Ÿå¢åŠ 
                            const speedIncrease = isMobile ? 1.05 : 1.1;
                            ball.speedX *= speedIncrease;
                            ball.speedY *= speedIncrease;
                        }
                        
                        updateUI();
                        
                        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç›®æ ‡éƒ½è¢«å‡»ä¸­
                        if (targets.every(t => !t.visible)) {
                            // æ‰€æœ‰ç›®æ ‡è¢«å‡»ä¸­ï¼Œé‡æ–°ç”Ÿæˆ
                            initTargets();
                            // å¥–åŠ±é¢å¤–ç”Ÿå‘½
                            lives = Math.min(lives + 1, 5);
                            updateUI();
                        }
                    }
                });
            }
        }

        // åˆ›å»ºèŠ±æœµç‰¹æ•ˆ
        function createFlowerEffect() {
            const flowerContainer = document.getElementById('flower-effects');
            const flowerCount = isMobile ? 20 : 30; // ç§»åŠ¨ç«¯å‡å°‘èŠ±æœµæ•°é‡
            
            for (let i = 0; i < flowerCount; i++) {
                const flower = document.createElement('div');
                flower.className = 'flower';
                
                // éšæœºé€‰æ‹©èŠ±æœµå›¾æ ‡å’Œé¢œè‰²
                const iconIndex = Math.floor(Math.random() * flowerIcons.length);
                const colorIndex = Math.floor(Math.random() * flowerColors.length);
                
                flower.textContent = flowerIcons[iconIndex];
                flower.style.color = flowerColors[colorIndex];
                flower.style.left = Math.random() * 100 + 'vw';
                flower.style.fontSize = (isMobile ? 16 : 20) + Math.random() * (isMobile ? 15 : 20) + 'px';
                
                // éšæœºåŠ¨ç”»å‚æ•°
                const duration = 3 + Math.random() * 4; // 3-7ç§’
                const delay = Math.random() * 2; // 0-2ç§’å»¶è¿Ÿ
                const horizontalMove = (Math.random() - 0.5) * 100; // æ°´å¹³ç§»åŠ¨è·ç¦»
                
                flower.style.animation = `fall ${duration}s linear ${delay}s forwards`;
                flower.style.transform = `translateX(${horizontalMove}px)`;
                
                flowerContainer.appendChild(flower);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤èŠ±æœµå…ƒç´ 
                setTimeout(() => {
                    if (flower.parentNode) {
                        flower.parentNode.removeChild(flower);
                    }
                }, (duration + delay) * 1000);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            // ç»˜åˆ¶æ¸¸æˆèƒŒæ™¯
            drawBackground();
            
            // ç»˜åˆ¶æ¸¸æˆå…ƒç´ 
            drawTargets();
            drawPaddle();
            drawBall();
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            if (!gamePaused && gameRunning) {
                updateBall();
            }
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            if (gameRunning) {
                animationId = requestAnimationFrame(gameLoop);
            }
        }

        // é”®ç›˜æ§åˆ¶
        const keys = {};
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // ç©ºæ ¼é”®å‘å°„çƒæˆ–æš‚åœæ¸¸æˆ
            if (e.key === ' ' && gameRunning) {
                if (ballOnPaddle) {
                    launchBall();
                } else {
                    togglePause();
                }
                e.preventDefault(); // é˜²æ­¢ç©ºæ ¼é”®æ»šåŠ¨é¡µé¢
            }
            
            // Ré”®é‡æ–°å¼€å§‹
            if (e.key === 'r' || e.key === 'R') {
                restartGame();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // å¤„ç†çƒæ‹ç§»åŠ¨
        function handlePaddleMovement() {
            if (keys['ArrowLeft'] || keys['Left'] || keys['a'] || keys['A']) {
                paddle.x = Math.max(0, paddle.x - paddle.speed);
            }
            
            if (keys['ArrowRight'] || keys['Right'] || keys['d'] || keys['D']) {
                paddle.x = Math.min(canvas.width - paddle.width, paddle.x + paddle.speed);
            }
            
            // æ¯å¸§è°ƒç”¨
            if (gameRunning && !gamePaused) {
                requestAnimationFrame(handlePaddleMovement);
            }
        }

        // åˆ‡æ¢æš‚åœçŠ¶æ€
        function togglePause() {
            gamePaused = !gamePaused;
            // PCç«¯æ›´æ–°æŒ‰é’®æ–‡æœ¬
            if (!isMobile) {
                document.getElementById('pauseBtn').innerHTML = gamePaused ? 
                    '<i class="fas fa-play"></i><span>ç»§ç»­æ¸¸æˆ</span>' : 
                    '<i class="fas fa-pause"></i><span>æš‚åœæ¸¸æˆ</span>';
            }
            
            if (!gamePaused && gameRunning) {
                handlePaddleMovement();
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameRunning) {
                initGame();
                gameRunning = true;
                gamePaused = false;
                if (!isMobile) {
                    document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause"></i><span>æš‚åœæ¸¸æˆ</span>';
                }
                gameLoop();
                handlePaddleMovement();
            }
        }

        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (gameRunning) {
                togglePause();
            }
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            gameRunning = false;
            gamePaused = false;
            cancelAnimationFrame(animationId);
            startGame();
        }

        // éŸ³é¢‘æ§åˆ¶
        document.getElementById('audioToggle').addEventListener('click', function() {
            musicEnabled = !musicEnabled;
            const icon = document.getElementById('audioIcon');
            
            if (musicEnabled) {
                icon.className = 'fas fa-volume-up';
                backgroundMusic.volume = 0.5;
                backgroundMusic.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’"));
            } else {
                icon.className = 'fas fa-volume-mute';
                backgroundMusic.pause();
            }
        });

        // ç§»åŠ¨ç«¯æ§åˆ¶
        document.getElementById('mobileLeft').addEventListener('touchstart', function(e) {
            e.preventDefault();
            keys['ArrowLeft'] = true;
        });
        
        document.getElementById('mobileLeft').addEventListener('touchend', function(e) {
            e.preventDefault();
            keys['ArrowLeft'] = false;
        });
        
        document.getElementById('mobileRight').addEventListener('touchstart', function(e) {
            e.preventDefault();
            keys['ArrowRight'] = true;
        });
        
        document.getElementById('mobileRight').addEventListener('touchend', function(e) {
            e.preventDefault();
            keys['ArrowRight'] = false;
        });
        
        document.getElementById('mobileSpace').addEventListener('touchstart', function(e) {
            e.preventDefault();
            if (gameRunning) {
                if (ballOnPaddle) {
                    launchBall();
                } else {
                    togglePause();
                }
            }
        });

        // äº‹ä»¶ç›‘å¬ - PCç«¯æŒ‰é’®
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', pauseGame);
        document.getElementById('restartBtn').addEventListener('click', restartGame);
        document.getElementById('playAgainBtn').addEventListener('click', restartGame);

        // çª—å£è°ƒæ•´å¤§å°æ—¶è°ƒæ•´Canvas
        function resizeCanvas() {
            const container = document.querySelector('.canvas-container');
            const containerWidth = Math.min(container.clientWidth, 800);
            const containerHeight = container.clientHeight;
            
            // è®¾ç½®Canvaså°ºå¯¸
            canvas.width = containerWidth;
            canvas.height = containerHeight;
            
            // é‡æ–°è°ƒæ•´çƒæ‹ä½ç½®
            paddle.y = canvas.height - 30;
            
            // æ ¹æ®è®¾å¤‡è°ƒæ•´çƒæ‹å®½åº¦
            if (isMobile) {
                paddle.width = Math.min(120, containerWidth * 0.2);
                paddle.speed = 6;
            } else {
                paddle.width = 100;
                paddle.speed = 8;
            }
            
            // è°ƒæ•´çƒçš„å¤§å°
            ball.radius = isMobile ? Math.min(10, containerWidth * 0.02) : 10;
            
            // å¦‚æœçƒåœ¨çƒæ‹ä¸Šï¼Œè°ƒæ•´çƒçš„ä½ç½®
            if (ballOnPaddle) {
                ball.x = paddle.x + paddle.width / 2;
                ball.y = paddle.y - ball.radius;
            }
            
            // å¦‚æœæ¸¸æˆè¿è¡Œä¸­ï¼Œé‡æ–°åˆå§‹åŒ–ç›®æ ‡ä»¥é€‚åº”æ–°å°ºå¯¸
            if (gameRunning) {
                initTargets();
            }
        }

        // åˆå§‹è°ƒæ•´Canvaså¤§å°
        window.addEventListener('load', () => {
            // æ£€æµ‹è®¾å¤‡ç±»å‹
            detectDevice();
            
            // åˆå§‹åŒ–Canvas
            resizeCanvas();
            
            // è‡ªåŠ¨å¼€å§‹æ¸¸æˆ
            setTimeout(() => {
                startGame();
            }, 500);
            
            // é¢„åŠ è½½éŸ³é¢‘
            winSound.load();
            
            // å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            document.addEventListener('click', function initAudio() {
                if (musicEnabled) {
                    backgroundMusic.volume = 0.5;
                    backgroundMusic.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’"));
                }
                document.removeEventListener('click', initAudio);
            });
        });
        
        window.addEventListener('resize', resizeCanvas);
        
        // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
        let touchStartX = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            if (!gameRunning || gamePaused) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            touchStartX = touch.clientX - rect.left;
        }, { passive: false });
        
        canvas.addEventListener('touchmove', (e) => {
            if (!gameRunning || gamePaused) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            
            // è®¡ç®—ç§»åŠ¨è·ç¦»å¹¶æ›´æ–°çƒæ‹ä½ç½®
            const deltaX = touchX - touchStartX;
            paddle.x += deltaX;
            
            // é™åˆ¶çƒæ‹åœ¨ç”»å¸ƒå†…
            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
            
            // æ›´æ–°èµ·å§‹è§¦æ‘¸ä½ç½®
            touchStartX = touchX;
            
            // å¦‚æœçƒåœ¨çƒæ‹ä¸Šï¼Œæ›´æ–°çƒçš„ä½ç½®
            if (ballOnPaddle) {
                ball.x = paddle.x + paddle.width / 2;
            }
        }, { passive: false });
        
        // ç‚¹å‡»ç”»å¸ƒå‘å°„çƒï¼ˆç§»åŠ¨ç«¯ï¼‰
        canvas.addEventListener('touchend', (e) => {
            if (!gameRunning || gamePaused) return;
            
            e.preventDefault();
            // ç§»åŠ¨ç«¯ç‚¹å‡»å‘å°„çƒ
            if (ballOnPaddle) {
                launchBall();
            }
        }, { passive: false });
        
        // é˜²æ­¢é¡µé¢æ»šåŠ¨
        document.addEventListener('touchmove', function(e) {
            if (gameRunning) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>