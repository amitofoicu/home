<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¯®å°æ¸¸æˆ Â· å®½å±èŠ±é›¨</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            background-image: url('https://amitofoicu.github.io/home/lianchi6.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* æœ€å¤–å±‚å¡ç‰‡ï¼ŒåŠé€æ˜èƒŒæ™¯è®©åº•å›¾é€å‡ºæ¥ */
        .game-outer {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border-radius: 4rem 4rem 3rem 3rem;
            padding: 1.8rem 2.5rem 2.8rem;
            border: 2px solid #e5cca5;
            box-shadow: 0 30px 40px rgba(0, 0, 0, 0.6);
        }
        /* å¤´éƒ¨åŒºåŸŸï¼šè§’æ ‡ + æ ‡é¢˜ + æ§åˆ¶æŒ‰é’®(é™éŸ³/é‡æ¥)é›†æˆåœ¨ä¸Šæ–¹ */
        .game-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.2rem;
            padding: 0 0.5rem;
        }
        .header-left {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        .more-games {
            background: rgba(20, 30, 35, 0.85);
            backdrop-filter: blur(4px);
            padding: 0.6rem 1.6rem;
            border-radius: 40px;
            border: 2px solid #fad275;
            color: #ffefc0;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: 0 5px 0 #6b4f2e;
            transition: 0.2s;
        }
        .more-games a {
            color: #fff2c9;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .more-games a:hover {
            color: #ffd966;
            text-shadow: 0 0 10px gold;
        }
        .game-title {
            background: rgba(25, 45, 55, 0.9);
            backdrop-filter: blur(4px);
            padding: 0.5rem 2.2rem;
            border-radius: 50px;
            border: 2px solid #fbc96e;
            color: #ffebc0;
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: 3px;
            text-shadow: 3px 3px 0 #1a4a5e;
            box-shadow: 0 6px 0 #6b4f2e;
        }
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .mute-btn, .reset-btn {
            background: #f5c281;
            border: none;
            border-radius: 40px;
            padding: 0.6rem 1.8rem;
            font-size: 1.3rem;
            font-weight: bold;
            color: #2a4733;
            border-bottom: 5px solid #b27634;
            cursor: pointer;
            transition: all 0.07s;
            box-shadow: 0 4px 8px black;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .mute-btn {
            background: #5d7c8a;
            border-bottom-color: #2f4a55;
            color: #f0edd0;
        }
        .mute-btn:hover, .reset-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }
        .mute-btn:active, .reset-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        /* Canvas å®¹å™¨ */
        .canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 1.2rem;
        }
        canvas {
            display: block;
            background: radial-gradient(circle at 30% 20%, #b7e1f0, #7bb3cc);
            border-radius: 36px;
            box-shadow: inset 0 -8px 18px #3f6b7a, 0 15px 22px rgba(0,0,0,0.6);
            cursor: crosshair;
            border: 5px solid #f5eacb;
            width: 900px;        /* å®½åº¦ç•¥å¾®å¢åŠ ä»¥é…åˆé«˜åº¦ */
            height: 520px;        /* å¢åŠ Canvasé«˜åº¦ (åŸ450 -> 520) */
        }

        /* åº•éƒ¨ä¿¡æ¯æ  */
        .panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.9rem 2rem;
            background: #ece2d0;
            border-radius: 60px;
            border: 3px solid #c29a6b;
            box-shadow: inset 0 2px 5px #baa077, 0 5px 0 #7d5535;
            color: #3d2b17;
            font-weight: bold;
            font-size: 1.4rem;
        }
        .score-box {
            background: #1e2f3a;
            color: #f9e07c;
            padding: 0.4rem 1.8rem;
            border-radius: 40px;
            font-size: 2.2rem;
            letter-spacing: 2px;
            text-shadow: 0 2px 0 #0f1c24;
            box-shadow: inset 0 -3px 0 #4a6a78;
            border: 1px solid #cfb27c;
            font-family: 'Courier New', monospace;
            min-width: 110px;
            text-align: center;
        }
        .hint {
            display: flex;
            gap: 2.5rem;
            align-items: center;
            color: #2b3a3f;
            text-shadow: 1px 1px 0 #bba87e;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .hint span {
            background: #e9dbc1;
            padding: 0.3rem 1.2rem;
            border-radius: 30px;
            border: 1px solid #b4925a;
        }
    </style>
</head>
<body>
<div class="game-outer">
    <!-- å¤´éƒ¨ï¼šè§’æ ‡ + æ ‡é¢˜ + æŒ‰é’®ï¼ˆéƒ½åœ¨canvasä¹‹å¤–ï¼‰ -->
    <div class="game-header">
        <div class="header-left">
            <div class="more-games">
                <a href="https://amitofoicu.github.io/home/main.html" target="_blank" rel="noopener">ğŸ® æ›´å¤šæ¸¸æˆ</a>
            </div>
            <div class="game-title">ğŸ€ æŠ•ç¯®å°æ¸¸æˆ</div>
        </div>
        <div class="header-right">
            <button id="muteToggleBtn" class="mute-btn">ğŸ”Š é™éŸ³</button>
            <button id="resetBtn" class="reset-btn">ğŸ”„ é‡æ¥</button>
        </div>
    </div>

    <!-- Canvas åŒºåŸŸ (é«˜åº¦å¢åŠ ) -->
    <div class="canvas-wrapper">
        <canvas id="gameCanvas" width="900" height="520"></canvas>
    </div>

    <!-- åº•éƒ¨ç§¯åˆ†ç‰Œ & æç¤º -->
    <div class="panel">
        <div class="score-box" id="scoreDisplay">0</div>
        <div class="hint">
            <span>â¬‡ï¸ æ‹–åŠ¨æŠ•ç¯®</span>
            <span>ğŸ‰ èŠ±é›¨+3</span>
        </div>
        <div style="width:80px;"><!-- å ä½ä¿æŒå¯¹ç§° --></div>
    </div>
</div>

<script>
    (function() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreSpan = document.getElementById('scoreDisplay');

        // æ–°å°ºå¯¸
        const W = 900, H = 520;

        // ---------- éŸ³é¢‘ ----------
        const backgroundMusic = new Audio('https://amitofoicu.github.io/home/beijing.ogg');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.5;

        const scoreSound = new Audio('https://amitofoicu.github.io/home/xiaochu.mp3');
        scoreSound.volume = 0.8;

        let isMuted = false;
        let musicStarted = false;

        function toggleMute() {
            isMuted = !isMuted;
            const muteBtn = document.getElementById('muteToggleBtn');
            if (isMuted) {
                backgroundMusic.pause();
                muteBtn.innerHTML = 'ğŸ”‡ é™éŸ³';
            } else {
                if (musicStarted) {
                    backgroundMusic.play().catch(e => console.log(e));
                }
                muteBtn.innerHTML = 'ğŸ”Š é™éŸ³';
            }
        }

        function tryPlayMusic() {
            if (!musicStarted && !isMuted) {
                backgroundMusic.play().then(() => {
                    musicStarted = true;
                }).catch(e => console.log('éŸ³ä¹ç­‰å¾…äº¤äº’', e));
            }
        }

        function playScoreSound() {
            if (isMuted) return;
            const soundClone = new Audio('https://amitofoicu.github.io/home/xiaochu.mp3');
            soundClone.volume = 0.7;
            soundClone.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥', e));
        }

        // ---------- ç¯®ç­ (å¹³è¡Œ) ----------
        let hoop = {
            x: 670, y: 210,          // åˆå§‹ä½ç½®é€‚åº”æ–°é«˜åº¦
            rimRadiusX: 24,
            rimRadiusY: 7,
        };

        function getBackboardX() {
            return hoop.x + 42;
        }

        function randomizeHoopPosition() {
            const minX = 320, maxX = 820;
            const minY = 140, maxY = 320;    // æ ¹æ®H=520è°ƒæ•´
            hoop.x = Math.floor(Math.random() * (maxX - minX) + minX);
            hoop.y = Math.floor(Math.random() * (maxY - minY) + minY);
        }

        // ç¯®çƒ
        let ball = {
            x: 140, y: 430,          // èµ·å§‹ä½ç½®å‘ä¸‹åç§»ä¸€ç‚¹ (åŸ360 -> 430)
            vx: 0, vy: 0,
            radius: 16,               // ç¨å¾®å¤§ä¸€ç‚¹æ›´æ˜æ˜¾
        };

        let score = 0;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let dragEnd = { x: 0, y: 0 };
        let isBallMoving = false;
        let inHoopLastFrame = false;

        // ç²’å­ & å¾—åˆ†æµ®å±‚
        let particles = [];
        let floatingScore = null;     // { value, x, y, life }

        const GRAVITY = 0.26;          // ç¨å¾®è°ƒä½ä¸€ç‚¹é€‚åº”å¤§canvas
        const MIN_POWER = 3;

        function resetBallToHand() {
            ball.x = 140;
            ball.y = 430;
            ball.vx = 0;
            ball.vy = 0;
            isBallMoving = false;
            inHoopLastFrame = false;
        }

        function updateScoreDisplay() {
            scoreSpan.textContent = score;
        }

        function resetGame() {
            score = 0;
            updateScoreDisplay();
            resetBallToHand();
            dragStart = { x: 0, y: 0 };
            dragEnd = { x: 0, y: 0 };
            isDragging = false;
            particles = [];
            floatingScore = null;
            randomizeHoopPosition();
            tryPlayMusic();
        }

        // èŠ±é›¨
        function createConfetti(explodeX, explodeY) {
            for (let i = 0; i < 40; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 4 + Math.random() * 9;
                const vx = Math.cos(angle) * speed * (0.6 + Math.random() * 0.8);
                const vy = Math.sin(angle) * speed * (0.6 + Math.random() * 0.8) - 2.8;
                particles.push({
                    x: explodeX, y: explodeY,
                    vx: vx, vy: vy,
                    size: 6 + Math.random() * 12,
                    color: `hsl(${Math.random() * 360}, 90%, 68%)`,
                    life: 1.0,
                    decay: 0.01 + Math.random() * 0.018,
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.13;
                p.life -= p.decay;
                if (p.life <= 0 || p.y > H + 70) {
                    particles.splice(i, 1);
                }
            }
        }

        function drawParticles() {
            for (let p of particles) {
                ctx.globalAlpha = p.life * 0.9;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                if (Math.random() > 0.4) {
                    ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
                } else {
                    ctx.arc(p.x, p.y, p.size/2, 0, Math.PI*2);
                    ctx.fill();
                }
            }
            ctx.globalAlpha = 1.0;
        }

        // ç‰©ç†æ›´æ–°
        function updateBall() {
            if (!isBallMoving) return;

            ball.vy += GRAVITY;
            ball.x += ball.vx;
            ball.y += ball.vy;

            // è¾¹ç•Œ
            if (ball.y + ball.radius > H) {
                ball.y = H - ball.radius;
                ball.vy *= -0.45;
                ball.vx *= 0.98;
                if (Math.abs(ball.vy) < 0.5 && Math.abs(ball.vx) < 0.3) resetBallToHand();
            }
            if (ball.y - ball.radius < 0) {
                ball.y = ball.radius;
                ball.vy *= -0.4;
            }
            if (ball.x - ball.radius < 0) {
                ball.x = ball.radius;
                ball.vx *= -0.5;
            }
            if (ball.x + ball.radius > W) {
                ball.x = W - ball.radius;
                ball.vx *= -0.5;
            }

            // ç¯®æ¿ç¢°æ’
            const boardLeft = getBackboardX() - 22;
            const boardRight = getBackboardX() + 12;
            const boardTop = hoop.y - 90;
            const boardBottom = hoop.y + 90;
            if (ball.x + ball.radius > boardLeft && ball.x - ball.radius < boardRight &&
                ball.y + ball.radius > boardTop && ball.y - ball.radius < boardBottom) {
                if (ball.vx > 0 && ball.x < boardLeft) {
                    ball.x = boardLeft - ball.radius;
                    ball.vx *= -0.35;
                } else if (ball.vx < 0 && ball.x > boardRight) {
                    ball.x = boardRight + ball.radius;
                    ball.vx *= -0.35;
                } else {
                    if (ball.vy > 0 && ball.y < boardTop) {
                        ball.y = boardTop - ball.radius;
                        ball.vy *= -0.3;
                    } else if (ball.vy < 0 && ball.y > boardBottom) {
                        ball.y = boardBottom + ball.radius;
                        ball.vy *= -0.3;
                    } else {
                        ball.x = boardLeft - ball.radius;
                        ball.vx *= -0.3;
                    }
                }
            }

            // å¾—åˆ†æ£€æµ‹ (æ¤­åœ†)
            const dx = ball.x - hoop.x;
            const dy = ball.y - hoop.y;
            const rx = hoop.rimRadiusX + ball.radius * 0.7;
            const ry = hoop.rimRadiusY + ball.radius * 0.7;
            const isInEllipse = (dx*dx) / (rx*rx) + (dy*dy) / (ry*ry) <= 1.0;
            const isDescending = ball.vy > 0.8;

            if (isBallMoving && !inHoopLastFrame && isInEllipse && isDescending) {
                score += 3;
                updateScoreDisplay();

                createConfetti(hoop.x, hoop.y - 15);
                floatingScore = { value: 3, x: hoop.x, y: hoop.y - 45, life: 1.2 };

                playScoreSound();

                randomizeHoopPosition();   // è¿›çƒåç¯®ç­ç¬ç§»

                ball.vy += 0.2;
                inHoopLastFrame = true;
            }

            if (Math.hypot(ball.x - hoop.x, ball.y - hoop.y) > 60) {
                inHoopLastFrame = false;
            }

            if (Math.abs(ball.vy) < 0.3 && Math.abs(ball.vx) < 0.2 && ball.y > H - 40) {
                resetBallToHand();
            }
        }

        // ç»˜åˆ¶å¾—åˆ†æµ®å±‚
        function drawFloatingScore() {
            if (!floatingScore) return;
            const fs = floatingScore;
            fs.life -= 0.01;
            if (fs.life <= 0) {
                floatingScore = null;
                return;
            }
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#ffaa00';
            ctx.font = 'bold 48px "Courier New", monospace';
            ctx.fillStyle = `rgba(255, 240, 100, ${fs.life})`;
            ctx.fillText(`+${fs.value}`, fs.x - 50, fs.y - 10);
            ctx.shadowBlur = 0;
        }

        // ç»˜åˆ¶åœºæ™¯
        function drawScene() {
            ctx.clearRect(0, 0, W, H);

            // åœ°æ¿
            ctx.fillStyle = '#b5906b';
            ctx.fillRect(0, H-45, W, 45);
            ctx.fillStyle = '#9c7a5a';
            for (let i=0;i<W;i+=60) ctx.fillRect(i, H-43, 30, 6);

            const boardX = getBackboardX();
            // æ”¯æ¶
            ctx.fillStyle = '#6b4f3a';
            ctx.fillRect(boardX-12, hoop.y+30, 22, 180);
            ctx.fillStyle = '#8b6f4f';
            ctx.fillRect(boardX-22, hoop.y+20, 44, 22);
            // ç¯®æ¿
            ctx.fillStyle = '#d4b28c';
            ctx.shadowColor = '#3e2e1f';
            ctx.shadowBlur = 12;
            ctx.fillRect(boardX-22, hoop.y-95, 34, 190);
            ctx.shadowBlur = 0;
            ctx.strokeStyle = '#5b3f28';
            ctx.lineWidth = 3;
            ctx.strokeRect(boardX-22, hoop.y-95, 34, 190);

            // å¹³è¡Œç¯®ç­
            ctx.shadowBlur = 14;
            ctx.shadowColor = '#c99f33';
            ctx.beginPath();
            ctx.ellipse(hoop.x, hoop.y, hoop.rimRadiusX, hoop.rimRadiusY, 0, 0, Math.PI*2);
            ctx.strokeStyle = '#f2c744';
            ctx.lineWidth = 6;
            ctx.stroke();
            ctx.beginPath();
            ctx.ellipse(hoop.x, hoop.y, hoop.rimRadiusX-3, hoop.rimRadiusY-2, 0, 0, Math.PI*2);
            ctx.strokeStyle = '#f9df92';
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.beginPath();
            for (let i = -1; i <= 1; i+=2) {
                ctx.moveTo(hoop.x + i*12, hoop.y + 6);
                ctx.lineTo(hoop.x + i*12 - 4*i, hoop.y + 32);
            }
            ctx.strokeStyle = '#bcb09b';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.shadowBlur = 0;

            // ç¯®çƒ
            ctx.shadowBlur = 14;
            ctx.shadowColor = '#2e2e2e';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, 2 * Math.PI);
            ctx.fillStyle = '#c96e28';
            ctx.fill();
            ctx.strokeStyle = '#2c1e0e';
            ctx.lineWidth = 2.5;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(ball.x - ball.radius, ball.y);
            ctx.lineTo(ball.x + ball.radius, ball.y);
            ctx.moveTo(ball.x, ball.y - ball.radius);
            ctx.lineTo(ball.x, ball.y + ball.radius);
            ctx.strokeStyle = '#2c1e0e';
            ctx.stroke();

            // æ‹–åŠ¨è™šçº¿
            if (isDragging && !isBallMoving) {
                ctx.beginPath();
                ctx.moveTo(ball.x, ball.y);
                ctx.lineTo(dragEnd.x, dragEnd.y);
                ctx.strokeStyle = '#fff9d7';
                ctx.lineWidth = 3;
                ctx.setLineDash([9, 9]);
                ctx.stroke();
                const dragDist = Math.hypot(dragEnd.x - ball.x, dragEnd.y - ball.y);
                const power = Math.min(dragDist * 0.2, 16).toFixed(1);
                ctx.font = 'bold 20px "Segoe UI"';
                ctx.fillStyle = '#fef7e0';
                ctx.shadowBlur = 10;
                ctx.fillText(`ğŸ’ª ${power}`, ball.x - 15, ball.y - 40);
                ctx.setLineDash([]);
            } else {
                ctx.setLineDash([]);
            }

            drawParticles();
            drawFloatingScore();
        }

        // åŠ¨ç”»å¾ªç¯
        function gameLoop() {
            updateBall();
            updateParticles();
            drawScene();
            requestAnimationFrame(gameLoop);
        }

        // é¼ æ ‡äº‹ä»¶
        function handleMouseDown(e) {
            e.preventDefault();
            tryPlayMusic();
            if (isBallMoving) return;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;
            isDragging = true;
            dragStart.x = ball.x;
            dragStart.y = ball.y;
            dragEnd.x = mouseX;
            dragEnd.y = mouseY;
        }

        function handleMouseMove(e) {
            if (!isDragging || isBallMoving) return;
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;
            dragEnd.x = Math.min(W, Math.max(0, mouseX));
            dragEnd.y = Math.min(H, Math.max(0, mouseY));
        }

        function handleMouseUp(e) {
            e.preventDefault();
            if (!isDragging || isBallMoving) {
                isDragging = false;
                return;
            }
            let dx = dragEnd.x - dragStart.x;
            let dy = dragEnd.y - dragStart.y;
            const speed = Math.sqrt(dx*dx + dy*dy) * 0.2;
            if (speed < MIN_POWER) {
                isDragging = false;
                return;
            }
            const angle = Math.atan2(dy, dx);
            ball.vx = -Math.cos(angle) * speed * 1.25;
            ball.vy = -Math.sin(angle) * speed * 1.25;
            const maxSpeed = 18;
            if (Math.abs(ball.vx) > maxSpeed) ball.vx = (ball.vx > 0 ? maxSpeed : -maxSpeed);
            if (Math.abs(ball.vy) > maxSpeed) ball.vy = (ball.vy > 0 ? maxSpeed : -maxSpeed);
            isBallMoving = true;
            isDragging = false;
        }

        function handleMouseLeave(e) {
            if (isDragging) isDragging = false;
        }

        // æŒ‚è½½äº‹ä»¶
        canvas.addEventListener('mousedown', handleMouseDown);
        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseup', handleMouseUp);
        canvas.addEventListener('mouseleave', handleMouseLeave);
        canvas.addEventListener('dragstart', (e) => e.preventDefault());

        // æŒ‰é’®
        document.getElementById('resetBtn').addEventListener('click', () => {
            resetGame();
            tryPlayMusic();
        });
        document.getElementById('muteToggleBtn').addEventListener('click', toggleMute);

        // å°è¯•å¯åŠ¨éŸ³ä¹
        document.addEventListener('click', function once() {
            if (!musicStarted && !isMuted) {
                backgroundMusic.play().then(() => musicStarted = true).catch(() => {});
            }
        }, { once: true });

        randomizeHoopPosition();
        resetGame();
        gameLoop();
    })();
</script>
</body>
</html>