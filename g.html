<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·³ä¸€è·³ - ç½‘é¡µç‰ˆ (å·²ä¿®å¤)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px;
            width: 100%;
            gap: 20px;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            max-width: 500px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        }
        
        #gameCanvas {
            display: block;
            background-color: #87CEEB;
            width: 100%;
            touch-action: none;
        }
        
        .score-board {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .score-item {
            text-align: center;
            flex: 1;
        }
        
        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4a6cf7;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-info {
            text-align: center;
            font-size: 1rem;
            line-height: 1.5;
            color: #555;
        }
        
        .key {
            display: inline-block;
            background: #4a6cf7;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(to right, #4a6cf7, #6a11cb);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(74, 108, 247, 0.3);
            flex: 1;
            max-width: 180px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(74, 108, 247, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        #restartBtn {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
        }
        
        #restartBtn:hover {
            box-shadow: 0 6px 15px rgba(255, 126, 95, 0.4);
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            display: none;
            border-radius: 12px;
        }
        
        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffdd40;
        }
        
        .game-over p {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: #4a6cf7;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .instructions {
            max-width: 500px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h3 {
            color: #4a6cf7;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .instructions ul {
            padding-left: 20px;
            color: #555;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .power-bar-container {
            width: 100%;
            max-width: 500px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
            display: none;
        }
        
        #powerBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4CAF50, #FFC107, #FF5722);
            border-radius: 10px;
            transition: width 0.1s;
        }
        
        .footer {
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .score-value {
                font-size: 1.6rem;
            }
            
            button {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .control-info {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è·³ä¸€è·³</h1>
            <p class="subtitle">æŒ‰ä½è“„åŠ›ï¼Œæ¾å¼€è·³è·ƒï¼Œè·³åˆ°æ–¹å—ä¸­å¿ƒå¾—åˆ†æ›´é«˜ï¼</p>
        </header>
        
        <div class="game-area">
            <canvas id="gameCanvas" width="500" height="600"></canvas>
            
            <div class="game-over" id="gameOverScreen">
                <h2>æ¸¸æˆç»“æŸ</h2>
                <p>æœ¬æ¬¡å¾—åˆ†</p>
                <div class="final-score" id="finalScore">0</div>
                <p>æœ€é«˜è®°å½•: <span id="bestScoreDisplay">0</span></p>
                <button id="playAgainBtn">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
        
        <div class="power-bar-container">
            <div id="powerBar"></div>
        </div>
        
        <div class="score-board">
            <div class="score-item">
                <div class="score-label">å½“å‰å¾—åˆ†</div>
                <div class="score-value" id="currentScore">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">è¿ç»­ä¸­å¿ƒ</div>
                <div class="score-value" id="comboCount">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">æœ€é«˜è®°å½•</div>
                <div class="score-value" id="bestScore">0</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-info">
                <p>ğŸ® <strong>æ“ä½œæ–¹å¼ï¼š</strong></p>
                <p>ç”µè„‘ï¼šæŒ‰ä¸‹å¹¶æŒ‰ä½ <span class="key">ç©ºæ ¼é”®</span> æˆ– <span class="key">é¼ æ ‡å·¦é”®</span> è“„åŠ›ï¼Œæ¾å¼€è·³è·ƒ</p>
                <p>æ‰‹æœºï¼š<span class="key">æŒ‰ä½å±å¹•</span> è“„åŠ›ï¼Œ<span class="key">æ¾å¼€</span> è·³è·ƒ</p>
            </div>
            
            <div class="buttons">
                <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                <button id="restartBtn">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>æ¸¸æˆè§„åˆ™</h3>
            <ul>
                <li>æŒ‰ä½é¼ æ ‡/ç©ºæ ¼é”®/å±å¹•è“„åŠ›ï¼Œæ¾å¼€åè§’è‰²ä¼šè·³è·ƒ</li>
                <li>è“„åŠ›æ—¶é—´è¶Šé•¿ï¼Œè·³è·ƒè·ç¦»è¶Šè¿œ</li>
                <li>æˆåŠŸè·³åˆ°ä¸‹ä¸€ä¸ªæ–¹å—ä¸Šå¾—1åˆ†</li>
                <li>è·³åˆ°æ–¹å—ä¸­å¿ƒä¼šè·å¾—è¿ç»­åŠ åˆ†ï¼š+2ã€+4ã€+6ã€+8ã€+10...</li>
                <li>å¦‚æœæ‰ä¸‹æ–¹å—æˆ–è·³åˆ°æ–¹å—è¾¹ç¼˜ï¼Œæ¸¸æˆç»“æŸ</li>
                <li>è·³åˆ°ç‰¹æ®Šæ–¹å—ï¼ˆå½©è‰²ï¼‰å¯è·å¾—é¢å¤–åˆ†æ•°</li>
            </ul>
        </div>
        
        <div class="footer">
            <p>ç½‘é¡µç‰ˆã€Šè·³ä¸€è·³ã€‹ | ä½¿ç”¨HTML5 Canvaså’ŒJavaScriptå¼€å‘</p>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ ¸å¿ƒå˜é‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const currentScoreEl = document.getElementById('currentScore');
        const comboCountEl = document.getElementById('comboCount');
        const bestScoreEl = document.getElementById('bestScore');
        const bestScoreDisplay = document.getElementById('bestScoreDisplay');
        const finalScoreEl = document.getElementById('finalScore');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const powerBar = document.getElementById('powerBar');
        const powerBarContainer = document.querySelector('.power-bar-container');

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            isPlaying: false,
            isCharging: false,
            isJumping: false,
            score: 0,
            combo: 0,
            bestScore: localStorage.getItem('jumpBestScore') || 0,
            currentBlockIndex: 0,
            chargePower: 0,
            chargeStartTime: 0,
            maxChargeTime: 1500, // æœ€å¤§è“„åŠ›æ—¶é—´(ms)
            player: {
                x: 0,
                y: 0,
                size: 20,
                color: '#FF5252',
                velocityX: 0,
                velocityY: 0,
                jumpStartX: 0,
                jumpStartY: 0
            },
            blocks: [],
            gameSpeed: 3,
            specialBlocks: [2, 5, 9, 14, 20], // ç‰¹æ®Šæ–¹å—ç´¢å¼•
            jumpStartTime: 0
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.isPlaying = true;
            gameState.isCharging = false;
            gameState.isJumping = false;
            gameState.score = 0;
            gameState.combo = 0;
            gameState.currentBlockIndex = 0;
            gameState.chargePower = 0;
            gameState.player.velocityX = 0;
            gameState.player.velocityY = 0;
            
            // æ›´æ–°UI
            currentScoreEl.textContent = '0';
            comboCountEl.textContent = '0';
            bestScoreEl.textContent = gameState.bestScore;
            gameOverScreen.style.display = 'none';
            powerBarContainer.style.display = 'none';
            
            // åˆå§‹åŒ–æ–¹å—
            gameState.blocks = [];
            const startX = canvas.width / 2 - 50;
            const startY = canvas.height - 100;
            
            // åˆ›å»ºç¬¬ä¸€ä¸ªæ–¹å—ï¼ˆèµ·å§‹ä½ç½®ï¼‰
            gameState.blocks.push({
                x: startX,
                y: startY,
                width: 100,
                height: 30,
                color: '#4CAF50',
                isSpecial: false
            });
            
            // åˆ›å»ºå…¶ä»–æ–¹å—
            for (let i = 1; i < 20; i++) {
                const prevBlock = gameState.blocks[i - 1];
                const distance = 120 + Math.random() * 80; // å‡å°‘è·ç¦»ï¼Œç¡®ä¿èƒ½è·³åˆ°
                const angle = Math.random() * Math.PI / 4 - Math.PI / 8;
                
                const newX = prevBlock.x + Math.cos(angle) * distance;
                const newY = prevBlock.y - Math.sin(angle) * distance - 30;
                
                // ç¡®ä¿æ–¹å—ä¸ä¼šè¶…å‡ºç”»å¸ƒ
                const safeX = Math.max(30, Math.min(canvas.width - 130, newX));
                
                // éšæœºå®½åº¦
                const width = 70 + Math.random() * 60;
                
                // ç¡®ä¿æ–¹å—ä¸ä¼šå¤ªé«˜æˆ–å¤ªä½
                const safeY = Math.max(100, Math.min(canvas.height - 150, newY));
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºç‰¹æ®Šæ–¹å—
                const isSpecial = gameState.specialBlocks.includes(i);
                
                gameState.blocks.push({
                    x: safeX,
                    y: safeY,
                    width: width,
                    height: 30,
                    color: isSpecial ? getRandomColor() : '#795548',
                    isSpecial: isSpecial
                });
            }
            
            // åˆå§‹åŒ–ç©å®¶ä½ç½®ï¼ˆåœ¨ç¬¬ä¸€ä¸ªæ–¹å—ä¸Šï¼‰
            gameState.player.x = gameState.blocks[0].x + gameState.blocks[0].width / 2;
            gameState.player.y = gameState.blocks[0].y - gameState.player.size;
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameState.isPlaying) return;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            drawBackground();
            
            // ç»˜åˆ¶æ‰€æœ‰æ–¹å—
            gameState.blocks.forEach(block => {
                drawBlock(block);
            });
            
            // æ›´æ–°ç©å®¶ä½ç½®ï¼ˆå¦‚æœæ­£åœ¨è·³è·ƒï¼‰
            if (gameState.isJumping) {
                updatePlayerPosition();
            }
            
            // ç»˜åˆ¶ç©å®¶
            drawPlayer();
            
            // ç»˜åˆ¶åˆ†æ•°æç¤º
            drawScoreHint();
            
            // ç»§ç»­å¾ªç¯
            requestAnimationFrame(gameLoop);
        }

        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // å¤©ç©ºæ¸å˜
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#E0F7FF');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // äº‘æœµ
            drawCloud(canvas.width * 0.2, 80, 60);
            drawCloud(canvas.width * 0.7, 120, 40);
            drawCloud(canvas.width * 0.4, 180, 70);
            
            // åœ°é¢
            ctx.fillStyle = '#8BC34A';
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // è‰åœ°ç»†èŠ‚
            ctx.fillStyle = '#7CB342';
            for (let i = 0; i < canvas.width; i += 20) {
                const height = 10 + Math.random() * 15;
                ctx.fillRect(i, canvas.height - 30, 10, -height);
            }
        }

        // ç»˜åˆ¶äº‘æœµ
        function drawCloud(x, y, size) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.4, y - size * 0.2, size * 0.4, 0, Math.PI * 2);
            ctx.arc(x + size * 0.6, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x - size * 0.3, y, size * 0.4, 0, Math.PI * 2);
            ctx.fill();
        }

        // ç»˜åˆ¶æ–¹å—
        function drawBlock(block) {
            // æ–¹å—é˜´å½±
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(block.x + 4, block.y + 4, block.width, block.height);
            
            // æ–¹å—ä¸»ä½“
            ctx.fillStyle = block.color;
            ctx.fillRect(block.x, block.y, block.width, block.height);
            
            // æ–¹å—é¡¶éƒ¨ï¼ˆ3Dæ•ˆæœï¼‰
            ctx.fillStyle = block.isSpecial ? lightenColor(block.color, 30) : '#A1887F';
            ctx.fillRect(block.x, block.y, block.width, 8);
            
            // å¦‚æœæ˜¯ç‰¹æ®Šæ–¹å—ï¼Œæ·»åŠ é—ªçƒæ•ˆæœ
            if (block.isSpecial) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                const flashSize = 10 + Math.sin(Date.now() / 200) * 5;
                ctx.fillRect(
                    block.x + block.width / 2 - flashSize / 2,
                    block.y + block.height / 2 - flashSize / 2,
                    flashSize,
                    flashSize
                );
            }
            
            // æ–¹å—ä¸­å¿ƒæŒ‡ç¤ºå™¨
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(
                block.x + block.width / 2,
                block.y + block.height / 2,
                block.width / 6,
                0,
                Math.PI * 2
            );
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // ç»˜åˆ¶ç©å®¶
        function drawPlayer() {
            const player = gameState.player;
            
            // ç©å®¶é˜´å½±
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.arc(player.x + 3, player.y + 3, player.size, 0, Math.PI * 2);
            ctx.fill();
            
            // ç©å®¶ä¸»ä½“
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
            ctx.fill();
            
            // ç©å®¶çœ¼ç›
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(player.x - 6, player.y - 5, 4, 0, Math.PI * 2);
            ctx.arc(player.x + 6, player.y - 5, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // ç©å®¶çœ¼ç 
            ctx.fillStyle = '#333';
            const lookDirection = gameState.isCharging ? 2 : 0;
            ctx.beginPath();
            ctx.arc(player.x - 6 + lookDirection, player.y - 5, 2, 0, Math.PI * 2);
            ctx.arc(player.x + 6 + lookDirection, player.y - 5, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ç©å®¶å˜´å·´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(player.x, player.y + 3, 8, 0.2 * Math.PI, 0.8 * Math.PI);
            ctx.stroke();
            
            // å¦‚æœæ­£åœ¨è“„åŠ›ï¼Œç»˜åˆ¶è“„åŠ›æ•ˆæœ
            if (gameState.isCharging) {
                ctx.strokeStyle = '#FFC107';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 10 + Math.sin(Date.now() / 100) * 5, 0, Math.PI * 2 * gameState.chargePower);
                ctx.stroke();
            }
        }

        // ç»˜åˆ¶å¾—åˆ†æç¤º
        function drawScoreHint() {
            const currentBlock = gameState.blocks[gameState.currentBlockIndex];
            const player = gameState.player;
            
            // å¦‚æœç©å®¶åœ¨å½“å‰æ–¹å—ä¸Šä¸”æ²¡æœ‰è·³è·ƒï¼Œæ˜¾ç¤ºä¸­å¿ƒæç¤º
            if (!gameState.isJumping && 
                player.x >= currentBlock.x && 
                player.x <= currentBlock.x + currentBlock.width) {
                
                const centerX = currentBlock.x + currentBlock.width / 2;
                const distanceFromCenter = Math.abs(player.x - centerX);
                const maxDistance = currentBlock.width / 2;
                const accuracy = 1 - distanceFromCenter / maxDistance;
                
                // ç»˜åˆ¶å‡†ç¡®åº¦æŒ‡ç¤ºå™¨
                ctx.fillStyle = accuracy > 0.9 ? '#4CAF50' : 
                               accuracy > 0.7 ? '#FFC107' : '#FF5722';
                ctx.fillRect(
                    centerX - maxDistance,
                    currentBlock.y - 20,
                    maxDistance * 2 * accuracy,
                    5
                );
                
                // ç»˜åˆ¶ä¸­å¿ƒçº¿
                ctx.strokeStyle = '#FF4081';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centerX, currentBlock.y - 15);
                ctx.lineTo(centerX, currentBlock.y - 5);
                ctx.stroke();
                
                // æ˜¾ç¤ºè¿ç»­åŠ åˆ†æç¤º
                if (gameState.combo > 0) {
                    ctx.fillStyle = '#FF4081';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`è¿ç»­ä¸­å¿ƒ +${2 * gameState.combo}`, centerX, currentBlock.y - 30);
                }
            }
        }

        // æ›´æ–°ç©å®¶ä½ç½®ï¼ˆè·³è·ƒç‰©ç†ï¼‰ - å·²ä¿®å¤ç‰ˆæœ¬
        function updatePlayerPosition() {
            const player = gameState.player;
            const currentBlock = gameState.blocks[gameState.currentBlockIndex];
            
            // è®¡ç®—ç»è¿‡çš„æ—¶é—´ï¼ˆç§’ï¼‰
            const currentTime = Date.now();
            const elapsedTime = (currentTime - gameState.jumpStartTime) / 1000;
            
            // åŸºç¡€è·³è·ƒåŠ›é‡ï¼Œå¢åŠ é‡åŠ›æ•ˆæœ
            const jumpForce = gameState.chargePower * 25; // å¢åŠ è·³è·ƒåŠ›
            const gravity = 15; // å‡å°é‡åŠ›
            
            // è®¡ç®—ç›®æ ‡æ–¹å—
            const targetBlockIndex = gameState.currentBlockIndex + 1;
            if (targetBlockIndex >= gameState.blocks.length) {
                gameOver();
                return;
            }
            
            const targetBlock = gameState.blocks[targetBlockIndex];
            
            // è®¡ç®—èµ·ç‚¹å’Œç»ˆç‚¹
            const startX = currentBlock.x + currentBlock.width / 2;
            const startY = currentBlock.y - player.size;
            const targetX = targetBlock.x + targetBlock.width / 2;
            const targetY = targetBlock.y - player.size;
            
            // è®¡ç®—æ°´å¹³è·ç¦»å’Œæ—¶é—´
            const distanceX = targetX - startX;
            const distanceY = targetY - startY;
            
            // è®¡ç®—éœ€è¦çš„æ°´å¹³å’Œå‚ç›´é€Ÿåº¦
            const timeOfFlight = Math.sqrt(Math.abs(distanceY) * 2 / gravity);
            const velocityX = distanceX / timeOfFlight;
            const velocityY = (distanceY + 0.5 * gravity * timeOfFlight * timeOfFlight) / timeOfFlight;
            
            // åº”ç”¨è“„åŠ›ç³»æ•°
            const powerMultiplier = 0.5 + gameState.chargePower * 1.5; // 0.5åˆ°2.0ä¹‹é—´
            
            // æ›´æ–°ç©å®¶ä½ç½®
            player.x = startX + velocityX * elapsedTime * powerMultiplier;
            player.y = startY + velocityY * elapsedTime * powerMultiplier - 0.5 * gravity * elapsedTime * elapsedTime * powerMultiplier;
            
            // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡æ–¹å—
            if (elapsedTime * powerMultiplier >= timeOfFlight) {
                // å°è¯•ç€é™†
                landOnBlock(targetBlockIndex);
            }
            
            // æ£€æŸ¥æ˜¯å¦æ‰å‡ºå±å¹•
            if (player.y > canvas.height + 50 || 
                player.x < -50 || 
                player.x > canvas.width + 50) {
                gameOver();
            }
        }

        // è½åœ¨æ–¹å—ä¸Š
        function landOnBlock(blockIndex) {
            gameState.isJumping = false;
            gameState.currentBlockIndex = blockIndex;
            
            const player = gameState.player;
            const block = gameState.blocks[blockIndex];
            
            // å°†ç©å®¶æ”¾ç½®åœ¨æ–¹å—ä¸Š
            player.x = block.x + block.width / 2;
            player.y = block.y - player.size;
            
            // è®¡ç®—å¾—åˆ†
            const centerX = block.x + block.width / 2;
            const distanceFromCenter = Math.abs(player.x - centerX);
            const maxDistance = block.width / 2;
            
            // åŸºç¡€å¾—åˆ†
            let points = 1;
            
            // æ£€æŸ¥æ˜¯å¦è·³åˆ°ä¸­å¿ƒåŒºåŸŸ
            if (distanceFromCenter < maxDistance * 0.3) {
                // è¿ç»­ä¸­å¿ƒåŠ åˆ†
                gameState.combo++;
                points += 2 * gameState.combo; // +2, +4, +6, ...
                
                // ç‰¹æ®Šæ•ˆæœ
                createLandingEffect(player.x, player.y, points);
            } else {
                // æ²¡æœ‰è·³åˆ°ä¸­å¿ƒï¼Œé‡ç½®è¿ç»­è®¡æ•°
                gameState.combo = 0;
            }
            
            // å¦‚æœæ˜¯ç‰¹æ®Šæ–¹å—ï¼Œé¢å¤–åŠ åˆ†
            if (block.isSpecial) {
                points += 5;
                createSpecialEffect(player.x, block.y);
            }
            
            // æ›´æ–°åˆ†æ•°
            gameState.score += points;
            currentScoreEl.textContent = gameState.score;
            comboCountEl.textContent = gameState.combo;
            
            // æ›´æ–°æœ€é«˜åˆ†
            if (gameState.score > gameState.bestScore) {
                gameState.bestScore = gameState.score;
                bestScoreEl.textContent = gameState.bestScore;
                localStorage.setItem('jumpBestScore', gameState.bestScore);
            }
            
            // æ¯å¾—5åˆ†å¢åŠ æ¸¸æˆé€Ÿåº¦
            if (gameState.score % 5 === 0) {
                gameState.gameSpeed = Math.min(6, 3 + Math.floor(gameState.score / 10));
            }
        }

        // åˆ›å»ºè½åœ°ç‰¹æ•ˆ
        function createLandingEffect(x, y, points) {
            // ç®€åŒ–ç‰ˆï¼šç»˜åˆ¶ä¸€ä¸ªçŸ­æš‚çš„æ•ˆæœ
            ctx.fillStyle = '#FFEB3B';
            ctx.beginPath();
            ctx.arc(x, y + 10, 15 + points, 0, Math.PI * 2);
            ctx.fill();
            
            // æ˜¾ç¤ºå¾—åˆ†
            ctx.fillStyle = '#FF4081';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`+${points}`, x, y - 20);
        }

        // åˆ›å»ºç‰¹æ®Šæ–¹å—æ•ˆæœ
        function createSpecialEffect(x, y) {
            ctx.fillStyle = '#E040FB';
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const dx = Math.cos(angle) * 30;
                const dy = Math.sin(angle) * 30;
                
                ctx.beginPath();
                ctx.arc(x + dx, y + dy, 5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameState.isPlaying = false;
            gameState.isJumping = false;
            gameState.isCharging = false;
            
            // æ›´æ–°æœ€ç»ˆå¾—åˆ†
            finalScoreEl.textContent = gameState.score;
            bestScoreDisplay.textContent = gameState.bestScore;
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸç”»é¢
            gameOverScreen.style.display = 'flex';
            powerBarContainer.style.display = 'none';
        }

        // å¼€å§‹è“„åŠ›
        function startCharge() {
            if (!gameState.isPlaying || gameState.isJumping) return;
            
            gameState.isCharging = true;
            gameState.chargeStartTime = Date.now();
            powerBarContainer.style.display = 'block';
            
            // æ›´æ–°è“„åŠ›æ¡
            updateChargeBar();
        }

        // æ›´æ–°è“„åŠ›æ¡
        function updateChargeBar() {
            if (!gameState.isCharging) return;
            
            const elapsed = Date.now() - gameState.chargeStartTime;
            gameState.chargePower = Math.min(elapsed / gameState.maxChargeTime, 1);
            
            // æ›´æ–°UI
            powerBar.style.width = `${gameState.chargePower * 100}%`;
            
            // ç»§ç»­æ›´æ–°
            if (gameState.isCharging) {
                requestAnimationFrame(updateChargeBar);
            }
        }

        // æ‰§è¡Œè·³è·ƒ
        function executeJump() {
            if (!gameState.isPlaying || !gameState.isCharging || gameState.isJumping) return;
            
            gameState.isCharging = false;
            gameState.isJumping = true;
            gameState.jumpStartTime = Date.now();
            powerBarContainer.style.display = 'none';
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = [
                '#FF5252', '#FF4081', '#E040FB', 
                '#7C4DFF', '#536DFE', '#448AFF',
                '#40C4FF', '#18FFFF', '#64FFDA',
                '#69F0AE', '#B2FF59', '#EEFF41'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // å·¥å…·å‡½æ•°ï¼šé¢œè‰²å˜äº®
        function lightenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            
            return `#${(
                0x1000000 +
                (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
                (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
                (B < 255 ? (B < 1 ? 0 : B) : 255)
            )
                .toString(16)
                .slice(1)}`;
        }

        // äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            startBtn.addEventListener('click', initGame);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            restartBtn.addEventListener('click', initGame);
            
            // å†ç©ä¸€æ¬¡æŒ‰é’®
            playAgainBtn.addEventListener('click', initGame);
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    startCharge();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    executeJump();
                }
            });
            
            // é¼ æ ‡/è§¦æ‘¸æ§åˆ¶
            canvas.addEventListener('mousedown', startCharge);
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startCharge();
            });
            
            canvas.addEventListener('mouseup', executeJump);
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                executeJump();
            });
            
            // é˜²æ­¢è§¦æ‘¸æ—¶æ»šåŠ¨é¡µé¢
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
            }, { passive: false });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒ
            window.addEventListener('resize', adjustCanvasSize);
            
            // åˆå§‹è°ƒæ•´ç”»å¸ƒå¤§å°
            adjustCanvasSize();
        }

        // è°ƒæ•´ç”»å¸ƒå¤§å°ä»¥é€‚åº”å®¹å™¨
        function adjustCanvasSize() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            
            // ä¿æŒå®½é«˜æ¯”
            const aspectRatio = canvas.width / canvas.height;
            const newHeight = containerWidth / aspectRatio;
            
            // è®¾ç½®ç”»å¸ƒæ˜¾ç¤ºå°ºå¯¸
            canvas.style.width = `${containerWidth}px`;
            canvas.style.height = `${newHeight}px`;
        }

        // åˆå§‹åŒ–æ¸¸æˆå’Œäº‹ä»¶ç›‘å¬
        setupEventListeners();
        
        // æ˜¾ç¤ºåˆå§‹æœ€é«˜åˆ†
        bestScoreEl.textContent = gameState.bestScore;
        
        // æ¸¸æˆè¯´æ˜
        console.log('æ¸¸æˆå·²åŠ è½½ï¼ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹ç©ã€‚');
        console.log('æ“ä½œè¯´æ˜ï¼š');
        console.log('- ç”µè„‘ï¼šæŒ‰ä¸‹å¹¶æŒ‰ä½ç©ºæ ¼é”®æˆ–é¼ æ ‡å·¦é”®è“„åŠ›ï¼Œæ¾å¼€è·³è·ƒ');
        console.log('- æ‰‹æœºï¼šæŒ‰ä½å±å¹•è“„åŠ›ï¼Œæ¾å¼€è·³è·ƒ');
        console.log('- è·³åˆ°æ–¹å—ä¸­å¿ƒå¯ä»¥è·å¾—è¿ç»­åŠ åˆ†');
        
        // è‡ªåŠ¨å¼€å§‹æ¸¸æˆï¼ˆå¯é€‰ï¼‰
        // initGame();
    </script>
</body>
</html>